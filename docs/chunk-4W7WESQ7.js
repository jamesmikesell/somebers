import{T as g}from"./chunk-DUPXJZ6A.js";import{a as b,b as l,c,d as h,e as E}from"./chunk-AH3KB6OD.js";var I=(e,t)=>t.some(n=>e instanceof n),v,M;function S(){return v||(v=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function k(){return M||(M=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var w=new WeakMap,y=new WeakMap,m=new WeakMap;function O(e){let t=new Promise((n,r)=>{let i=()=>{e.removeEventListener("success",a),e.removeEventListener("error",o)},a=()=>{n(u(e.result)),i()},o=()=>{r(e.error),i()};e.addEventListener("success",a),e.addEventListener("error",o)});return m.set(t,e),t}function A(e){if(w.has(e))return;let t=new Promise((n,r)=>{let i=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",o),e.removeEventListener("abort",o)},a=()=>{n(),i()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",a),e.addEventListener("error",o),e.addEventListener("abort",o)});w.set(e,t)}var B={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return w.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return u(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function T(e){B=e(B)}function K(e){return k().includes(e)?function(...t){return e.apply(P(this),t),u(this.request)}:function(...t){return u(e.apply(P(this),t))}}function F(e){return typeof e=="function"?K(e):(e instanceof IDBTransaction&&A(e),I(e,S())?new Proxy(e,B):e)}function u(e){if(e instanceof IDBRequest)return O(e);if(y.has(e))return y.get(e);let t=F(e);return t!==e&&(y.set(e,t),m.set(t,e)),t}var P=e=>m.get(e);function V(e,t,{blocked:n,upgrade:r,blocking:i,terminated:a}={}){let o=indexedDB.open(e,t),f=u(o);return r&&o.addEventListener("upgradeneeded",s=>{r(u(o.result),s.oldVersion,s.newVersion,u(o.transaction),s)}),n&&o.addEventListener("blocked",s=>n(s.oldVersion,s.newVersion,s)),f.then(s=>{a&&s.addEventListener("close",()=>a()),i&&s.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),f}var W=["get","getKey","getAll","getAllKeys","count"],R=["put","add","delete","clear"],D=new Map;function L(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(D.get(t))return D.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=R.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||W.includes(n)))return;let a=function(o,...f){return c(this,null,function*(){let s=this.transaction(o,i?"readwrite":"readonly"),d=s.store;return r&&(d=d.index(f.shift())),(yield Promise.all([d[n](...f),i&&s.done]))[0]})};return D.set(t,a),a}T(e=>l(b({},e),{get:(t,n,r)=>L(t,n)||e.get(t,n,r),has:(t,n)=>!!L(t,n)||e.has(t,n)}));var $=["continue","continuePrimaryKey","advance"],x={},p=new WeakMap,j=new WeakMap,z={get(e,t){if(!$.includes(t))return e[t];let n=x[t];return n||(n=x[t]=function(...r){p.set(this,j.get(this)[t](...r))}),n}};function G(...e){return E(this,null,function*(){let t=this;if(t instanceof IDBCursor||(t=yield new h(t.openCursor(...e))),!t)return;t=t;let n=new Proxy(t,z);for(j.set(n,t),m.set(n,P(t));t;)yield n,t=yield new h(p.get(n)||t.continue()),p.delete(n)})}function C(e,t){return t===Symbol.asyncIterator&&I(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&I(e,[IDBIndex,IDBObjectStore])}T(e=>l(b({},e),{get(t,n,r){return C(t,n)?G:e.get(t,n,r)},has(t,n){return C(t,n)||e.has(t,n)}}));var N=class e{dbPromise=null;static dbName="somebers-db";static storeName="kv";init(){return c(this,null,function*(){this.dbPromise||(this.dbPromise=V(e.dbName,1,{upgrade(t){t.objectStoreNames.contains("kv")||t.createObjectStore("kv")}}),yield this.dbPromise)})}db(){return c(this,null,function*(){return this.dbPromise||(yield this.init()),this.dbPromise})}get(t){return c(this,null,function*(){return(yield this.db()).get(e.storeName,t)})}set(t,n){return c(this,null,function*(){yield(yield this.db()).put(e.storeName,n,t)})}delete(t){return c(this,null,function*(){yield(yield this.db()).delete(e.storeName,t)})}static \u0275fac=function(n){return new(n||e)};static \u0275prov=g({token:e,factory:e.\u0275fac,providedIn:"root"})};export{V as a,N as b};
