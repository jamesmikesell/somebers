import{a as P,b as O}from"./chunk-ZUCJQJ2C.js";import"./chunk-4W7WESQ7.js";import{a as E}from"./chunk-UOZ4XZ54.js";import{$a as i,Ab as b,Ea as _,Sc as w,Va as x,Vc as y,Wa as f,Wc as M,Xc as D,aa as p,ab as n,ba as d,fc as S,gb as C,ib as u,kb as l,ua as g,ub as h,wb as k,ya as v,zb as a}from"./chunk-DUPXJZ6A.js";import{c as m}from"./chunk-AH3KB6OD.js";function T(c,t){if(c&1){let e=C();i(0,"p"),a(1,"Select or drag a .somebers file to restore your data."),n(),i(2,"div",6)(3,"mat-icon",7),a(4,"warning"),n(),i(5,"div",8)(6,"strong"),a(7,"Warning:"),n(),a(8," Restoring will overwrite ALL existing game data on this device. This cannot be undone. "),n()(),i(9,"div",9),u("drop",function(r){p(e);let o=l();return d(o.onDrop(r))})("dragover",function(r){p(e);let o=l();return d(o.onDragOver(r))})("dragleave",function(r){p(e);let o=l();return d(o.onDragLeave(r))}),i(10,"div",10)(11,"mat-icon"),a(12,"upload_file"),n(),i(13,"div"),a(14,"Drag & drop your .somebers file here"),n(),i(15,"div",11),a(16,"or"),n(),i(17,"button",3),u("click",function(){p(e);let r=h(20),o=l();return d(o.openFilePicker(r))}),a(18," Choose File "),n(),i(19,"input",12,0),u("change",function(r){p(e);let o=l();return d(o.onFileSelected(r))}),n()()()}if(c&2){let e=l();g(9),k("dragging",e.isDragging)}}function L(c,t){c&1&&(i(0,"div",4)(1,"mat-icon"),a(2,"check_circle"),n(),i(3,"div",13)(4,"h4"),a(5,"Restore Complete"),n(),i(6,"p"),a(7,"Your game data has been restored on this device."),n()()())}function I(c,t){if(c&1&&(i(0,"p",5),a(1),n()),c&2){let e=l();g(),b(e.message)}}var B=class c{constructor(t,e){this.saveDataService=t;this.lockService=e}message="";isDragging=!1;restoreComplete=!1;backup(){return m(this,null,function*(){this.message="";try{let t=yield this.saveDataService.service.load();if(!t){this.message="No saved data found to back up.";return}let e=JSON.stringify(t),s=new Blob([e],{type:"application/json;charset=utf-8"}),r=URL.createObjectURL(s),o=document.createElement("a");o.href=r,o.download=`somebers-backup-${new Date().toISOString().replace(/[:.]/g,"-")}.somebers`,document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(r),this.message="Backup downloaded."}catch(t){console.error("Backup failed",t),this.message="Backup failed. See console for details."}})}openFilePicker(t){t.click()}onFileSelected(t){return m(this,null,function*(){let e=t.target;!e.files||e.files.length===0||(yield this.handleFile(e.files[0]),e.value="")})}onDrop(t){return m(this,null,function*(){t.preventDefault(),this.isDragging=!1;let e=t.dataTransfer?.files;!e||e.length===0||(yield this.handleFile(e[0]))})}onDragOver(t){t.preventDefault(),this.isDragging=!0}onDragLeave(t){t.preventDefault(),this.isDragging=!1}handleFile(t){return m(this,null,function*(){this.message="";try{yield this.lockService.acquireLock();let e=yield t.text(),s=JSON.parse(e);yield this.saveDataService.service.save(s),this.restoreComplete=!0}catch(e){console.error("Restore failed",e),this.message="Restore failed. Ensure the file is a valid backup."}})}static \u0275fac=function(e){return new(e||c)(v(O),v(P))};static \u0275cmp=_({type:c,selectors:[["app-backup"]],decls:18,vars:2,consts:[["fileInput",""],[1,"backup-restore-container"],[1,"section"],["matButton","outlined","color","primary",3,"click"],["role","status","aria-live","polite",1,"success-panel"],[1,"message"],["role","alert","aria-live","polite",1,"warning"],["aria-hidden","true"],[1,"warn-text"],[1,"dropzone",3,"drop","dragover","dragleave"],[1,"dropzone-content"],[1,"or"],["type","file","accept",".somebers,application/json,text/plain","hidden","",3,"change"],[1,"text"]],template:function(e,s){e&1&&(i(0,"app-title"),a(1,"Backup & Restore"),n(),i(2,"div",1)(3,"div",2)(4,"h3"),a(5,"Backup"),n(),i(6,"p"),a(7,"Download your current saved data as a .somebers file."),n(),i(8,"button",3),u("click",function(){return s.backup()}),i(9,"mat-icon"),a(10,"download"),n(),a(11," Backup Now "),n()(),i(12,"div",2)(13,"h3"),a(14,"Restore"),n(),x(15,T,21,2)(16,L,8,0,"div",4),n(),x(17,I,2,1,"p",5),n()),e&2&&(g(15),f(s.restoreComplete?16:15),g(2),f(s.message?17:-1))},dependencies:[S,y,w,D,M,E],styles:[".backup-restore-container[_ngcontent-%COMP%]{max-width:800px;margin:16px;padding-top:11px}.section[_ngcontent-%COMP%]{margin:16px 0 32px}.warning[_ngcontent-%COMP%]{display:grid;grid-template-columns:24px 1fr;align-items:start;gap:8px;background:var(--mat-sys-error, #b00020);color:var(--mat-sys-on-error, #fff);padding:12px 16px;border-radius:8px;font-weight:600;margin:12px 0 16px}.warning[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;height:24px;width:24px;line-height:1;display:block}.warning[_ngcontent-%COMP%]   .warn-text[_ngcontent-%COMP%]{min-width:0}.dropzone[_ngcontent-%COMP%]{border:2px dashed var(--mat-sys-outline, #888);border-radius:8px;padding:24px;text-align:center;color:var(--mat-sys-on-surface, #333)}.dropzone.dragging[_ngcontent-%COMP%]{border-color:var(--mat-sys-primary, #3f51b5);background:color-mix(in oklab,var(--mat-sys-primary, #3f51b5) 10%,transparent)}.dropzone[_ngcontent-%COMP%]   .dropzone-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;align-items:center}.dropzone[_ngcontent-%COMP%]   .or[_ngcontent-%COMP%]{opacity:.7;margin:4px 0}.message[_ngcontent-%COMP%]{margin:8px 16px}.success-panel[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;background:color-mix(in oklab,var(--mat-sys-primary, #2e7d32) 15%,transparent);border:2px solid var(--mat-sys-primary, #2e7d32);color:var(--mat-sys-on-surface, #0a0a0a);padding:16px;border-radius:8px}.success-panel[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--mat-sys-primary, #2e7d32)}.success-panel[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 4px}"]})};export{B as BackupComponent};
