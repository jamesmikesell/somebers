import{a as I}from"./chunk-KBBQB6YI.js";import"./chunk-AH3KB6OD.js";var C=class{randomNumberGenerator;neighborCache=new Map;constructor(r){this.randomNumberGenerator=new I(I.generateFromSeed(r)*Number.MAX_SAFE_INTEGER)}generateRandomContiguousGroups(r){if(!Number.isInteger(r)||r<=0)throw new Error("n must be a positive integer");if(r===1)return[[1]];let e=r*r,i=2**(r*2-2),t=new Int16Array(e),n=new Int16Array(r+1),s=new Int32Array(e),o=Array.from({length:r+1},()=>new Array),m=[],h=new Int32Array(r+1),f=this.getNeighborsForSize(r),b=new Int32Array(4),c=new Array(e);for(let l=0;l<e;l++)c[l]=l;for(let l=0;l<i;l++){t.fill(0),n.fill(0),s.fill(-1),m.length=0,h.fill(-1);for(let u=1;u<=r;u++)o[u].length=0;this.shuffleInPlace(c);for(let u=1;u<=r;u++){let a=c[u-1];t[a]=u,n[u]=1,this.hasUnassignedNeighbor(a,t,f)&&this.addFrontier(u,a,o,s,n,r,m,h)}let y=r,N=!1;for(;y<e;){if(m.length===0){N=!0;break}let u=this.randomNumberGenerator.next()*m.length|0,a=m[u],A=o[a];if(A.length===0){this.removeActive(a,m,h);continue}let x=this.randomNumberGenerator.next()*A.length|0,g=A[x],p=0,w=f[g];for(let v=0;v<w.length;v++){let F=w[v];t[F]===0&&(b[p++]=F)}if(p===0){this.removeFrontier(a,g,o,s,n,r,m,h);continue}let d=b[this.randomNumberGenerator.next()*p|0];t[d]=a,n[a]++,y++,n[a]>=r?this.clearFrontier(a,o,s,m,h):this.hasUnassignedNeighbor(d,t,f)&&this.addFrontier(a,d,o,s,n,r,m,h),this.hasUnassignedNeighbor(g,t,f)||this.removeFrontier(a,g,o,s,n,r,m,h)}if(!N){let u=Array.from({length:r},()=>Array(r).fill(0));for(let a=0;a<e;a++)u[Math.floor(a/r)][a%r]=t[a];return u}}throw new Error("Failed to generate after retries; try increasing maxAttempts or using a different n.")}addActive(r,e,i,t,n){e[r]>=i||n[r]===-1&&(n[r]=t.length,t.push(r))}removeActive(r,e,i){let t=i[r];if(t===-1)return;let n=e.length-1,s=e[n];e[t]=s,i[s]=t,e.pop(),i[r]=-1}addFrontier(r,e,i,t,n,s,o,m){if(t[e]!==-1)return;let h=i[r];t[e]=h.length,h.push(e),h.length===1&&this.addActive(r,n,s,o,m)}removeFrontier(r,e,i,t,n,s,o,m){let h=t[e];if(h===-1)return;let f=i[r],b=f.length-1,c=f[b];h!==b&&(f[h]=c,t[c]=h),f.pop(),t[e]=-1,(f.length===0||n[r]>=s)&&this.removeActive(r,o,m)}clearFrontier(r,e,i,t,n){let s=e[r];for(let o=0;o<s.length;o++)i[s[o]]=-1;s.length=0,this.removeActive(r,t,n)}hasUnassignedNeighbor(r,e,i){let t=i[r];for(let n=0;n<t.length;n++)if(e[t[n]]===0)return!0;return!1}getNeighborsForSize(r){let e=this.neighborCache.get(r);return e||(e=Array.from({length:r*r},(i,t)=>{let n=Math.floor(t/r),s=t%r,o=[];return n>0&&o.push(t-r),n<r-1&&o.push(t+r),s>0&&o.push(t-1),s<r-1&&o.push(t+1),o}),this.neighborCache.set(r,e),e)}shuffleInPlace(r){for(let e=r.length-1;e>0;e--){let i=this.randomNumberGenerator.next()*(e+1)|0;[r[e],r[i]]=[r[i],r[e]]}}};export{C as BoardGroupGeneratorV2};
