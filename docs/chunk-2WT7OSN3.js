import{a as gi}from"./chunk-7S535TEK.js";import{a as Te}from"./chunk-KBBQB6YI.js";import{a as Le}from"./chunk-YIPIGJ4C.js";import{a as ni}from"./chunk-SMB3ZBBR.js";import{a as hi,b as st}from"./chunk-ZUCJQJ2C.js";import"./chunk-4W7WESQ7.js";import{B as ye,C as Ge,D as rt,E as Ie,F as nt,G as ot,H as at,I as Ce,b as ri,h as ai,j as si,k as li,l as ci,m as ui,n as he,o as di,p as mi,q as ge,r as fi,s as be,z as ve}from"./chunk-FXPBCG6U.js";import{a as pi}from"./chunk-UOZ4XZ54.js";import{$a as b,Ab as ie,Bb as j,Ea as Q,F as jt,Fb as Ke,Ga as Jt,Ha as Qt,Hb as Bt,Ib as je,Jb as Kt,K as $t,Ka as ke,Kb as et,Lb as Gt,Ma as ee,Na as Ze,O as L,P as Wt,Sc as tt,T as W,Tc as oi,Ua as Rt,Uc as it,Va as O,Vc as se,Wa as F,Wc as Be,X as J,Xa as Ae,Xc as le,Ya as Ee,Za as De,_a as X,aa as R,ab as T,ba as B,bb as ae,c as Yt,cb as E,db as D,dc as ei,eb as He,ec as ti,f as Y,fb as Ue,fc as pe,gb as te,ib as U,ic as ii,jb as Re,kb as _,la as Je,n as Ve,o as ue,oa as Xt,ob as re,pb as ne,qb as oe,ta as Qe,u as fe,ua as w,ub as qe,vb as de,w as Xe,wb as K,xb as Zt,y as Me,ya as G,yb as Ye,zb as p}from"./chunk-DUPXJZ6A.js";import{a as we,c as P}from"./chunk-AH3KB6OD.js";var me=class{get fullBoard(){return this._fullBoard}playArea=[];solvable;_fullBoard=[];goalRows=[];goalColumns=[];constructBoard(e){this.ensureMinimumsAndCalculateHeaders(e),this.solvable=this.checkIfSolvableAfterAttemptingFix(),this.ensureMinimumsAndCalculateHeaders(e),this._fullBoard=[],this._fullBoard.push([void 0,...this.goalColumns]);for(let t=0;t<this.playArea.length;t++){let i=[this.goalRows[t],...this.playArea[t]];this._fullBoard.push(i)}this.computeCellBorders(),this.isComplete()}ensureMinimumsAndCalculateHeaders(e){let t=Te.generateFromSeed(e)*Number.MAX_SAFE_INTEGER,i=new Te(t);do{this.goalRows=[],this.goalColumns=[];let r=new Map,n=new Map;this.playArea.forEach((a,s)=>a.forEach((l,c)=>{let d=n.get(l.groupNumber)??[];if(d.push(l),n.set(l.groupNumber,d),r.get(l.groupNumber)||(l.colorGroupGoal=0,r.set(l.groupNumber,l)),!this.goalRows[s]){let u=new ce;u.value=0,this.goalRows[s]=u}if(!this.goalColumns[c]){let u=new ce;u.value=0,this.goalColumns[c]=u}l.required&&(this.goalRows[s].value+=l.value,this.goalColumns[c].value+=l.value,r.get(l.groupNumber).colorGroupGoal+=l.value)}));{let a=this.goalRows.findIndex(s=>!s.value);if(a>=0){let s=Math.floor(i.next()*(this.playArea[0].length-1));this.playArea[a][s].required=!0;continue}}{let a=this.goalColumns.findIndex(s=>!s.value);if(a>=0){let s=Math.floor(i.next()*(this.playArea.length-1));this.playArea[s][a].required=!0;continue}}{let a=Array.from(r.values()).find(s=>!s.colorGroupGoal);if(a){let s=n.get(a.groupNumber),l=Math.floor(i.next()*(s.length-1));s[l].required=!0;continue}}break}while(!0)}recalculateSelectedHeaders(){this.goalColumns.forEach(t=>t.currentSelectionSum=0),this.goalRows.forEach(t=>t.currentSelectionSum=0);let e=new Map;this.playArea.forEach((t,i)=>{t.forEach((r,n)=>{let a=e.get(r.groupNumber);a||(a=r,e.set(r.groupNumber,a),a.currentSelectionSum=0),r.status===1&&(this.goalColumns[n].currentSelectionSum+=r.value,this.goalRows[i].currentSelectionSum+=r.value,a.currentSelectionSum+=r.value)})}),this.goalColumns.forEach(t=>t.currentSelectionSum=t.currentSelectionSum||void 0),this.goalRows.forEach(t=>t.currentSelectionSum=t.currentSelectionSum||void 0)}clearColumn(e){let t=this.playArea.map(r=>r[e]);if(!this.areRequiredCellsSelected(t))return[];let i=[];return t.forEach(r=>{!r.required&&r.status!==2&&(r.status=2,i.push(r))}),i}clearRow(e){let t=this.playArea[e];if(!this.areRequiredCellsSelected(t))return[];let i=[];return t.forEach(r=>{!r.required&&r.status!==2&&(r.status=2,i.push(r))}),i}areRequiredCellsSelected(e){return e.filter(t=>t.required).every(t=>t.status===1)}fixUnsolvableRectangle(e){let t=[this.playArea[e.r1][e.c1],this.playArea[e.r1][e.c2],this.playArea[e.r2][e.c1],this.playArea[e.r2][e.c2]];t.find(i=>!i.required).required=!0}checkIfSolvableAfterAttemptingFix(){if(this.playArea.length===0||this.playArea[0].length===0)return!0;let i=0,r=50;for(;i<r;){let n=this.findUnsolvableRectangle(this.playArea);if(!n)return!0;this.fixUnsolvableRectangle(n),i++}return!1}findUnsolvableRectangle(e){let t=e.length,i=e[0].length;for(let r=0;r<t;r++)for(let n=0;n<i;n++)for(let a=r+1;a<t;a++)for(let s=n+1;s<i;s++)if(this.isRectangleUnsolvable(e,r,n,a,s))return{r1:r,c1:n,r2:a,c2:s};return null}isRectangleUnsolvable(e,t,i,r,n){let a=e[t][i],s=e[t][n],l=e[r][i],c=e[r][n],d=a.value===s.value&&a.value===l.value&&a.value===c.value,f=a.required===c.required&&l.required===s.required&&a.required!==s.required,m=[a.groupNumber,s.groupNumber,l.groupNumber,c.groupNumber],h=new Map;for(let x of m)h.set(x,(h.get(x)||0)+1);let v=h.values().next().value===2,y=h.size===2&&v||h.size===1;return d&&y&&f}inProgress(){return this.playArea.some(e=>e.some(t=>t.status!==0))}isComplete(){this.clearCompleted();for(let e of this.playArea)for(let t of e)if(t.required&&t.status!==1||!t.required&&t.status!==2)return!1;return!0}clearCompleted(){let e=new Set,t=new Set,i=new Set;for(let r=0;r<this.playArea.length;r++)this.isRowComplete(r)&&e.add(r),this.isColumnComplete(r)&&t.add(r),this.isColorGroupComplete(r+1)&&i.add(r+1);this.playArea.forEach(r=>{r.forEach(n=>{i.has(n.groupNumber)?n.hideBackground=!0:n.hideBackground=!1})}),this.goalColumns.forEach((r,n)=>{t.has(n)?r.hideBackground=!0:r.hideBackground=!1}),this.goalRows.forEach((r,n)=>{e.has(n)?r.hideBackground=!0:r.hideBackground=!1})}computeCellBorders(){let e=this.playArea.length,t=this.playArea[0].length;for(let i=0;i<e;i++)for(let r=0;r<t;r++){let n=this.playArea[i][r];n.borderTop=i===0||this.playArea[i-1][r].groupNumber!==n.groupNumber,n.borderLeft=r===0||this.playArea[i][r-1].groupNumber!==n.groupNumber,n.borderRight=r===t-1||this.playArea[i][r+1].groupNumber!==n.groupNumber,n.borderBottom=i===e-1||this.playArea[i+1][r].groupNumber!==n.groupNumber}}isRowComplete(e){return this.playArea[e].every(t=>t.required&&t.status===1||!t.required&&t.status===2)}isColumnComplete(e){for(let t=0;t<this.playArea.length;t++){let i=this.playArea[t][e];if(!(i.required&&i.status===1||!i.required&&i.status===2))return!1}return!0}isColorGroupComplete(e){return this.playArea.flat().filter(t=>t.groupNumber===e).every(t=>t.required&&t.status===1||!t.required&&t.status===2)}},ce=class{status=0;required=!1;value;groupNumber;invalidMove=!1;hideBackground=!1;highlighted=!1;processing=!1;glowActive=!1;glowVariant;borderTop=!1;borderLeft=!1;borderRight=!1;borderBottom=!1;colorDark;colorLight;currentSelectionSum;colorGroupGoal;constructor(){}},Se=(i=>(i[i.NONE=0]="NONE",i[i.SELECTED=1]="SELECTED",i[i.CLEARED=2]="CLEARED",i))(Se||{});var lt=class{constructor(e){this.gameHistories=e}currentStreak;calculateStats(e){let t=this.currentStreak??0,r=Array.from(this.gameHistories.values()).flatMap(u=>u.moveHistory??[]).sort((u,f)=>u.timestamp-f.timestamp);this.currentStreak=this.getMaxStreakSinceDays(0);let n=r.slice(-1e3),a,s;n.length>0?(a=n.length,s=n.filter(f=>f.correct).length/n.length*100):(a=0,s=null);let l=this.gameHistories.get(e),c=l?.moveHistory.filter(u=>!u.correct).length??0,d=l?.timeSpent;return{streaks:[{displayTimelineFull:"Past 24 hours",displayTimelineAbbreviated:"24h",streak:this.getMaxStreakSinceDays(1)},{displayTimelineFull:"Past 3 days",displayTimelineAbbreviated:"3d",streak:this.getMaxStreakSinceDays(3)},{displayTimelineFull:"Past 5 days",displayTimelineAbbreviated:"5d",streak:this.getMaxStreakSinceDays(5)},{displayTimelineFull:"Past 7 days",displayTimelineAbbreviated:"7d",streak:this.getMaxStreakSinceDays(7)},{displayTimelineFull:"Past 14 days",displayTimelineAbbreviated:"14d",streak:this.getMaxStreakSinceDays(14)},{displayTimelineFull:"Past 30 days",displayTimelineAbbreviated:"30d",streak:this.getMaxStreakSinceDays(30)},{displayTimelineFull:"Past year",displayTimelineAbbreviated:"1y",streak:this.getMaxStreakSinceDays(365.25)},{displayTimelineFull:"Forever",displayTimelineAbbreviated:"Forever",streak:this.getMaxStreakSinceDays(void 0)}],accuracyHistoryMoveCount:a,accuracyPercent:s,previousStreak:t,currentStreak:this.currentStreak,mistakesCurrentBoard:c,timeSpent:d}}getMaxStreakSinceDays(e){let t=Array.from(this.gameHistories.values()).flatMap(s=>s.moveHistory??[]).sort((s,l)=>l.timestamp-s.timestamp);if(t.length===0)return 0;let r=e==null||!isFinite(e)?Number.NEGATIVE_INFINITY:Date.now()-e*24*60*60*1e3,n=0,a=0;for(let s of t)if(s.correct)n++;else if(a=Math.max(a,n),n=0,s.timestamp<r)break;return a=Math.max(a,n),a}};var ct=class{startTime=null;cumulativeTime=0;manuallyPaused=!1;destroy$=new Y;browserStateSubject=new Y;browserState$=this.browserStateSubject.asObservable();syncedTimer$;constructor(){this.init(),this.syncedTimer$=new Yt(e=>{let t,i=()=>{if(this.startTime===null)return;let n=this.getTotalTime(),a=(Math.floor(n/1e3)+1)*1e3-n+10;t=setTimeout(()=>{this.startTime!==null&&(e.next(this.getTotalTime()),i())},a)},r=this.browserState$.subscribe(()=>{clearTimeout(t),i()});return i(),()=>{clearTimeout(t),r.unsubscribe()}}).pipe($t(),L(this.destroy$))}getTotalTime(){let e=this.cumulativeTime;return this.startTime&&(e+=Date.now()-this.startTime),e}reset(e=0){this.manualPause(),this.cumulativeTime=e}isTracking(){return!!this.startTime}manualStart(){this.manuallyPaused=!1,document.hidden||this.doStart()&&this.emitBrowser(!0,"manualStart")}manualPause(){this.manuallyPaused=!0,this.doPause()&&this.emitBrowser(!1,"manualPause")}destroy(){this.doPause()&&this.emitBrowser(!1,"destroy"),this.destroy$.next(),document.removeEventListener("visibilitychange",this.onVisibilityChange),window.removeEventListener("beforeunload",this.onPageUnload),window.removeEventListener("pagehide",this.onPageUnload)}init(){document.hidden||this.doStart()&&this.emitBrowser(!0,"init"),document.addEventListener("visibilitychange",this.onVisibilityChange),window.addEventListener("beforeunload",this.onPageUnload),window.addEventListener("pagehide",this.onPageUnload)}onVisibilityChange=()=>{document.hidden?this.doPause()&&this.emitBrowser(!1,"hidden"):this.doStart()&&this.emitBrowser(!0,"visible")};onPageUnload=e=>{let t=e?.type==="pagehide"?"pagehide":"beforeunload";this.doPause()&&this.emitBrowser(!1,t)};emitBrowser(e,t){this.browserStateSubject.next({active:e,reason:t,at:Date.now()})}doStart(){return this.manuallyPaused||this.startTime?!1:(this.startTime=Date.now(),!0)}doPause(){return this.startTime?(this.cumulativeTime+=Date.now()-this.startTime,this.startTime=null,!0):!1}};var ut=class{constructor(e){this.deps=e}stack=[];clear(){this.stack=[],this.deps.undoEnabledStateChange(!1)}hasUndo(){return this.stack.length>0}pushCells(e,t){let i=e.map(r=>this.buildUndoCellAction(r)).filter(r=>r!=null);if(i.length){if(t?.appendToPrevious){let r=this.peekLast();if(r?.kind==="cells"){r.actions.push(...i),this.deps.undoEnabledStateChange(!0);return}}this.stack.push({kind:"cells",actions:i}),this.deps.undoEnabledStateChange(!0)}}pushMistake(){let e={kind:"mistake"};this.stack.push(e),this.deps.undoEnabledStateChange(!0)}undoLast(){let e=this.stack.pop();if(e){switch(e.kind){case"cells":{let t=this.deps.getGameBoard();e.actions.forEach(i=>{let r=t.playArea[i.row]?.[i.col];r&&(r.status=0,r.invalidMove=!1)});break}case"mistake":break}this.deps.getMoveHistory().pop(),this.deps.moveUndone(),this.deps.undoEnabledStateChange(this.stack.length>0)}}peekLast(){return this.stack[this.stack.length-1]}buildUndoCellAction(e){let t=this.findCellCoordinates(e.cell);return t?{kind:e.kind,row:t.row,col:t.col}:null}findCellCoordinates(e){let t=this.deps.getGameBoard().playArea;for(let i=0;i<t.length;i++){let r=t[i];for(let n=0;n<r.length;n++)if(r[n]===e)return{row:i,col:n}}return null}};var dt=class{element;config;destroy$=new Y;touchStartSubject=new Y;allGesturesCompleteSubject=new Y;swipeUpSubject=new Y;swipeDownSubject=new Y;tapSubject=new Y;doubleTapSubject=new Y;longPressSubject=new Y;longPressDragSubject=new Y;isPointerDown=!1;startPoint=null;currentPoint=null;longPressTimer=null;gestureRecognized=!1;lastTapEndTime=0;lastTapStartPoint=null;pendingTap=null;doubleTapTimer=null;longPressActive=!1;longPressAnchorPoint=null;longPressDragRecognized=!1;touchStart$;allGesturesComplete$;swipeUp$;swipeDown$;tap$;doubleTap$;longPress$;longPressDrag$;constructor(e,t={}){this.element=e,this.config={minSwipeDistance:t.minSwipeDistance??75,maxSwipeDuration:t.maxSwipeDuration??300,maxTapDuration:t.maxTapDuration??200,maxTapMovement:t.maxTapMovement??10,maxDoubleTapInterval:t.maxDoubleTapInterval??300,maxDoubleTapDistance:t.maxDoubleTapDistance??20,minLongPressDuration:t.minLongPressDuration??500,maxLongPressMovement:t.maxLongPressMovement??15,minLongPressHorizontalDragDistance:t.minLongPressHorizontalDragDistance??30},this.touchStart$=this.touchStartSubject.asObservable(),this.allGesturesComplete$=this.allGesturesCompleteSubject.asObservable(),this.swipeUp$=this.swipeUpSubject.asObservable(),this.swipeDown$=this.swipeDownSubject.asObservable(),this.tap$=this.tapSubject.asObservable(),this.doubleTap$=this.doubleTapSubject.asObservable(),this.longPress$=this.longPressSubject.asObservable(),this.longPressDrag$=this.longPressDragSubject.asObservable(),this.attachEventListeners()}attachEventListeners(){let e=fe(this.element,"mousedown"),t=fe(document,"mousemove"),i=fe(document,"mouseup"),r=fe(this.element,"touchstart"),n=fe(this.element,"touchmove"),a=fe(this.element,"touchend"),s=fe(document,"touchcancel"),l=Xe(e.pipe(Me(u=>u.button!==2),ue(u=>({type:"mouse",event:u}))),r.pipe(ue(u=>({type:"touch",event:u})))),c=Xe(t.pipe(ue(u=>({type:"mouse",event:u}))),n.pipe(ue(u=>({type:"touch",event:u})))),d=Xe(i.pipe(ue(u=>({type:"mouse",event:u}))),a.pipe(ue(u=>({type:"touch",event:u}))));l.pipe(L(this.destroy$)).subscribe(({type:u,event:f})=>{this.handleStart(u,f)}),c.pipe(L(this.destroy$),Me(()=>this.isPointerDown)).subscribe(({type:u,event:f})=>{this.handleMove(u,f)}),d.pipe(L(this.destroy$),Me(()=>this.isPointerDown)).subscribe(({type:u,event:f})=>{this.handleEnd(u,f)}),s.pipe(L(this.destroy$),Me(()=>this.isPointerDown)).subscribe(u=>{this.handleCancel("touch",u)})}getPoint(e,t){if(e==="touch"){let i=t,r=i.touches[0]||i.changedTouches[0];return{x:r.clientX,y:r.clientY,timestamp:Date.now()}}else{let i=t;return{x:i.clientX,y:i.clientY,timestamp:Date.now()}}}calculateDistance(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}handleStart(e,t){t.preventDefault(),this.isPointerDown=!0,this.startPoint=this.getPoint(e,t),this.currentPoint=this.startPoint,this.gestureRecognized=!1;let i={type:"touchStart",startPoint:this.startPoint};this.touchStartSubject.next(i),this.longPressTimer=window.setTimeout(()=>{if(this.isPointerDown&&!this.gestureRecognized&&this.startPoint&&this.currentPoint){let r=this.calculateDistance(this.startPoint,this.currentPoint);if(r<=this.config.maxLongPressMovement){this.gestureRecognized=!0;let n={type:"longPress",startPoint:this.startPoint,endPoint:this.currentPoint,duration:Date.now()-this.startPoint.timestamp,distance:r};this.longPressSubject.next(n),this.longPressActive=!0,this.longPressAnchorPoint=this.currentPoint}}},this.config.minLongPressDuration)}handleMove(e,t){if(!this.startPoint)return;this.currentPoint=this.getPoint(e,t);let i=this.calculateDistance(this.startPoint,this.currentPoint),r=this.currentPoint.timestamp-this.startPoint.timestamp;if(this.longPressActive&&!this.longPressDragRecognized&&this.longPressAnchorPoint){let n=this.currentPoint.x-this.longPressAnchorPoint.x,a=this.currentPoint.y-this.longPressAnchorPoint.y,s=Math.abs(n),l=Math.abs(a);if(s>=this.config.minLongPressHorizontalDragDistance&&s>l){this.longPressDragRecognized=!0;let c={type:"longPressDragHorizontal",startPoint:this.longPressAnchorPoint,endPoint:this.currentPoint,duration:this.currentPoint.timestamp-this.longPressAnchorPoint.timestamp,distance:Math.abs(n)};this.longPressDragSubject.next(c)}}if(!this.gestureRecognized&&i>=this.config.minSwipeDistance&&r<=this.config.maxSwipeDuration){let n=this.currentPoint.y-this.startPoint.y,a=this.currentPoint.x-this.startPoint.x;if(Math.abs(n)>Math.abs(a)){this.gestureRecognized=!0,this.clearLongPressTimer();let s={type:n<0?"swipeUp":"swipeDown",startPoint:this.startPoint,endPoint:this.currentPoint,duration:r,distance:i};n<0?this.swipeUpSubject.next(s):this.swipeDownSubject.next(s)}}}handleEnd(e,t){if(!this.startPoint)return;let i=this.getPoint(e,t),r=i.timestamp-this.startPoint.timestamp,n=this.calculateDistance(this.startPoint,i);if(this.clearLongPressTimer(),this.gestureRecognized)this.completeGesture();else if(r<=this.config.maxTapDuration&&n<=this.config.maxTapMovement){let a={type:"tap",startPoint:this.startPoint,endPoint:i,duration:r,distance:n};this.handlePotentialTap(a)}else this.completeGesture();this.resetState()}handleCancel(e,t){this.startPoint&&(this.currentPoint=this.getPoint(e,t),this.clearLongPressTimer(),this.clearDoubleTapTimer(),this.pendingTap=null,this.completeGesture(),this.resetState())}handlePotentialTap(e){let t=Date.now();if(this.lastTapStartPoint&&t-this.lastTapEndTime<=this.config.maxDoubleTapInterval&&this.calculateDistance(this.lastTapStartPoint,e.startPoint)<=this.config.maxDoubleTapDistance){this.clearDoubleTapTimer();let i={type:"doubleTap",startPoint:this.lastTapStartPoint,endPoint:e.endPoint,duration:e.endPoint.timestamp-this.lastTapStartPoint.timestamp,distance:this.calculateDistance(this.lastTapStartPoint,e.endPoint)};this.doubleTapSubject.next(i),this.completeGesture(),this.lastTapStartPoint=null,this.lastTapEndTime=0,this.pendingTap=null}else this.pendingTap=e,this.lastTapStartPoint=e.startPoint,this.lastTapEndTime=t,this.doubleTapTimer=window.setTimeout(()=>{this.pendingTap&&(this.tapSubject.next(this.pendingTap),this.completeGesture(),this.pendingTap=null)},this.config.maxDoubleTapInterval)}completeGesture(){let e={type:"allGesturesComplete",startPoint:this.startPoint,endPoint:this.currentPoint};this.allGesturesCompleteSubject.next(e)}resetState(){this.isPointerDown=!1,this.startPoint=null,this.currentPoint=null,this.gestureRecognized=!1,this.longPressActive=!1,this.longPressAnchorPoint=null,this.longPressDragRecognized=!1}clearLongPressTimer(){this.longPressTimer!==null&&(clearTimeout(this.longPressTimer),this.longPressTimer=null)}clearDoubleTapTimer(){this.doubleTapTimer!==null&&(clearTimeout(this.doubleTapTimer),this.doubleTapTimer=null)}destroy(){this.clearLongPressTimer(),this.clearDoubleTapTimer(),this.destroy$.next(),this.destroy$.complete(),this.touchStartSubject.complete(),this.allGesturesCompleteSubject.complete(),this.swipeUpSubject.complete(),this.swipeDownSubject.complete(),this.tapSubject.complete(),this.doubleTapSubject.complete(),this.longPressSubject.complete(),this.longPressDragSubject.complete(),this.resetState(),this.lastTapStartPoint=null,this.lastTapEndTime=0,this.pendingTap=null}};var mt=class o{constructor(e){this.el=e}swipeUp=new ee;swipeDown=new ee;tap=new ee;doubleTap=new ee;touchStart=new ee;allGesturesComplete=new ee;longPress=new ee;longPressDragHorizontal=new ee;claude;destroy$=new Y;ngOnInit(){this.claudeInit()}claudeInit(){this.claude=new dt(this.el.nativeElement,{maxDoubleTapInterval:800}),this.claude.touchStart$.pipe(L(this.destroy$)).subscribe(()=>this.touchStart.emit()),this.claude.allGesturesComplete$.pipe(L(this.destroy$)).subscribe(()=>this.allGesturesComplete.emit()),this.claude.swipeUp$.pipe(L(this.destroy$)).subscribe(()=>this.swipeUp.emit()),this.claude.swipeDown$.pipe(L(this.destroy$)).subscribe(()=>this.swipeDown.emit()),this.claude.tap$.pipe(L(this.destroy$)).subscribe(()=>this.tap.emit()),this.claude.doubleTap$.pipe(L(this.destroy$)).subscribe(()=>this.doubleTap.emit()),this.claude.longPress$.pipe(L(this.destroy$)).subscribe(()=>this.longPress.emit()),this.claude.longPressDrag$.pipe(L(this.destroy$)).subscribe(()=>this.longPressDragHorizontal.emit())}ngOnDestroy(){this.claude&&this.claude.destroy(),this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||o)(G(Xt))};static \u0275dir=Jt({type:o,selectors:[["","appGesture",""]],outputs:{swipeUp:"swipeUp",swipeDown:"swipeDown",tap:"tap",doubleTap:"doubleTap",touchStart:"touchStart",allGesturesComplete:"allGesturesComplete",longPress:"longPress",longPressDragHorizontal:"longPressDragHorizontal"}})};var Ei=["positionFinder"],Di=()=>({isMagnifiedView:!1}),Ri=()=>({isMagnifiedView:!0});function Bi(o,e){if(o&1&&(b(0,"span",7),p(1,"\u{1D6F4}"),T(),p(2)),o&2){let t=_(3);w(2),j(" ",t.cell.currentSelectionSum," ")}}function Gi(o,e){if(o&1&&(b(0,"div",5),O(1,Bi,3,1),T(),b(2,"div",6),p(3),T()),o&2){let t=_(2);w(),F(t.rowColCurrentSumVisible&&t.cell.currentSelectionSum?1:-1),w(2),ie(t.cell.value)}}function Ii(o,e){if(o&1&&(b(0,"div",4),O(1,Gi,4,2),T()),o&2){let t=_();de("--columnCount",t.columnCount),K("hidden",t.cell.hideBackground)("disable-animation",t.disableAnimation)("glow-active",t.cell==null?null:t.cell.glowActive),Rt("data-glow-variant",(t.cell==null?null:t.cell.glowVariant)??null),w(),F(t.cell.hideBackground?-1:1)}}function Li(o,e){if(o&1&&(b(0,"span",7),p(1,"\u{1D6F4}"),T(),p(2)),o&2){let t=_(2);w(2),j(" ",t.cell.currentSelectionSum," ")}}function Oi(o,e){if(o&1&&(b(0,"div")(1,"div",8),p(2),T(),b(3,"div",5),O(4,Li,3,1),T(),b(5,"div",6),p(6),T()()),o&2){let t=e.isMagnifiedView,i=_();Ye(Ke("cell cell-bg cell-fade color shape-",i.cell.groupNumber)),de("--columnCount",i.columnCount),K("wiggle",i.cell.invalidMove)("hidden",i.cell.hideBackground)("processing",i.cell.processing&&!t)("disable-animation",i.disableAnimation)("shape",i.shapesMode)("glow-active",!t&&(i.cell==null?null:i.cell.glowActive)),Rt("data-glow-variant",(i.cell==null?null:i.cell.glowVariant)??null),w(2),j(" ",i.cell.colorGroupGoal," "),w(2),F(i.colorGroupCurrentSelectionSumVisible&&i.cell.currentSelectionSum?4:-1),w(),K("highlighted",i.cell.highlighted)("circle",i.cell.status===i.SelectionStatus.SELECTED)("cleared-text",i.cell.status===i.SelectionStatus.CLEARED),w(),j(" ",i.cell.value," ")}}function Fi(o,e){o&1&&ae(0,"div",3)}function zi(o,e){o&1&&Ue(0)}function Ni(o,e){o&1&&Ue(0)}function Vi(o,e){if(o&1&&(b(0,"div",11),ke(1,Ni,1,0,"ng-container",10),T()),o&2){_(2);let t=qe(3);w(),X("ngTemplateOutlet",t)}}function Hi(o,e){if(o&1){let t=te();b(0,"div",9),U("doubleTap",function(){R(t);let r=_();return B(r.headerDoubleTapped.emit())})("longPress",function(){R(t);let r=_();return B(r.isMagnified=!0)})("allGesturesComplete",function(){R(t);let r=_();return B(r.gestureComplete())}),ke(1,zi,1,0,"ng-container",10),T(),O(2,Vi,2,1,"div",11)}if(o&2){let t=_(),i=qe(3);w(),X("ngTemplateOutlet",i),w(),F(t.isMagnified?2:-1)}}function Ui(o,e){o&1&&Ue(0)}function qi(o,e){o&1&&Ue(0)}function Yi(o,e){if(o&1&&(b(0,"div",11),ke(1,qi,1,0,"ng-container",13),T()),o&2){_(2);let t=qe(5);w(),X("ngTemplateOutlet",t)("ngTemplateOutletContext",Bt(2,Ri))}}function ji(o,e){if(o&1){let t=te();b(0,"div",12),U("touchStart",function(){R(t);let r=_();return B(r.touchStart())})("tap",function(){R(t);let r=_();return B(r.use())})("doubleTap",function(){R(t);let r=_();return B(r.clear())})("contextmenu",function(r){return R(t),_().clear(),B(r.preventDefault())})("swipeUp",function(){R(t);let r=_();return B(r.use())})("swipeDown",function(){R(t);let r=_();return B(r.clear())})("longPress",function(){R(t);let r=_();return B(r.isMagnified=!0)})("longPressDragHorizontal",function(){R(t);let r=_();return B(r.highlightCell())})("allGesturesComplete",function(){R(t);let r=_();return B(r.gestureComplete())}),ke(1,Ui,1,0,"ng-container",13),T(),O(2,Yi,2,3,"div",11)}if(o&2){let t=_(),i=qe(5);w(),X("ngTemplateOutlet",i)("ngTemplateOutletContext",Bt(3,Di)),w(),F(t.isMagnified?2:-1)}}var ft=class o{_cell;get cell(){return this._cell}set cell(e){this._cell&&this.gestureComplete(),this._cell=e}displayType;columnCount;shapesMode=!1;disableAnimation=!1;rowColCurrentSumVisible=!0;colorGroupCurrentSelectionSumVisible=!0;used=new ee;cleared=new ee;headerDoubleTapped=new ee;positionFinder;get scaleFactor(){return this._scaleFactor}get getCellColor(){return this.cell?`light-dark(${this.cell.colorLight}, ${this.cell.colorDark})`:"light-dark( #cacacaff, #3f3f3fff)"}get moveX(){return this._moveX}SelectionStatus=Se;isMagnified=!1;_scaleFactor=1;_moveX;windowResizeHandler(){this.updateScaleFactor()}ngOnChanges(e){this.updateScaleFactor()}ngOnDestroy(){this.gestureComplete()}ngAfterViewInit(){this.updateScaleFactor()}updateScaleFactor(){setTimeout(()=>{let e=this.positionFinder.nativeElement,i=190/e.getBoundingClientRect().width;this._scaleFactor=i;let r=window.innerWidth/2,n=e.getBoundingClientRect(),a=(r-(n.left+n.right)/2)*.6;this._moveX=a/i+"px"},0)}touchStart(){this.cell.status===0&&!this.cell.processing&&(this.cell.processing=!0)}use(){this.used.emit(this.cell)}clear(){this.cleared.emit(this.cell)}gestureComplete(){this.cell&&(this.cell.processing=!1),this.isMagnified=!1}highlightCell(){this.cell.highlighted=!this.cell.highlighted}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=Q({type:o,selectors:[["app-cell"]],viewQuery:function(t,i){if(t&1&&re(Ei,5),t&2){let r;ne(r=oe())&&(i.positionFinder=r.first)}},hostVars:6,hostBindings:function(t,i){t&1&&U("resize",function(){return i.windowResizeHandler()},Qe),t&2&&de("--scaleFactor",i.scaleFactor)("--cellColor",i.getCellColor)("--moveX",i.moveX)},inputs:{cell:"cell",displayType:"displayType",columnCount:"columnCount",shapesMode:"shapesMode",disableAnimation:"disableAnimation",rowColCurrentSumVisible:"rowColCurrentSumVisible",colorGroupCurrentSelectionSumVisible:"colorGroupCurrentSelectionSumVisible"},outputs:{used:"used",cleared:"cleared",headerDoubleTapped:"headerDoubleTapped"},features:[Je],decls:9,vars:1,consts:[["positionFinder",""],["headerCellContent",""],["standardCellContent",""],[1,"cell"],[1,"cell","cell-bg","cell-fade","bg-muted"],[1,"corner-number","top","right"],[1,"main-number"],[1,"super-label"],[1,"corner-number","top","left"],["appGesture","",3,"doubleTap","longPress","allGesturesComplete"],[4,"ngTemplateOutlet"],[1,"magnifier-view"],["appGesture","",3,"touchStart","tap","doubleTap","contextmenu","swipeUp","swipeDown","longPress","longPressDragHorizontal","allGesturesComplete"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(t,i){t&1&&(ae(0,"div",null,0),ke(2,Ii,2,10,"ng-template",null,1,Gt)(4,Oi,7,27,"ng-template",null,2,Gt),O(6,Fi,1,0,"div",3)(7,Hi,3,2)(8,ji,3,4)),t&2&&(w(6),F(i.displayType==="blank"?6:i.displayType==="header"?7:i.displayType==="standard"?8:-1))},dependencies:[pe,ei,mt],styles:['[_nghost-%COMP%]{position:relative;--_headerSpacing: var(--headerSpacing, -100px);--_cellGap: var(--cellGap, -100px)}.disable-animation[_ngcontent-%COMP%], .disable-animation[_ngcontent-%COMP%]   *[_ngcontent-%COMP%], .disable-animation[_ngcontent-%COMP%]:before, .disable-animation[_ngcontent-%COMP%]:after, .disable-animation[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:before, .disable-animation[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:after{animation:none!important;transition:none!important}.cell-bg[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;z-index:-1;border-radius:inherit}.cell-fade[_ngcontent-%COMP%]:before{transition:filter .5s ease-out,opacity .5s ease-out}.bg-muted[_ngcontent-%COMP%]{color:var(--mat-sys-on-surface-variant)}.bg-muted[_ngcontent-%COMP%]:before{background:var(--mat-sys-surface-variant)}.bg-muted.hidden.cell[_ngcontent-%COMP%]{box-shadow:0 0 calc(14cqmin / var(--columnCount)) 0 var(--mat-sys-surface-variant)}.color[_ngcontent-%COMP%]:before{background-color:var(--cellColor)}.color.hidden[_ngcontent-%COMP%]{box-shadow:0 0 calc(14cqmin / var(--columnCount)) 0 var(--cellColor)}.shape.shape-1[_ngcontent-%COMP%]:before{background:transparent;clip-path:polygon(50% 0%,100% 50%,50% 100%,0% 50%);background-color:var(--cellColor);border-radius:0}.shape.shape-2[_ngcontent-%COMP%]:before{background:transparent;clip-path:polygon(20% 0%,80% 0%,80% 20%,100% 20%,100% 80%,80% 80%,80% 100%,20% 100%,20% 80%,0% 80%,0% 20%,20% 20%);background-color:var(--cellColor);border-radius:0}.shape.shape-3[_ngcontent-%COMP%]:before{background:transparent;clip-path:polygon(50% 0%,0% 100%,100% 100%);background-color:var(--cellColor);border-radius:0}.shape.shape-4[_ngcontent-%COMP%]:before{background:transparent;clip-path:polygon(50% 0%,90% 20%,100% 60%,75% 100%,25% 100%,0% 60%,10% 20%);background-color:var(--cellColor);border-radius:0}.shape.shape-5[_ngcontent-%COMP%]:before{background:transparent;clip-path:polygon(50% 0%,100% 38%,82% 100%,18% 100%,0% 38%);background-color:var(--cellColor);border-radius:0}.shape.shape-6[_ngcontent-%COMP%]:before{background:transparent;clip-path:polygon(0% 0%,100% 0%,100% 75%,50% 100%,0% 75%);background-color:var(--cellColor);border-radius:0}.shape.shape-7[_ngcontent-%COMP%]:before{background:transparent;clip-path:polygon(20% 0%,80% 0%,100% 100%,0% 100%);background-color:var(--cellColor);border-radius:0}.shape.shape-8[_ngcontent-%COMP%]:before{background:transparent;clip-path:polygon(50% 0%,100% 25%,100% 75%,50% 100%,0% 75%,0% 25%);background-color:var(--cellColor);border-radius:0}.cell[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;aspect-ratio:1;border-radius:calc(6cqmin / var(--columnCount));width:calc((100cqmin - var(--_headerSpacing) - (var(--columnCount) - 2) * var(--_cellGap)) / var(--columnCount));--glowColor: var(--mat-sys-primary)}.cell.hidden[_ngcontent-%COMP%]:before{filter:blur(10px);opacity:0}.color[_ngcontent-%COMP%]{--glowColor: var(--cellColor)}.cell.glow-active[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:0;border-radius:inherit;pointer-events:none;border:calc(2cqmin / var(--columnCount)) solid rgba(255,255,255,.3);box-shadow:0 0 0 0 var(--glowColor);opacity:0;mix-blend-mode:screen;transform:scale(.9);transform-origin:center;animation:_ngcontent-%COMP%_sectionGlow .6s ease-out forwards}.cell.glow-active[data-glow-variant=row-header][_ngcontent-%COMP%]:after, .cell.glow-active[data-glow-variant=column-header][_ngcontent-%COMP%]:after, .cell.glow-active[data-glow-variant=group-header][_ngcontent-%COMP%]:after{border-color:#fff9;--glowColor: var(--mat-sys-primary)}.cell.glow-active[data-glow-variant=group-header][_ngcontent-%COMP%]:after{border-radius:calc(10cqmin / var(--columnCount))}.corner-number[_ngcontent-%COMP%]{position:absolute;font-size:calc(21cqmin / var(--columnCount));padding-left:calc(3.9cqmin / var(--columnCount));padding-right:calc(3.9cqmin / var(--columnCount));border-radius:calc(6cqmin / var(--columnCount));text-align:center}.super-label[_ngcontent-%COMP%]{font-size:.5em;vertical-align:.8em}.corner-number.left[_ngcontent-%COMP%]{left:0cqmin}.corner-number.right[_ngcontent-%COMP%]{right:0cqmin}.corner-number.top[_ngcontent-%COMP%]{top:0cqmin}.corner-number.bottom[_ngcontent-%COMP%]{bottom:0cqmin}.hidden[_ngcontent-%COMP%]   .corner-number[_ngcontent-%COMP%]{visibility:hidden}.main-number[_ngcontent-%COMP%]{font-size:calc(51cqmin / var(--columnCount));transition:filter .5s ease-out,opacity .5s ease-out}.main-number.cleared-text[_ngcontent-%COMP%]{filter:blur(5px);opacity:0}.circle[_ngcontent-%COMP%]{border:.5cqmin solid;border-radius:50%;width:calc(60cqmin / var(--columnCount));height:calc(60cqmin / var(--columnCount));display:flex;align-items:center;justify-content:center}.main-number.highlighted[_ngcontent-%COMP%]:before{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(45deg);width:calc(60cqmin / var(--columnCount));height:calc(60cqmin / var(--columnCount));pointer-events:none;z-index:1;box-sizing:border-box;background:transparent;border:calc(5cqmin / var(--columnCount)) solid red}.main-number.highlighted[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(45deg);width:calc(60cqmin / var(--columnCount));height:calc(60cqmin / var(--columnCount));pointer-events:none;z-index:2;box-sizing:border-box;background:transparent;border:calc(5cqmin / var(--columnCount)) dotted white}@keyframes _ngcontent-%COMP%_sectionGlow{0%{opacity:0;transform:scale(.9);box-shadow:0 0 0 0 var(--glowColor)}20%{opacity:.85}80%{opacity:.6;box-shadow:0 0 calc(40cqmin / var(--columnCount)) 0 var(--glowColor)}to{opacity:0;transform:scale(1.15);box-shadow:0 0 calc(54cqmin / var(--columnCount)) 0 transparent}}@keyframes _ngcontent-%COMP%_wiggle{0%,to{transform:rotate(0) translate(0)}10%{transform:rotate(14deg) translate(-5px)}30%{transform:rotate(-8deg) translate(5px)}50%{transform:rotate(4deg) translate(-3px)}70%{transform:rotate(-2deg) translate(3px)}90%{transform:rotate(1deg) translate(0)}}.wiggle[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_wiggle .8s ease-in-out}@keyframes _ngcontent-%COMP%_shrinkDashed{0%{transform:scale(2)}to{transform:scale(1)}}.processing[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:calc(10cqmin / var(--columnCount));border:calc(3cqmin / var(--columnCount)) dashed light-dark(rgb(0,106,255),rgba(0,200,255,.8));border-radius:50%;transform-origin:center;animation:_ngcontent-%COMP%_shrinkDashed 1s ease-out forwards;z-index:1}@keyframes _ngcontent-%COMP%_magnify-and-move{0%{transform:scale(1);box-shadow:none}30%{box-shadow:0 14px 28px #00000040,0 10px 10px #00000038}to{transform:scale(var(--scaleFactor)) translateY(calc(-60cqmin / var(--columnCount))) translate(var(--moveX));box-shadow:0 14px 28px #00000040,0 10px 10px #00000038}}.magnifier-view[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:1000;pointer-events:none;display:flex;align-items:center;justify-content:center}.magnifier-view[_ngcontent-%COMP%]   .cell[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_magnify-and-move .15s ease-out forwards;flex:0 0 auto;background-color:var(--mat-sys-background)}']})};var pt=class o{static LOG_ENABLED=!1;static evaluate(e){let t=performance.now(),i=Array.from({length:e.length},()=>new $e),r=Array.from({length:e[0].length},()=>new $e),n=new Map,a=new Map;for(let y=0;y<e.length;y++)for(let C=0;C<e[y].length;C++){let x=e[y][C],M=n.get(x.groupNumber);M||(M=new $e,n.set(x.groupNumber,M));let $=M.values.length;M.values.push(x.value),(a.get(x.groupNumber)??(a.set(x.groupNumber,[]),a.get(x.groupNumber))).push({r:y,c:C}),i[y].values[C]=x.value,r[C].values[y]=x.value,x.required&&(i[y].requiredIndices.push(C),i[y].goalSum+=x.value,r[C].requiredIndices.push(y),r[C].goalSum+=x.value,M.requiredIndices.push($),M.goalSum+=x.value)}let s=0,l=i.map((y,C)=>{let x=o.countSubsets(y.values,y.goalSum);return s+=x.totalIterations,o.GenerateSectionStats(y,C,x)}),c=r.map((y,C)=>{let x=o.countSubsets(y.values,y.goalSum);return s+=x.totalIterations,o.GenerateSectionStats(y,C,x)}),d=Array.from(n.keys()).sort((y,C)=>y-C),u=d.map(y=>{let C=n.get(y),x=o.countSubsets(C.values,C.goalSum);return s+=x.totalIterations,o.GenerateSectionStats(C,y,x)}),{iterations:f,unresolved:m,unresolvedCountsPerIteration:h}=o.iterativeDeduction(e,i,r,d,n,a),v={rows:l,columns:c,groups:u,totals:{rowsEvaluated:e.length,columnsEvaluated:e[0].length,groupsEvaluated:d.length,subsetsEvaluated:s,deductionIterations:f,unresolvedCellCountAfterDeduction:m,unresolvedCountsPerIteration:h}};return this.LOG_ENABLED&&console.log("Board stat analysis ",performance.now()-t),v}static GenerateSectionStats(e,t,i){return{index:t,goalSum:e.goalSum,cellValues:e.values.slice(),requiredIndices:e.requiredIndices.slice(),firstIterationFalsePositiveSolutionCount:i.exact-1,firstIterationGuaranteedRequiredCellCount:i.alwaysRequiredCount,firstIterationGuaranteedUnusableCellCount:i.neverUsedCount,firstIterationGuaranteedRequiredCellCountVsGoalSum:i.alwaysRequiredCount/e.goalSum,firstIterationGuaranteedUnusableCellCountVsGoalSum:i.neverUsedCount/e.goalSum,goalVsTotal:e.goalSum/e.values.reduce((r,n)=>r+n,0)}}static countSubsets(e,t){let i=e.length,r=1<<i,n=0,a=(1<<i)-1,s=0;for(let d=0;d<r;d++){let u=0;for(let f=0;f<i;f++)d&1<<f&&(u+=e[f]);u===t&&(n++,a&=d,s|=d)}let l=o.popCount(a&(1<<i)-1),c=i-o.popCount(s&(1<<i)-1);return n===0?{exact:n,totalIterations:r,alwaysRequiredCount:0,neverUsedCount:0}:{exact:n,totalIterations:r,alwaysRequiredCount:l,neverUsedCount:c}}static popCount(e){return e=e>>>0,e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),(e+(e>>>4)&252645135)*16843009>>>24}static deduceForSection(e,t,i){let r=0;for(let h=0;h<e.length;h++)t[h]===1&&(r+=e[h]);let n=i-r;if(n<0)return{selectIdxs:[],clearIdxs:[]};let a=[];for(let h=0;h<e.length;h++)t[h]===0&&a.push(h);if(n===0)return{selectIdxs:[],clearIdxs:a};let s=a.length;if(s===0)return{selectIdxs:[],clearIdxs:[]};let l=1<<s,c=0,d=(1<<s)-1,u=0;for(let h=0;h<l;h++){let v=0;for(let y=0;y<s;y++)h&1<<y&&(v+=e[a[y]]);v===n&&(c++,d&=h,u|=h)}if(c===0)return{selectIdxs:[],clearIdxs:[]};let f=[],m=[];for(let h=0;h<s;h++){let v=a[h],y=(d&1<<h)!==0,C=(u&1<<h)===0;y&&f.push(v),C&&m.push(v)}return{selectIdxs:f,clearIdxs:m}}static iterativeDeduction(e,t,i,r,n,a){let s=e.length,l=e[0].length,c=Array.from({length:s},()=>new Array(l).fill(0)),d=[],u=0;for(;;){let m=!1;for(let v=0;v<s;v++){let y=c[v].slice(),{selectIdxs:C,clearIdxs:x}=o.deduceForSection(t[v].values,y,t[v].goalSum);for(let M of C)c[v][M]!==1&&(c[v][M]=1,m=!0);for(let M of x)c[v][M]!==2&&(c[v][M]=2,m=!0)}for(let v=0;v<l;v++){let y=new Array(s);for(let M=0;M<s;M++)y[M]=c[M][v];let{selectIdxs:C,clearIdxs:x}=o.deduceForSection(i[v].values,y,i[v].goalSum);for(let M of C)c[M][v]!==1&&(c[M][v]=1,m=!0);for(let M of x)c[M][v]!==2&&(c[M][v]=2,m=!0)}for(let v of r){let y=a.get(v),C=n.get(v),x=y.map(({r:I,c:z})=>c[I][z]),{selectIdxs:M,clearIdxs:$}=o.deduceForSection(C.values,x,C.goalSum);for(let I of M){let{r:z,c:q}=y[I];c[z][q]!==1&&(c[z][q]=1,m=!0)}for(let I of $){let{r:z,c:q}=y[I];c[z][q]!==2&&(c[z][q]=2,m=!0)}}let h=0;for(let v=0;v<s;v++)for(let y=0;y<l;y++)c[v][y]===0&&h++;if(d.push(h),!m)break;u++}let f=0;for(let m=0;m<s;m++)for(let h=0;h<l;h++)c[m][h]===0&&f++;return{iterations:u,unresolved:f,unresolvedCountsPerIteration:d}}},$e=class{values=[];requiredIndices=[];goalSum=0};var bi={keys:["boardSize","firstIterationUnusableCellCountVsGoalAllSum","deductionIterations","percentUnresolvedCellsAfterDeduction","percentUnresolvedCellsAfterDeductionI2","gameDateAsPercent","percentUnresolvedCellsAfterDeductionI4","percentUnresolvedCellsAfterDeductionI5","goalSumAllMean","goalSumAllMax","firstIterationActionableCellAllCountMin","cellCountLargerThanTargetAllStd","firstIterationUnusableCellCountVsGoalAllStd","goalSumAllStd","firstIterationGuaranteedRequiredCellCountMax","firstIterationFalsePositiveSolutionCountAllMin","firstIterationGuaranteedRequiredCellCountStd","firstIterationUnusableCellCountVsGoalAllMax","cellCountLargerThanTargetAllSum","firstIterationRequiredCellCountVsGoalAllStd"]};function vi(o,e){let t=M=>{let $=M.length||1,I=0,z=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY;for(let k=0;k<M.length;k++){let H=M[k];I+=H,H<z&&(z=H),H>q&&(q=H)}M.length||(z=0,q=0);let g=I/$,S=0;for(let k=0;k<M.length;k++){let H=M[k]-g;S+=H*H}let A=Math.sqrt(S/$);return{mean:g,min:z,max:q,std:A,sum:I}},i=[...o.rows,...o.columns,...o.groups],r=t(i.map(M=>M.cellValues.filter($=>$>M.goalSum).length)),n=t(i.map(M=>M.firstIterationFalsePositiveSolutionCount)),a=t(i.map(M=>M.firstIterationGuaranteedRequiredCellCount)),s=t(i.map(M=>M.firstIterationGuaranteedUnusableCellCount)),l=t(i.map(M=>M.firstIterationGuaranteedRequiredCellCountVsGoalSum)),c=t(i.map(M=>M.firstIterationGuaranteedUnusableCellCountVsGoalSum)),d=t(i.map(M=>M.firstIterationGuaranteedRequiredCellCount+M.firstIterationGuaranteedUnusableCellCount)),u=t(i.map(M=>M.goalSum)),f=t(i.map(M=>M.goalVsTotal)),m=o.totals.rowsEvaluated,h=m*m,y={boardSize:(Math.pow(m,2)-Math.pow(5,2))/(Math.pow(9,2)-Math.pow(5,2)),firstIterationFalsePositiveSolutionCountAllMean:n.mean,firstIterationFalsePositiveSolutionCountAllMin:n.min/Math.pow(2,m),firstIterationFalsePositiveSolutionCountAllMax:n.max/Math.pow(2,m),firstIterationFalsePositiveSolutionCountAllStd:n.std,firstIterationFalsePositiveSolutionCountAllSum:n.sum/(Math.pow(2,m)*3),firstIterationGuaranteedRequiredCellCountMean:a.mean/m,firstIterationGuaranteedRequiredCellCountMin:a.min/m,firstIterationGuaranteedRequiredCellCountMax:a.max/m,firstIterationGuaranteedRequiredCellCountStd:a.std/m,firstIterationGuaranteedRequiredCellCountSum:a.sum/m/3,firstIterationGuaranteedUnusableCellCountAllMean:s.mean/m,firstIterationGuaranteedUnusableCellCountAllMin:s.min/m,firstIterationGuaranteedUnusableCellCountAllMax:s.max/m,firstIterationGuaranteedUnusableCellCountAllStd:s.std/m,firstIterationGuaranteedUnusableCellCountAllSum:s.sum/m/3,firstIterationActionableCellAllCountMean:d.mean/m,firstIterationActionableCellAllCountMin:d.min/m,firstIterationActionableCellAllCountMax:d.max/m,firstIterationActionableCellAllCountStd:d.std/m,firstIterationActionableCellAllCountSum:d.sum/m/3,firstIterationRequiredCellCountVsGoalAllMean:l.mean,firstIterationRequiredCellCountVsGoalAllMin:l.min,firstIterationRequiredCellCountVsGoalAllMax:l.max,firstIterationRequiredCellCountVsGoalAllStd:l.std,firstIterationRequiredCellCountVsGoalAllSum:l.sum,firstIterationUnusableCellCountVsGoalAllMean:c.mean,firstIterationUnusableCellCountVsGoalAllMin:c.min,firstIterationUnusableCellCountVsGoalAllMax:c.max,firstIterationUnusableCellCountVsGoalAllStd:c.std,firstIterationUnusableCellCountVsGoalAllSum:c.sum,goalSumAllMean:u.mean/m,goalSumAllMin:u.min/m,goalSumAllMax:u.max/m,goalSumAllStd:u.std/m,goalSumAllSum:u.sum/m/3,cellCountLargerThanTargetAllMean:r.mean/m,cellCountLargerThanTargetAllMin:r.min/m,cellCountLargerThanTargetAllMax:r.max/m,cellCountLargerThanTargetAllStd:r.std/m,cellCountLargerThanTargetAllSum:r.sum/m/3,goalVsTotalAllMean:f.mean,goalVsTotalAllMin:f.min,goalVsTotalAllMax:f.max,goalVsTotalAllStd:f.std,goalVsTotalAllSum:f.sum,deductionIterations:o.totals.deductionIterations,unresolvedCellCountAfterDeduction:o.totals.unresolvedCellCountAfterDeduction,percentUnresolvedCellsAfterDeduction:o.totals.unresolvedCellCountAfterDeduction/h,percentUnresolvedCellsAfterDeductionI1:(o.totals.unresolvedCountsPerIteration[0]??0)/h,percentUnresolvedCellsAfterDeductionI2:(o.totals.unresolvedCountsPerIteration[1]??0)/h,percentUnresolvedCellsAfterDeductionI3:(o.totals.unresolvedCountsPerIteration[2]??0)/h,percentUnresolvedCellsAfterDeductionI4:(o.totals.unresolvedCountsPerIteration[3]??0)/h,percentUnresolvedCellsAfterDeductionI5:(o.totals.unresolvedCountsPerIteration[4]??0)/h,gameDateAsPercent:e.gameDateAsPercent,breaksMinutes:e.breaksMinutes/m},C={gameNumber:e.gameNumber},x={timeSpent:e.timeSpent};return we(we(we({},y),C),x)}function yi(o,e=bi.keys){if(o.timeSpent==null)return;let t=e.map(i=>o[i]);if(!t.some(i=>typeof i!="number"||Number.isNaN(i)))return{gameNumber:o.gameNumber,boardSize:o.boardSize,features:t,target:o.timeSpent}}function Ci(o,e,t){let i=e.features.map((n,a)=>(n-o.featureMeans[a])/(o.featureStds[a]||1)),r=o.weights[0];for(let n=0;n<i.length;n++)r+=o.weights[n+1]*i[n];return o.transform==="log1p"?r=Math.max(0,Math.expm1(r)):t?.allowNegative||(r=Math.max(0,r)),r}var ht=class o{constructor(e){this.generator=e}static generatorCache=new Map;static loadingCache=new Map;LOG_GENERATION_TIME=!1;static create(e,t=1){return P(this,null,function*(){let i=yield o.loadGenerator(t);return new o(new i(e))})}generateRandomContiguousGroups(e){let t=performance.now(),i=this.generator.generateRandomContiguousGroups(e);return this.LOG_GENERATION_TIME&&console.log("Board grouping generation time",performance.now()-t),i}static loadGenerator(e){return P(this,null,function*(){let t=o.generatorCache.get(e);if(t)return t;let i=o.loadingCache.get(e);return i||(i=o.fetchGeneratorCtor(e).then(r=>(o.generatorCache.set(e,r),r)).finally(()=>{o.loadingCache.delete(e)}),o.loadingCache.set(e,i)),i})}static fetchGeneratorCtor(e){return P(this,null,function*(){switch(e){case 1:return(yield import("./chunk-GMLM6Z2Q.js")).BoardGroupGeneratorV1;case 2:return(yield import("./chunk-CMYPBZHK.js")).BoardGroupGeneratorV2;default:throw new Error("Illegal version")}})}};function Si(o,e=1){return P(this,null,function*(){let t=Te.generateFromSeed(o)*Number.MAX_SAFE_INTEGER,i=o+87228,r=5,a=Math.floor(Te.generateFromSeed(i)*(9-r+1)+r),l=(yield ht.create(o,e)).generateRandomContiguousGroups(a),c=new Te(t),d=new me;return d.playArea=l.map(u=>u.map(f=>{let m=new ce;return m.value=Math.floor(c.next()*9)+1,m.groupNumber=f,m.required=c.next()<.4,m})),d.constructBoard(o),d})}var Oe=class o{cache=new Map;generateOrGetGameBoard(e){return P(this,null,function*(){let t=this.cache.get(e);t||(t=(yield Si(e)).playArea.map(r=>r.map(n=>({groupNumber:n.groupNumber,required:n.required,value:n.value}))),this.cache.set(e,t));let i=new me;return i.playArea=t.map(r=>r.map(n=>{let a=new ce;return a.groupNumber=n.groupNumber,a.required=n.required,a.value=n.value,a})),i.constructBoard(e),i})}static \u0275fac=function(t){return new(t||o)};static \u0275prov=W({token:o,factory:o.\u0275fac,providedIn:"root"})};var Fe=class o{constructor(e,t){this.http=e;this.cachingBoardGenerator=t}packagedModelPromise;timesPromise;predictGameModel(e){return P(this,null,function*(){try{let t=yield this.loadPackagedModel();return!t||t.modelType==="baseline"?void 0:Ci(t,e)}catch(t){console.warn("TimePredictorService.predictFromPackaged failed",t);return}})}getDifficultyEstimates(e){return P(this,null,function*(){let t;if(typeof e=="number"?t=(yield this.cachingBoardGenerator.generateOrGetGameBoard(e)).playArea:t=e,!t||t.length===0)return;let i=pt.evaluate(t),r=i.totals.unresolvedCellCountAfterDeduction,n=Math.pow(i.totals.rowsEvaluated,2)-r,s=yi(vi(i,{timeSpent:0,gameNumber:0,gameDateAsPercent:1,breaksMinutes:0})),l=yield this.predictGameModel(s),c=yield this.getPercentile(l);return{estimatedSolveTime:l,percentile:c,firstPrincipalUnResoledCellCount:r,firstPrincipalResolvableCellCount:n}})}getPercentile(e){return P(this,null,function*(){let t=yield this.loadPredictedSolveTimesList();if(!t||t.length===0)return;let i=t.length,r=0,n=i;for(;r<n;){let s=r+n>>>1;t[s]<=e?r=s+1:n=s}return r/i})}loadPackagedModel(){return P(this,null,function*(){return this.packagedModelPromise||(this.packagedModelPromise=Ve(this.http.get("difficulty-ml-model.json")).catch(e=>{console.warn("TimePredictorService: failed to load packaged model",e)})),this.packagedModelPromise})}loadPredictedSolveTimesList(){return P(this,null,function*(){return this.timesPromise||(this.timesPromise=Ve(this.http.get("difficulty-ml-predicted-times.json")).then(e=>{if(!Array.isArray(e))return;let t=e.filter(i=>Number.isFinite(i));return t.sort((i,r)=>i-r),t}).catch(e=>{console.warn("EstimatedDifficultyComponent: failed to load times",e)})),this.timesPromise})}static \u0275fac=function(t){return new(t||o)(J(ii),J(Oe))};static \u0275prov=W({token:o,factory:o.\u0275fac,providedIn:"root"})};function $i(o,e){if(o&1&&(b(0,"span"),p(1,"\u2022"),T(),b(2,"span")(3,"mat-icon",2),p(4,"report_problem"),T(),b(5,"span"),p(6),T()()),o&2){let t=_();w(6),ie(t.firstPrincipalViolationWarning)}}var gt=class o{constructor(e){this.predictor=e}playArea;gameNumber;percentileLabel="\u2013";estimatedTimeLabel="\u2013";firstPrincipalViolationWarning="";ngOnChanges(e){return P(this,null,function*(){("playArea"in e||"gameNumber"in e)&&(yield this.updatePrediction())})}updatePrediction(){return P(this,null,function*(){this.firstPrincipalViolationWarning="",this.percentileLabel="-",this.estimatedTimeLabel="-";try{let e;if(this.playArea&&this.playArea.length>0?e=yield this.predictor.getDifficultyEstimates(this.playArea):this.gameNumber!=null&&(e=yield this.predictor.getDifficultyEstimates(this.gameNumber)),!e)return;e.firstPrincipalUnResoledCellCount>0&&(this.firstPrincipalViolationWarning=`FP+ ${e.firstPrincipalUnResoledCellCount}-${e.firstPrincipalResolvableCellCount}`),this.percentileLabel=`${(e.percentile*100).toFixed(1)}`,this.estimatedTimeLabel=this.formatMs(e.estimatedSolveTime)}catch(e){console.warn("Prediction failed",e)}})}formatMs(e){let t=Math.max(0,Math.round(e/1e3)),i=Math.floor(t/3600),r=Math.floor(t%3600/60),n=t%60,a=r.toString().padStart(2,"0"),s=n.toString().padStart(2,"0");return`${i}:${a}:${s}`}static \u0275fac=function(t){return new(t||o)(G(Fe))};static \u0275cmp=Q({type:o,selectors:[["app-estimated-difficulty"]],inputs:{playArea:"playArea",gameNumber:"gameNumber"},features:[Je],decls:13,vars:3,consts:[[1,"estimated-difficulty"],[1,"row"],[1,"warning-icon"]],template:function(t,i){t&1&&(b(0,"div",0)(1,"div",1)(2,"strong"),p(3,"Difficulty"),T(),b(4,"span"),p(5),T(),O(6,$i,7,1),b(7,"span"),p(8,"\u2022"),T(),b(9,"strong"),p(10,"Par Time"),T(),b(11,"span"),p(12),T()()()),t&2&&(w(5),ie(i.percentileLabel),w(),F(i.firstPrincipalViolationWarning?6:-1),w(6),ie(i.estimatedTimeLabel))},dependencies:[pe,se,le,Be],styles:[".estimated-difficulty[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;font-size:.95rem}.estimated-difficulty[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex;align-items:baseline;gap:6px}.warning-icon[_ngcontent-%COMP%]{color:light-dark(#ee0000,#ff3a3a);font-size:1em;height:unset;width:unset;margin-bottom:-.15em;margin-right:.2em;margin-left:.1em}"]})};var vt=class o{verticalMode=!1;resetValue=10;minValue=1;value=this.resetValue;resizeObserver;constructor(){}ngAfterViewInit(){}ngOnDestroy(){this.resizeObserver?.disconnect()}increment(){this.value+=1}decrement(){this.value<=this.minValue||(this.value-=1)}reset(){this.value=this.resetValue}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=Q({type:o,selectors:[["app-scratch-pad"]],inputs:{verticalMode:"verticalMode"},decls:14,vars:4,consts:[["role","group","aria-label","Scratch pad controls",1,"scratch-pad"],["mat-mini-fab","","type","button","aria-label","Decrease scratch pad value",1,"scratch-pad__button","scratch-pad__button--decrease",3,"click","disabled"],["aria-live","polite",1,"scratch-pad__display","no-select",3,"dblclick"],[1,"scratch-pad__label","big"],[1,"scratch-pad__label","small"],[1,"scratch-pad__value"],["mat-mini-fab","","type","button","aria-label","Increase scratch pad value",1,"scratch-pad__button","scratch-pad__button--increase",3,"click"]],template:function(t,i){t&1&&(b(0,"div",0)(1,"button",1),U("click",function(){return i.decrement()}),b(2,"mat-icon"),p(3,"do_not_disturb_on"),T()(),b(4,"div",2),U("dblclick",function(){return i.reset()}),b(5,"div",3),p(6,"Scratch Pad"),T(),b(7,"div",4),p(8,"S-Pad"),T(),b(9,"div",5),p(10),T()(),b(11,"button",6),U("click",function(){return i.increment()}),b(12,"mat-icon"),p(13,"add_circle"),T()()()),t&2&&(K("vertical-mode",i.verticalMode),w(),X("disabled",i.value<=i.minValue),w(9),ie(i.value))},dependencies:[he,ge,be,le,Be,se,it,ve,ye,Ce],styles:["[_nghost-%COMP%]{display:inline-block;max-width:100%}.scratch-pad[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:6px;flex-wrap:wrap;padding:3px 6px;border-radius:12px;background:linear-gradient(145deg,var(--mat-sys-surface-container-high),var(--mat-sys-surface-container-highest));box-shadow:inset 0 1px #ffffff12}.scratch-pad__button[_ngcontent-%COMP%]{flex:0 0 auto}.scratch-pad__display[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-width:60px;padding:3px 8px 5px;border-radius:10px;background:var(--mat-sys-surface);box-shadow:0 4px 12px #0000001f}.scratch-pad__label[_ngcontent-%COMP%]{font-size:.65rem;letter-spacing:.08em;text-transform:uppercase;color:var(--mat-sys-on-surface-variant);margin-bottom:1px}.small[_ngcontent-%COMP%]{display:none}.scratch-pad__value[_ngcontent-%COMP%]{font-size:1.4em;font-weight:600;color:var(--mat-sys-primary);line-height:1}.vertical-mode.scratch-pad[_ngcontent-%COMP%]{flex-direction:column;align-items:center;gap:6px}.vertical-mode.scratch-pad[_ngcontent-%COMP%]   .scratch-pad__label.big[_ngcontent-%COMP%]{display:none}.vertical-mode.scratch-pad[_ngcontent-%COMP%]   .scratch-pad__label.small[_ngcontent-%COMP%]{display:unset}.vertical-mode.scratch-pad[_ngcontent-%COMP%]   .scratch-pad__button--increase[_ngcontent-%COMP%]{order:0}.vertical-mode.scratch-pad[_ngcontent-%COMP%]   .scratch-pad__display[_ngcontent-%COMP%]{order:1;align-self:center;padding:3px 0 5px}.vertical-mode.scratch-pad[_ngcontent-%COMP%]   .scratch-pad__button--decrease[_ngcontent-%COMP%]{order:2}"]})};var yt=class o{transform(e){let t=typeof e=="number"&&isFinite(e)&&e>0?Math.floor(e):0,i=Math.floor(t/1e3),r=i%60,n=Math.floor(i/60),a=n%60,s=Math.floor(n/60),l=c=>c<10?"0"+c:""+c;return`${s}:${l(a)}:${l(r)}`}static \u0275fac=function(t){return new(t||o)};static \u0275pipe=Qt({name:"duration",type:o,pure:!0})};function Wi(o,e){o&1&&He(0,"div",7)}function Xi(o,e){if(o&1&&(E(0,"div",16)(1,"div",17)(2,"span"),p(3,"9"),D(),E(4,"span"),p(5,"8"),D(),E(6,"span"),p(7,"7"),D(),E(8,"span"),p(9,"6"),D(),E(10,"span"),p(11,"5"),D(),E(12,"span"),p(13,"4"),D(),E(14,"span"),p(15,"3"),D(),E(16,"span"),p(17,"2"),D(),E(18,"span"),p(19,"1"),D(),E(20,"span"),p(21,"0"),D()()()),o&2){let t=e.$implicit;w(),Zt(Ke("--from-digit: ",t,";"))}}function Ji(o,e){if(o&1&&(E(0,"div",15),Ee(1,Xi,22,3,"div",16,Ae),D()),o&2){let t=_();Ye(t.streakAnimationClass),K("slide-up",t.isSlidingUp),w(),De(t.previousStreakDigits)}}function Qi(o,e){if(o&1&&(E(0,"span",5),p(1),D()),o&2){let t=_();Ye(t.streakAnimationClass),w(),j(" ",t.streak," ")}}function Zi(o,e){if(o&1&&He(0,"div",18),o&2){let t=e.$implicit;de("left",t.left)("animation-delay",t.animationDelay)}}function Ki(o,e){if(o&1){let t=te();E(0,"div",19),Re("click",function(){R(t);let r=_();return B(r.cycleBestStreakWindow())}),E(1,"span",2)(2,"span",3),p(3),D(),E(4,"span",4),p(5),D()(),E(6,"span",5)(7,"span",13),p(8,"\u2039"),D(),p(9),E(10,"span",14),p(11,"\u203A"),D()()()}if(o&2){let t=_();w(3),j(" Best Streak ",t.displayedStreak.displayTimelineFull," "),w(2),j(" Best Strk ",t.displayedStreak.displayTimelineAbbreviated," "),w(4),j(" ",t.displayedStreak.streak," ")}}function er(o,e){if(o&1&&(p(0),je(1,"number")),o&2){let t=_();j(" Last ",et(1,1,t.accuracyHistory,"1.0-0")," Moves ")}}function tr(o,e){o&1&&p(0," Time Spent ")}function ir(o,e){if(o&1&&(p(0),je(1,"number")),o&2){let t=_();j(" ",et(1,1,t.accuracyHistory,"1.0-0")," Moves ")}}function rr(o,e){o&1&&p(0," Time ")}function nr(o,e){if(o&1&&(p(0),je(1,"number")),o&2){let t=_();j(" ",t.accuracy!=null?et(1,1,t.accuracy,"1.1-2")+"%":"\u2014"," ")}}function or(o,e){if(o&1&&(p(0),je(1,"duration")),o&2){let t=_();j(" ",Kt(1,1,t.currentStats==null?null:t.currentStats.timeSpent)," ")}}var Ct=class o{constructor(e){this.settingsService=e}set stats(e){this.updateStats(e)}mistakes=0;streak=0;accuracy=null;accuracyHistory;displayedStreak;secondaryDisplayIndex=0;currentStats;streakAnimationClass="";tears=[];isCountingDown=!1;isSlidingUp=!1;previousStreakDigits=[];showRedOrb=!1;displayedStreakIndex=0;updateStats(e){if(e&&(this.currentStats=e,this.mistakes=e.mistakesCurrentBoard,this.streak=e.currentStreak,this.accuracy=e.accuracyPercent,this.accuracyHistory=e.accuracyHistoryMoveCount,this.updateDisplayedStreak(),e.previousStreak>0&&e.currentStreak===0)){this.isCountingDown=!0,this.previousStreakDigits=e.previousStreak.toString().split("").map(Number),setTimeout(()=>{this.isCountingDown=!1,e.previousStreak>=10&&(this.isSlidingUp=!0,setTimeout(()=>{this.isSlidingUp=!1},500))},2e3),e.previousStreak>=300?this.streakAnimationClass="sad-3":e.previousStreak>=40?this.streakAnimationClass="sad-2":this.streakAnimationClass="sad-1",e.previousStreak>20&&(this.showRedOrb=!0,setTimeout(()=>{this.showRedOrb=!1},1500)),this.tears=[];let t=1+Math.floor(e.previousStreak/50);for(let a=0;a<t;a++){let s=a%2===0?"calc(50% - 20px)":"calc(50% + 20px)",l=`${a*.2}s`;this.tears.push({left:s,animationDelay:l})}let n=1e3+(t-1)*200+1500;setTimeout(()=>{this.streakAnimationClass="",this.tears=[]},n)}}ngOnInit(){this.displayedStreakIndex=this.settingsService.getBestStreakDisplay(),this.secondaryDisplayIndex=this.settingsService.getStatsSecondaryDisplay(),this.updateDisplayedStreak()}cycleBestStreakWindow(){this.displayedStreakIndex=(this.displayedStreakIndex+1)%this.currentStats.streaks.length,this.settingsService.setBestStreakDisplay(this.displayedStreakIndex),this.updateDisplayedStreak()}updateDisplayedStreak(){this.currentStats&&(this.displayedStreak=this.currentStats.streaks[this.displayedStreakIndex%this.currentStats.streaks.length])}cycleSecondaryMetric(){this.secondaryDisplayIndex=(this.secondaryDisplayIndex+1)%2,this.settingsService.setStatsSecondaryDisplay(this.secondaryDisplayIndex)}static \u0275fac=function(t){return new(t||o)(G(Le))};static \u0275cmp=Q({type:o,selectors:[["app-stats"]],inputs:{stats:"stats"},decls:37,vars:7,consts:[[1,"stat-container"],[1,"stat-item"],[1,"stat-label"],[1,"label-full"],[1,"label-short"],[1,"stat-value"],[1,"streak-value-wrapper"],[1,"red-orb"],[1,"stat-value","streak-countdown",3,"slide-up","class"],[1,"stat-value",3,"class"],[1,"tear",3,"left","animation-delay"],["title","Change period",1,"stat-item","clickable"],["title","Change metric",1,"stat-item","clickable",3,"click"],["aria-hidden","true",1,"cycle-icon","left"],["aria-hidden","true",1,"cycle-icon","right"],[1,"stat-value","streak-countdown"],[1,"digit-roller"],[1,"digit-roller-inner"],[1,"tear"],["title","Change period",1,"stat-item","clickable",3,"click"]],template:function(t,i){t&1&&(E(0,"div",0)(1,"div",1)(2,"span",2)(3,"span",3),p(4,"Board Mistakes"),D(),E(5,"span",4),p(6,"Mstks"),D()(),E(7,"span",5),p(8),D()(),E(9,"div",1)(10,"span",2)(11,"span",3),p(12,"Streak"),D(),E(13,"span",4),p(14,"Strk"),D()(),E(15,"div",6),O(16,Wi,1,0,"div",7),O(17,Ji,3,4,"div",8)(18,Qi,2,3,"span",9),Ee(19,Zi,1,4,"div",10,Ae),D()(),O(21,Ki,12,3,"div",11),E(22,"div",12),Re("click",function(){return i.cycleSecondaryMetric()}),E(23,"span",2)(24,"span",3),O(25,er,2,4)(26,tr,1,0),D(),E(27,"span",4),O(28,ir,2,4)(29,rr,1,0),D()(),E(30,"span",5)(31,"span",13),p(32,"\u2039"),D(),O(33,nr,2,4)(34,or,2,3),E(35,"span",14),p(36,"\u203A"),D()()()()),t&2&&(w(8),ie(i.mistakes),w(8),F(i.showRedOrb?16:-1),w(),F(i.isCountingDown||i.isSlidingUp?17:18),w(2),De(i.tears),w(2),F(i.displayedStreak?21:-1),w(4),F(i.secondaryDisplayIndex===0?25:26),w(3),F(i.secondaryDisplayIndex===0?28:29),w(5),F(i.secondaryDisplayIndex===0?33:34))},dependencies:[pe,ti,yt],styles:[".stat-container[_ngcontent-%COMP%]{display:flex;gap:20px;padding:10px 20px;background-color:light-dark(rgba(0,0,0,.05),rgba(255,255,255,.1));border-radius:12px;margin-left:6px;margin-right:6px}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.stat-item.clickable[_ngcontent-%COMP%]{cursor:pointer}.stat-label[_ngcontent-%COMP%]{font-size:.8em;color:light-dark(rgba(0,0,0,.6),rgba(255,255,255,.7));text-transform:uppercase;letter-spacing:.5px;height:2.2em;line-height:1.1em;display:flex;align-items:center;justify-content:center;text-align:center}.label-short[_ngcontent-%COMP%]{display:none}@media (max-width: 410px){.stat-label[_ngcontent-%COMP%]   .label-short[_ngcontent-%COMP%]{display:inline}.stat-label[_ngcontent-%COMP%]   .label-full[_ngcontent-%COMP%]{display:none}}.stat-item.clickable[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px}.cycle-icon[_ngcontent-%COMP%]{font-size:.9em;line-height:1;color:light-dark(rgba(0,0,0,.5),rgba(255,255,255,.6));transition:transform .12s ease,opacity .12s ease;opacity:.6}.stat-item.clickable[_ngcontent-%COMP%]:hover   .cycle-icon.left[_ngcontent-%COMP%]{transform:translate(-1px);opacity:.85}.stat-item.clickable[_ngcontent-%COMP%]:hover   .cycle-icon.right[_ngcontent-%COMP%]{transform:translate(1px);opacity:.85}.stat-value[_ngcontent-%COMP%]{font-size:1.5em;font-weight:700}@keyframes _ngcontent-%COMP%_sad-1-animation{50%{transform:scale(1.3);color:#f44}to{transform:scale(1)}}@keyframes _ngcontent-%COMP%_sad-2-animation{50%{transform:rotate(-10deg) scale(1.4);color:#f44}to{transform:rotate(0) scale(1)}}@keyframes _ngcontent-%COMP%_sad-3-animation{50%{transform:translateY(20px) scale(.8);opacity:0;color:#f44}51%{transform:translateY(-20px) scale(.8);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}.sad-1[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_sad-1-animation .6s ease-in-out}.sad-2[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_sad-2-animation .7s ease-in-out}.sad-3[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_sad-3-animation .7s ease-in-out}.streak-value-wrapper[_ngcontent-%COMP%]{position:relative;text-align:center}.streak-countdown[_ngcontent-%COMP%]{display:flex;justify-content:center;line-height:1}.digit-roller[_ngcontent-%COMP%]{height:1.05em;overflow:hidden}.digit-roller-inner[_ngcontent-%COMP%]{--digit-height: 1.05em;--from-digit-reversed: calc(9 - var(--from-digit));transform:translateY(calc(var(--from-digit-reversed) * var(--digit-height) * -1));animation:_ngcontent-%COMP%_roll-up-to-zero 2s ease-in-out forwards}.digit-roller-inner[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;height:var(--digit-height);line-height:var(--digit-height)}@keyframes _ngcontent-%COMP%_roll-up-to-zero{0%{transform:translateY(calc(var(--from-digit-reversed) * var(--digit-height) * -1))}to{transform:translateY(calc(9 * var(--digit-height) * -1))}}.red-orb[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;width:5em;height:5em;background:radial-gradient(circle,transparent 50%,red 70%,rgba(255,0,0,0) 80%);border-radius:50%;animation:_ngcontent-%COMP%_radiate-in 1.5s ease-out forwards;transform:translate(-50%,-50%)}@keyframes _ngcontent-%COMP%_radiate-in{0%{transform:translate(-50%,-50%) scale(3);opacity:0}50%{opacity:1}to{transform:translate(-50%,-50%) scale(1);opacity:0}}.streak-countdown.slide-up[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-up-and-fade .5s ease-in forwards}@keyframes _ngcontent-%COMP%_slide-up-and-fade{0%{transform:translateY(0);opacity:1}to{transform:translateY(-1em);opacity:0}}.tear[_ngcontent-%COMP%]{position:absolute;top:5px;width:4px;height:8px;background-color:#66b3ff;border-radius:50%;opacity:0;animation:_ngcontent-%COMP%_fall 1.5s ease-in forwards}@keyframes _ngcontent-%COMP%_fall{0%{transform:translateY(0);opacity:0}20%{opacity:1}to{transform:translateY(40px);opacity:0}}"]})};var xe=class{static COLORS_DARK=["#943501","#50322d","#817d00","#1b5e20","#0062af","#282a93","#540dab","#9e0b91","#840046"];static COLORS_LIGHT=["#ff8f8f","#ffad63","#fff67d","#91d594","#4beff5","#62acf6","#a0a7c7","#e8acff","#ff55cd"]};var St=class{constructor(e,t){this.ngZone=e;this.onStateChange=t;this.ngZone.runOutsideAngular(()=>{window.addEventListener("resize",this.handleWindowResize)})}layoutMode="vertical";boardHorizontalOffset=0;scratchPadInlineGap=12;scratchPadSideGap=16;resizeObserver;measurementScheduled=!1;boardSection;boardContainer;scratchContainer;scratchMeasureHorizontal;scratchMeasureVertical;handleWindowResize=()=>this.scheduleMeasurement();lastInlineHeight=0;lastSideWidth=0;destroy(){this.ngZone.runOutsideAngular(()=>{window.removeEventListener("resize",this.handleWindowResize)}),this.resizeObserver?.disconnect()}setBoardSection(e){this.boardSection=e,this.scheduleMeasurement()}setBoardContainer(e){this.observeElement(this.boardContainer,!1),this.boardContainer=e,this.observeElement(this.boardContainer),this.scheduleMeasurement()}setScratchContainer(e){this.observeElement(this.scratchContainer,!1),this.scratchContainer=e,this.observeElement(this.scratchContainer),this.scheduleMeasurement()}setBoardLayout(e){this.observeElement(e),this.scheduleMeasurement()}setScratchMeasureHorizontal(e){this.observeElement(this.scratchMeasureHorizontal,!1),this.scratchMeasureHorizontal=e,this.observeElement(this.scratchMeasureHorizontal),this.scheduleMeasurement()}setScratchMeasureVertical(e){this.observeElement(this.scratchMeasureVertical,!1),this.scratchMeasureVertical=e,this.observeElement(this.scratchMeasureVertical),this.scheduleMeasurement()}scheduleMeasurement(){!this.boardSection||this.measurementScheduled||(this.measurementScheduled=!0,this.ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this.ngZone.run(()=>this.performMeasurement())})}))}performMeasurement(){if(this.measurementScheduled=!1,!this.boardSection||!this.boardContainer||!this.scratchContainer)return;let e=this.getRect(this.boardSection),t=this.getRect(this.boardContainer),i=this.getRect(this.scratchContainer);if(!e||!t||!i)return;let r=this.scratchMeasureHorizontal?this.getRect(this.scratchMeasureHorizontal):void 0,n=this.scratchMeasureVertical?this.getRect(this.scratchMeasureVertical):void 0;r?.height?this.lastInlineHeight=r.height:this.lastInlineHeight||(this.lastInlineHeight=i.height),n?.width?this.lastSideWidth=n.width:!this.lastSideWidth&&this.lastInlineHeight&&(this.lastSideWidth=this.lastInlineHeight);let a=this.lastInlineHeight||i.height,s=this.lastSideWidth||i.width,c=t.height+this.scratchPadInlineGap+a<=e.height?"vertical":"horizontal",d=0;if(c==="horizontal"){let u=Math.max(0,(e.width-t.width)/2),f=u+t.width+this.scratchPadSideGap,m=Math.max(0,f+s-e.width),h=Math.max(0,u-m);h+t.width+this.scratchPadSideGap+s<=e.width?d=Math.round(h):c="vertical"}this.updateState(c,d)}updateState(e,t){e===this.layoutMode&&t===this.boardHorizontalOffset||(this.layoutMode=e,this.boardHorizontalOffset=t,this.onStateChange({layoutMode:e,boardOffset:t}),e==="horizontal"&&this.scheduleMeasurement())}getRect(e){let t=e.getBoundingClientRect();if(!(!t.width&&!t.height))return t}observeElement(e,t=!0){e&&(this.resizeObserver||(this.resizeObserver=new ResizeObserver(()=>this.scheduleMeasurement())),t?this.resizeObserver.observe(e):this.resizeObserver.unobserve(e))}};var Vt=200,ar=500,_i=600,wt=class{enabled=!0;autoClearUnneededCells=!1;sequence=Promise.resolve();pendingTimers=new Set;activeCells=new Set;autoClearHandler;animationCompletedSubject=new Y;animationCompleted$=this.animationCompletedSubject.asObservable();setAutoComplete(e){this.autoClearUnneededCells=e}setEnabled(e){this.enabled=e,e||this.resetAll()}setAutoClearHandler(e){this.autoClearHandler=e}dispose(){this.resetAll(),this.animationCompletedSubject.complete()}handleCellUsed(e,t){if(!this.enabled)return;let i=this.findCellLocation(e,t);if(!i)return;let r=this.buildEligibleSections(e,t,i);if(!r.length)return;let n=[];this.sequence=this.sequence.then(()=>this.runInSeries(r,n)).then(()=>{n.length&&this.autoClearHandler?.(n.slice()),this.animationCompletedSubject.closed||this.animationCompletedSubject.next()})}runInSeries(e,t){return e.reduce((i,r)=>i.then(()=>this.runSection(r,t)),Promise.resolve())}runSection(e,t){return e.segments.length?(e.segments.forEach(i=>this.scheduleGlow(i,t)),new Promise(i=>{let r=window.setTimeout(()=>{this.pendingTimers.delete(r),i()},e.totalDuration);this.pendingTimers.add(r)})):Promise.resolve()}scheduleGlow(e,t){let i=window.setTimeout(()=>{if(this.pendingTimers.delete(i),!this.enabled)return;this.activateCell(e.cell,e.variant,t);let r=window.setTimeout(()=>{this.pendingTimers.delete(r),this.clearCell(e.cell,e.variant)},_i);this.pendingTimers.add(r)},e.delay);this.pendingTimers.add(i)}activateCell(e,t,i){if(e.glowVariant=t,e.glowActive=!0,this.activeCells.add(e),this.autoClearUnneededCells&&this.shouldAutoClearCell(e,t)){let r=e.status===2;e.status=2,r||i.push(e)}}clearCell(e,t){e.glowVariant===t&&(e.glowVariant=void 0),e.glowActive=!1,this.activeCells.delete(e)}resetAll(){this.pendingTimers.forEach(e=>window.clearTimeout(e)),this.pendingTimers.clear(),this.activeCells.forEach(e=>{e.glowVariant=void 0,e.glowActive=!1}),this.activeCells.clear(),this.sequence=Promise.resolve()}shouldAutoClearCell(e,t){return e.required||e.status===2?!1:t==="group-header"?!0:t==="row"||t==="column"||t==="group"}findCellLocation(e,t){for(let i=0;i<e.playArea.length;i++){let r=e.playArea[i].indexOf(t);if(r!==-1)return{rowIndex:i,colIndex:r}}return null}buildEligibleSections(e,t,i){let r=[],n=this.buildGroupSection(e,t);n&&r.push(n);let a=this.buildRowSection(e,i);a&&r.push(a);let s=this.buildColumnSection(e,i);return s&&r.push(s),r}buildRowSection(e,t){let{rowIndex:i}=t,r=this.getRowHeader(e,i);if(!r)return null;let n=0,a=0;if(e.playArea.forEach((c,d)=>c.forEach((u,f)=>{d===i&&(u.required&&(n+=u.value),u.status===1&&(a+=u.value))})),!n||a!==n)return null;let s=e.playArea[i];if(!s?.length||!this.hasUnresolvedCells(s))return null;let l=s.map((c,d)=>({cell:c,col:d})).sort((c,d)=>d.col-c.col);return this.buildSectionSchedule(l.map(c=>c.cell),r,"row")}buildColumnSection(e,t){let{colIndex:i}=t,r=this.getColumnHeader(e,i);if(!r)return null;let n=0,a=0;if(e.playArea.forEach((l,c)=>l.forEach((d,u)=>{u===i&&(d.required&&(n+=d.value),d.status===1&&(a+=d.value))})),!n||a!==n)return null;let s=[];for(let l=0;l<e.playArea.length;l++){let c=e.playArea[l][i];c&&s.push({cell:c,row:l,col:i})}return!s.length||!this.hasUnresolvedCells(s.map(l=>l.cell))?null:(s.sort((l,c)=>c.row-l.row),this.buildSectionSchedule(s.map(l=>l.cell),r,"column"))}buildGroupSection(e,t){let i=t.groupNumber;if(!i)return null;let r=[],n=0,a=0;for(let f=0;f<e.playArea.length;f++)for(let m=0;m<e.playArea[f].length;m++){let h=e.playArea[f][m];h?.groupNumber===i&&(r.push({cell:h,row:f,col:m}),h.required&&(n+=h.value),h.status===1&&(a+=h.value))}if(!r.length||!n||a!==n||!this.hasUnresolvedCells(r.map(f=>f.cell)))return null;let s=this.findGroupHeader(r),l=r.filter(f=>f!==s),{cells:c,delays:d}=this.orderGroupCells(l,s),u=this.buildSectionSchedule(c,s.cell,"group",{delays:d});return u||null}buildSectionSchedule(e,t,i,r){let n=[],a=0,s=r?.delays;if(s&&s.length)e.forEach((u,f)=>{let m=s[f]??0;n.push({cell:u,variant:i,delay:m}),a=Math.max(a,m)});else{let u=e.length,f=u>1?Vt/(u-1):0;e.forEach((m,h)=>{let v=h===0?0:Math.round(f*h);n.push({cell:m,variant:i,delay:v}),a=v})}let l=a+ar,c=i==="row"?"row-header":i==="column"?"column-header":"group-header";n.push({cell:t,variant:c,delay:l});let d=l+_i;return{segments:n,totalDuration:d}}orderGroupCells(e,t){if(!e.length)return{cells:[],delays:[]};let i=e.map(c=>{let d=Math.max(0,c.row-t.row),u=Math.max(0,c.col-t.col),f=Math.max(d,u);return{cell:c.cell,row:c.row,col:c.col,stage:f}}),r=Array.from(new Set(i.map(c=>c.stage))).sort((c,d)=>d-c),n=r.length>1?Vt/(r.length-1):0,a=new Map;r.forEach((c,d)=>{let u=d===0?0:Math.round(n*d);d===r.length-1&&r.length>1&&(u=Vt),a.set(c,u)}),i.sort((c,d)=>c.stage!==d.stage?d.stage-c.stage:c.row!==d.row?d.row-c.row:d.col-c.col);let s=i.map(c=>c.cell),l=i.map(c=>a.get(c.stage)??0);return{cells:s,delays:l}}hasUnresolvedCells(e){return e.some(t=>t.status===0)}findGroupHeader(e){let t=e[0];for(let i=1;i<e.length;i++){let r=e[i];(r.row<t.row||r.row===t.row&&r.col<t.col)&&(t=r)}return t}getRowHeader(e,t){return e.fullBoard[t+1]?.[0]}getColumnHeader(e,t){return e.fullBoard[0]?.[t+1]}};var ze=[{title:"Too Good",subTitle:"...to have real friends",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Boss",subTitle:"but nobody respects you",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Fire",subTitle:"but like dumpster fire",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Savory",subTitle:"like a stale chip",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Hot Mess",subTitle:"emphasis on mess",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Champion Vibes",subTitle:"loser aura",accuracy:-.9,speed:-.72,difficulty:-.7},{title:"Overachiever",subTitle:"compensating for attention?",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Pro Gamer",subTitle:"unemployed edition",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Lethal",subTitle:"like expired milk",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Icon",subTitle:"of poor fashion",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Unreal",subTitle:"like your dating prospects",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Tryhard",subTitle:"and still average",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Untouchable",subTitle:"still ghosted",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Omega",subTitle:"last picked",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Legendary",subTitle:"but only in your own head",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Dominating",subTitle:"but not in a cool way",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Sharp Shooter",subTitle:"but dull personality",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Dangerous",subTitle:"mostly to yourself",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"King",subTitle:"of awkward silences",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Iron Will",subTitle:"aluminum execution",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Quickdraw",subTitle:"slow thinker",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Expert",subTitle:"at excuses",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Flex",subTitle:"tiny muscles, big ego",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Ultra Instinct",subTitle:"zero coordination",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Flawless",subTitle:"except for that one rash",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Slick",subTitle:"like a greasy taco wrapper",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Winner Winner",subTitle:"sad microwave dinner",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Alpha",subTitle:"but only in video games",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Smooth",subTitle:"like chunky peanut butter",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Hero",subTitle:"in your mind",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Captain",subTitle:"of bad moves",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Mega Brain",subTitle:"tiny common sense",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Epic",subTitle:"failure",accuracy:-.9,speed:-.72,difficulty:-.7},{title:"Clutch",subTitle:"like a worn out one",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Boss",subTitle:"tiny kingdom edition",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Overpowered",subTitle:"underqualified elsewhere",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Elite",subTitle:"at wasting time",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Genius",subTitle:"at pointless endeavors",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Legend",subTitle:"...mostly an urban myth",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Wizard",subTitle:"of 'oops, wrong move'",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Legendary",subTitle:"average friend edition",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Savage",subTitle:"but still gets grounded by mom",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Bulletproof",subTitle:"emotionally fragile though",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Champion",subTitle:"average effort edition",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Alpha Wolf",subTitle:"lone. awkward.",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Danger",subTitle:"mostly to furniture",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"MVP",subTitle:"minimum viable player",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Winner",subTitle:"but participation trophy style",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Certified",subTitle:"only slightly insane",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Beast Mode",subTitle:"not beauty, though",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Wizard",subTitle:"magic: mostly fumbles",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Champion",subTitle:"still unranked IRL",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Untamed",subTitle:"houseplant collection disagrees",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Absolute Legend",subTitle:"of mediocre skills",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Savage Beast",subTitle:"nap time pending",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Hot Stuff",subTitle:"careful, that ego might burn",accuracy:-.2,speed:-.16,difficulty:0},{title:"Big Brain",subTitle:"small attention span",accuracy:-.2,speed:-.16,difficulty:0},{title:"Boss Mode",subTitle:"minus the paycheck",accuracy:-.2,speed:-.16,difficulty:0},{title:"Mastermind",subTitle:"of obvious solutions",accuracy:-.2,speed:-.16,difficulty:0},{title:"Dominator",subTitle:"of mistakes",accuracy:-.92,speed:-.74,difficulty:-.72},{title:"Epic Gamer",subTitle:"missing sleep DLC",accuracy:-.2,speed:-.16,difficulty:0},{title:"Big Winner",subTitle:"tiny victories count too",accuracy:-.1,speed:-.08,difficulty:.1},{title:"Immortal",subTitle:"until snack time's missed",accuracy:-.1,speed:-.08,difficulty:.1},{title:"Majestic",subTitle:"awkward in motion",accuracy:-.1,speed:-.08,difficulty:.1},{title:"Savage",subTitle:"but cries at Pixar movies",accuracy:0,speed:0,difficulty:.2},{title:"Magnificent",subTitle:"spelling not included",accuracy:0,speed:0,difficulty:.2},{title:"Famous",subTitle:"in a very local sense",accuracy:0,speed:0,difficulty:.2},{title:"Unstoppable",subTitle:"except by doors marked 'Push'",accuracy:.1,speed:.08,difficulty:.3},{title:"Baller",subTitle:"on a budget",accuracy:.1,speed:.08,difficulty:.3},{title:"Rockstar",subTitle:"air guitar edition",accuracy:.1,speed:.08,difficulty:.3},{title:"Fearless",subTitle:"unless it\u2019s spiders",accuracy:.1,speed:.08,difficulty:.3},{title:"Adorable",subTitle:"like a gremlin",accuracy:.1,speed:.08,difficulty:.3},{title:"Killer Move",subTitle:"still can\u2019t dance though",accuracy:.2,speed:.16,difficulty:.4},{title:"Godlike",subTitle:"but still can\u2019t parallel park",accuracy:.2,speed:.16,difficulty:.4},{title:"Nailed It",subTitle:"...like a sleepy carpenter",accuracy:.3,speed:.24,difficulty:.5},{title:"Glorious",subTitle:"like glitter on everything",accuracy:.3,speed:.24,difficulty:.5},{title:"Certified Genius",subTitle:"Yes, we checked the paperwork.",accuracy:.8,speed:.64,difficulty:1},{title:"Unstoppable",subTitle:"like a car without brakes",accuracy:.8,speed:.64,difficulty:1},{title:"Champ Champ",subTitle:"One trophy wasn\u2019t enough.",accuracy:.9,speed:.72,difficulty:1},{title:"Logic Leak",subTitle:"Thoughts escaped faster than your streak score.",accuracy:-1,speed:-.8,difficulty:-.8},{title:"Equation Oops",subTitle:"Wrong side, wrong time, wrong math.",accuracy:-1,speed:-.8,difficulty:-.8},{title:"Puzzle Panic",subTitle:"Even the hints asked for hazard pay.",accuracy:-1,speed:-.8,difficulty:-.8},{title:"Fraction Fiasco",subTitle:"Half right, half tragic.",accuracy:-.9,speed:-.72,difficulty:-.7},{title:"Number Nap",subTitle:"You dreamed of accuracy, briefly.",accuracy:-.9,speed:-.72,difficulty:-.7},{title:"Graphical Error",subTitle:"Your trendline went straight to regret.",accuracy:-.9,speed:-.72,difficulty:-.7},{title:"Puzzle Fumble",subTitle:"You tripped over easy mode.",accuracy:-.9,speed:-.72,difficulty:-.7},{title:"Logic Lapse",subTitle:"Brain went on vacation mid-problem.",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Math Mulligan",subTitle:"You swung. The math ducked.",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Number Fog",subTitle:"Visibility: zero. Accuracy: also zero.",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Sum Slip",subTitle:"Missed the plus sign like it owed you money.",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Hint Hypocrite",subTitle:"Begged for help, ignored it instantly.",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Logic Lag",subTitle:"Your thoughts load slower than dial-up.",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Equation Shrug",subTitle:`"Math"? It's apparently more about the "vibes" for you.`,accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Clever Adjacent",subTitle:"You almost brushed against smart.",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Angle Amnesia",subTitle:"Every corner became confusion.",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Puzzle Plodder",subTitle:"You took the scenic route to wrong.",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Fact Fumbler",subTitle:"You misquoted the tutorial again.",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Logic Loiterer",subTitle:"Lurking near the solution, uninvited.",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Count Confusion",subTitle:"Ran out of fingers *and* guesses.",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Sum Stumbler",subTitle:"Tripped over the equals sign again.",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Fraction Fidget",subTitle:"Reduced yourself, not the fraction.",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Math Mischief",subTitle:"Chaos is technically a method.",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Logic Babysitter",subTitle:"Watched your reasoning fall off the couch.",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Digit Daydreamer",subTitle:"Counting sheep instead of sums.",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Puzzle Rambler",subTitle:"Talked through every wrong assertion proudly.",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Hypothesis Hobo",subTitle:"Traveling light, no proof in sight.",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Sequence Snoozer",subTitle:"The puzzle solved itself out of pity.",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Riddle Rambler",subTitle:"You narrated failure beautifully.",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Clue Clinger",subTitle:"Still holding the wrong one, champion.",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Math Mood Swing",subTitle:"One step genius, one step chaos.",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Estimate Enthusiast",subTitle:"Close enough\u2026 in an alternate reality.",accuracy:-.2,speed:-.16,difficulty:0},{title:"Digit Diplomat",subTitle:"Brokered peace between two wrongs.",accuracy:-.2,speed:-.16,difficulty:0},{title:"Logic Looper",subTitle:"Orbiting the answer without landing.",accuracy:-.2,speed:-.16,difficulty:0},{title:"Clue Juggler",subTitle:"Dropped them all but smiled anyway.",accuracy:-.1,speed:-.08,difficulty:.1},{title:"Number Nudger",subTitle:"Almost right counts for something.",accuracy:-.1,speed:-.08,difficulty:.1},{title:"Puzzle Shuffler",subTitle:"Explored every option, none worked, tried anyway.",accuracy:-.1,speed:-.08,difficulty:.1},{title:"Mid Math",subTitle:"Consistent mediocrity is still consistent.",accuracy:0,speed:0,difficulty:.2},{title:"Sum Slinger",subTitle:"Accuracy optional, confidence mandatory.",accuracy:0,speed:0,difficulty:.2},{title:"Sum Strategist",subTitle:"Brilliant plan, terrible follow-through.",accuracy:.1,speed:.08,difficulty:.3},{title:"Equation Acrobat",subTitle:"Graceful stumble into correctness.",accuracy:.2,speed:.16,difficulty:.4},{title:"Puzzle Pilot",subTitle:"Turbulent but landed somewhere.",accuracy:.2,speed:.16,difficulty:.4},{title:"Number Night Owl",subTitle:"Smart after everyone stops watching.",accuracy:.2,speed:.16,difficulty:.4},{title:"Puzzle Polisher",subTitle:"Shiny, but still wrong underneath.",accuracy:.3,speed:.24,difficulty:.5},{title:"Sum Surgeon",subTitle:"Surgical precision, butter-knife results.",accuracy:.3,speed:.24,difficulty:.5},{title:"Grid Gladiator",subTitle:"Won by sheer stubbornness.",accuracy:.3,speed:.24,difficulty:.5},{title:"Brainstorm Captain",subTitle:"Steered through chaos, mostly upright.",accuracy:.3,speed:.24,difficulty:.5},{title:"Pattern Pathfinder",subTitle:"Found the route, detoured anyway.",accuracy:.3,speed:.24,difficulty:.5},{title:"Logic Librarian",subTitle:"Filed ideas under \u201Cclose enough.\u201D",accuracy:.4,speed:.32,difficulty:.6},{title:"Math Mechanic",subTitle:"Runs fine if nobody looks closely.",accuracy:.4,speed:.32,difficulty:.6},{title:"Logic Captain",subTitle:"Navigated perfectly into a minor reef.",accuracy:.5,speed:.4,difficulty:.7},{title:"Math Maverick",subTitle:"Rules ignored, still worked somehow.",accuracy:.5,speed:.4,difficulty:.7},{title:"Sum Commander",subTitle:"Bossed numbers until they gave up.",accuracy:.5,speed:.4,difficulty:.7},{title:"Brainwave Baron",subTitle:"Charged rent for your own idea.",accuracy:.5,speed:.4,difficulty:.7},{title:"Equation Enforcer",subTitle:"Made math behave with intimidation.",accuracy:.5,speed:.4,difficulty:.7},{title:"Math Maestro",subTitle:"Conducted chaos in 4/4 time.",accuracy:.6,speed:.48,difficulty:.8},{title:"Grid Genius",subTitle:"Too smug to double-check, still right.",accuracy:.6,speed:.48,difficulty:.8},{title:"Sum Supreme",subTitle:"Stacked perfection, slightly crooked.",accuracy:.6,speed:.48,difficulty:.8},{title:"Logic Luminary",subTitle:"Your glow gives everyone eye strain.",accuracy:.7,speed:.56,difficulty:.9},{title:"Equation Emperor",subTitle:"Declared the answer by decree.",accuracy:.7,speed:.56,difficulty:.9},{title:"Puzzle Phenom",subTitle:"Solved it fast, bragged faster.",accuracy:.8,speed:.64,difficulty:1},{title:"Logic Royalty",subTitle:"Crowned by sarcasm, worshipped by math.",accuracy:.9,speed:.72,difficulty:1},{title:"Math Myth",subTitle:"Half genius, half rumor.",accuracy:.9,speed:.72,difficulty:1},{title:"Puzzle Paragon",subTitle:"Too flawless to be likable.",accuracy:.9,speed:.72,difficulty:1},{title:"Logic Demigod",subTitle:"You bend logic just to stay amused.",accuracy:1,speed:.8,difficulty:1},{title:"Math Overlord",subTitle:"The numbers whisper your name, trembling.",accuracy:1,speed:.8,difficulty:1},{title:"Math Mic Drop",subTitle:"Dropped the proof, kept the applause.",accuracy:1,speed:.8,difficulty:1},{title:"Puzzle Panic",subTitle:"Even the hints hid under the desk when you clicked.",accuracy:-1,speed:-.8,difficulty:-.8},{title:"Zero Hero",subTitle:"You fought the numbers and zero clearly won.",accuracy:-1,speed:-.8,difficulty:-.8},{title:"Sum Disaster",subTitle:"You brought subtraction to an addition fight.",accuracy:-1,speed:-.8,difficulty:-.8},{title:"Arithmetic Awkward",subTitle:"You hugged the wrong move like it was family.",accuracy:-1,speed:-.8,difficulty:-.8},{title:"Almost Counted",subTitle:"Four out of five mistakes recommend a redo.",accuracy:-.9,speed:-.72,difficulty:-.7},{title:"Algebra Oopsie",subTitle:"Your X filed for a restraining order.",accuracy:-.9,speed:-.72,difficulty:-.7},{title:"Puzzle Fumble",subTitle:"You tripped over the tutorial.",accuracy:-.9,speed:-.72,difficulty:-.7},{title:"Mist Calculation",subTitle:"You turned basic arithmetic into abstract art.",accuracy:-.9,speed:-.72,difficulty:-.7},{title:"Number Nap",subTitle:"Your brain took a break mid-subtraction.",accuracy:-.9,speed:-.72,difficulty:-.7},{title:"Carry Catastrophe",subTitle:"You misplaced the one faster than your car keys.",accuracy:-.9,speed:-.72,difficulty:-.7},{title:"Subtraction Sigh",subTitle:"You borrowed ten and never gave it back.",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Equation Detour",subTitle:"You took a scenic route through Wrong Answer Valley.",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Logic Lapse",subTitle:"The clues waited while you rebooted your only thought.",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Number Fog",subTitle:"Your vision of pi ends at three.",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Brain Buffering",subTitle:"Your thoughts spin a loading wheel made of wrong answers.",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Hint Hypocrite",subTitle:"You begged for clues and ignored every one.",accuracy:-.8,speed:-.64,difficulty:-.6},{title:"Integer Itch",subTitle:"You shuffled digits like a magician with no deck.",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Logic Lag",subTitle:"Your reasoning arrives on dial-up.",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Guess Goblin",subTitle:"You clicked random numbers and called it strategy.",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Number Nibble",subTitle:"You took tiny bites out of the right answer and spit them out.",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Puzzle Pout",subTitle:"You glared at the grid until it apologized.",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Equation Shrug",subTitle:"You balanced the sides with pure indifference.",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Clever Adjacent",subTitle:"You parked your brain next to the solution but never visited.",accuracy:-.7,speed:-.56,difficulty:-.5},{title:"Tangent Tourist",subTitle:"You treat every hint like a scenic overlook.",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Logic Loiterer",subTitle:"You hang around the solution without making eye contact.",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Puzzle Plodder",subTitle:"You set a personal best for undo clicks.",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Addition Overtime",subTitle:"You took extra minutes to add two digits.",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Proofless",subTitle:"You brought arguments, forgot the proof, and lost.",accuracy:-.6,speed:-.48,difficulty:-.4},{title:"Count Confusion",subTitle:"You counted on your fingers but ran out of fingers.",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Puzzle Plothole",subTitle:"Your reasoning has more holes than a sieve chart.",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Equation Tourist",subTitle:"You took selfies with every wrong step.",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Math Mischief",subTitle:"You added drama, not numbers.",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Sum Stumbler",subTitle:"You tripped over the equals sign.",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Abacus Amateur",subTitle:"You poke the beads just to hear them sigh.",accuracy:-.5,speed:-.4,difficulty:-.3},{title:"Equation Explorer",subTitle:"You mapped every detour in Wrong Answer Canyon.",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Number Negotiator",subTitle:"You tried bargaining with the sum like it was a yard sale.",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Logic Babysitter",subTitle:"You keep your best ideas in time-out.",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Math Mood",subTitle:"You only add when the vibes are right.",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Hypothesis Hobo",subTitle:"You travel light and leave the proof behind.",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Digit Daydreamer",subTitle:"You drift off mid-count like it is bedtime math.",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Puzzle Rambler",subTitle:"You narrate every wrong guess like a podcast.",accuracy:-.4,speed:-.32,difficulty:-.2},{title:"Sum Tourist",subTitle:"You visited the right answer, bought a souvenir, then made the wrong move.",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Math Mood Swing",subTitle:'You alternate between genius and "whoops" every other step.',accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Logic Left Turn",subTitle:"You signal right but proof left.",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Sequence Snoozer",subTitle:"You nod off right before the pattern reveals itself.",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Riddle Rambler",subTitle:"You turn every puzzle into a three-act monologue.",accuracy:-.3,speed:-.24,difficulty:-.1},{title:"Brain Boot",subTitle:"You reboot mid-puzzle like a vintage laptop.",accuracy:-.2,speed:-.16,difficulty:0},{title:"Math Middler",subTitle:"You aim for mediocrity and nail it within decimals.",accuracy:-.2,speed:-.16,difficulty:0},{title:"Logic Looper",subTitle:"You circle the answer like a shark with stage fright.",accuracy:-.2,speed:-.16,difficulty:0},{title:"Estimate Enthusiast",subTitle:"You round everything until it sort of works.",accuracy:-.2,speed:-.16,difficulty:0},{title:"Calculator Consultant",subTitle:"You ask it for advice then do the opposite.",accuracy:-.2,speed:-.16,difficulty:0},{title:"Logic Jogger",subTitle:"You warm up by missing the obvious clue.",accuracy:-.1,speed:-.08,difficulty:.1},{title:"Sum Stroller",subTitle:"You take the scenic loop before tapping the right digit.",accuracy:-.1,speed:-.08,difficulty:.1},{title:"Digit Day Saver",subTitle:"You rescue the puzzle fifteen minutes after it screamed.",accuracy:-.1,speed:-.08,difficulty:.1},{title:"Puzzle Shuffler",subTitle:"You keep shuffling strategies like a deck of identical cards.",accuracy:-.1,speed:-.08,difficulty:.1},{title:"Mid Math",subTitle:"You hit the median and called it destiny.",accuracy:0,speed:0,difficulty:.2},{title:"Digit Dealer",subTitle:"You trade wrong digits for slightly better ones in bulk.",accuracy:0,speed:0,difficulty:.2},{title:"Sum Slinger",subTitle:"You toss numbers at the board until one sticks.",accuracy:0,speed:0,difficulty:.2},{title:"Brainstorm Breeze",subTitle:"Your ideas drift through and occasionally rain answers.",accuracy:0,speed:0,difficulty:.2},{title:"Puzzle Pacer",subTitle:"You take steady laps around the finish line.",accuracy:.1,speed:.08,difficulty:.3},{title:"Equation Wrangler",subTitle:"You rope in the numbers, then let one escape for drama.",accuracy:.1,speed:.08,difficulty:.3},{title:"Sum Strategist",subTitle:"You planned five moves ahead and forgot step two.",accuracy:.1,speed:.08,difficulty:.3},{title:"Proof Patrol",subTitle:"You check every step and still trip on the last one.",accuracy:.1,speed:.08,difficulty:.3},{title:"Pattern Prospector",subTitle:"You find gold nuggets of logic then misplace them.",accuracy:.1,speed:.08,difficulty:.3},{title:"Sum Shepherd",subTitle:"You herd stray digits back into formation, eventually.",accuracy:.2,speed:.16,difficulty:.4},{title:"Equation Acrobat",subTitle:'You flip through operations with only "minor" face-plants.',accuracy:.2,speed:.16,difficulty:.4},{title:"Proof Partner",subTitle:"You hold the proof's hand and still trip.",accuracy:.2,speed:.16,difficulty:.4},{title:"Number Ninja",subTitle:"You sneak past mistakes with barely a whisper.",accuracy:.9,speed:.72,difficulty:1},{title:"Sum Surgeon",subTitle:"You operate on problems with a slightly shaky scalpel.",accuracy:.3,speed:.24,difficulty:.5},{title:"Pattern Pathfinder",subTitle:"You find the trail and still take a snack break mid-solve.",accuracy:.3,speed:.24,difficulty:.5},{title:"Math Mechanic",subTitle:'You pop open the hood and pretend the noises are "features."',accuracy:.4,speed:.32,difficulty:.6},{title:"Puzzle Pathfinder",subTitle:"You blaze trails through logic like a mildly lost scout.",accuracy:.4,speed:.32,difficulty:.6},{title:"Equation Engineer",subTitle:"You bolt the pieces together until they mostly align.",accuracy:.4,speed:.32,difficulty:.6},{title:"Sumpreme Leader",subTitle:"Your totals hold elections just to re-elect you.",accuracy:1,speed:.8,difficulty:1},{title:"Math Overlord",subTitle:"The numbers unionized purely to slow you down.",accuracy:1,speed:.8,difficulty:1},{title:"Equation Elite",subTitle:"You square up with problems and remind them who is boss.",accuracy:.8,speed:.64,difficulty:1},{title:"Grid Governor",subTitle:"You appoint numbers to positions they did not apply for.",accuracy:.8,speed:.64,difficulty:1},{title:"Sum Superstar",subTitle:"You autograph your totals to keep yourself grounded.",accuracy:.7,speed:.56,difficulty:.9},{title:"Grid Whisperer",subTitle:"You talk the boxes into cooperating with mild sarcasm.",accuracy:.4,speed:.32,difficulty:.6},{title:"Math Maverick",subTitle:"You ignore instructions and still stick the landing.",accuracy:.5,speed:.4,difficulty:.7},{title:"Equation Enforcer",subTitle:"You smack both sides until they behave.",accuracy:.5,speed:.4,difficulty:.7},{title:"Sum Commander",subTitle:"You bark orders at numbers, they mostly obey.",accuracy:.5,speed:.4,difficulty:.7}];var Mt=class{config;canvas=null;overlay=null;gl=null;backgroundProgram=null;confettiProgram=null;textProgram=null;fireworkProgram=null;backgroundBuffer=null;confettiPositionBuffer=null;confettiColorBuffer=null;confettiSizeBuffer=null;confettiAngleBuffer=null;confettiRatioBuffer=null;fireworkPositionBuffer=null;fireworkColorBuffer=null;fireworkSizeBuffer=null;fireworkIntensityBuffer=null;textBuffer=null;textTexture=null;backgroundHandles={};confettiHandles={};textHandles={};fireworkHandles={};animationFrameId=null;resizeObserver;confettiCount=180;confettiPositions=new Float32Array(this.confettiCount*2);confettiVelocities=new Float32Array(this.confettiCount*2);confettiColors=new Float32Array(this.confettiCount*3);confettiSizes=new Float32Array(this.confettiCount);confettiFlutterPhase=new Float32Array(this.confettiCount);confettiFlutterSpeed=new Float32Array(this.confettiCount);confettiFlutterMagnitude=new Float32Array(this.confettiCount);confettiAngles=new Float32Array(this.confettiCount);confettiAngularVelocity=new Float32Array(this.confettiCount);confettiAspectRatios=new Float32Array(this.confettiCount);confettiInitialized=!1;confettiNeedsRatioUpload=!1;fireworksPerBurst=48;fireworkPoolSize=this.fireworksPerBurst*6;fireworkPositions=new Float32Array(this.fireworkPoolSize*2);fireworkVelocities=new Float32Array(this.fireworkPoolSize*2);fireworkColors=new Float32Array(this.fireworkPoolSize*3);fireworkSizes=new Float32Array(this.fireworkPoolSize);fireworkIntensity=new Float32Array(this.fireworkPoolSize);fireworkLifeRemaining=new Float32Array(this.fireworkPoolSize);fireworkLifeDuration=new Float32Array(this.fireworkPoolSize);fireworkBaseSize=new Float32Array(this.fireworkPoolSize);nextFireworkTime=0;lastFrame=performance.now();startTime=this.lastFrame;active=!1;renderFrame=e=>this.drawScene(e);handleResize=()=>this.syncCanvasSize();constructor(e){this.config=e}initialize(e,t){this.canvas=e,this.overlay=t,this.active=!0;let i=e.getContext("webgl",{alpha:!0,antialias:!0,premultipliedAlpha:!1});return i?(this.gl=i,i.clearColor(0,0,0,0),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),this.createPrograms(),this.setupBuffers(),this.syncCanvasSize(!0),this.overlay&&typeof ResizeObserver<"u"&&(this.resizeObserver=new ResizeObserver(this.handleResize),this.resizeObserver.observe(this.overlay)),this.startTime=performance.now(),this.lastFrame=this.startTime,this.animationFrameId=requestAnimationFrame(this.renderFrame),!0):(this.active=!1,!1)}destroy(){this.active=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.resizeObserver&&this.overlay&&(this.resizeObserver.unobserve(this.overlay),this.resizeObserver.disconnect(),this.resizeObserver=void 0),this.gl&&(this.textTexture&&(this.gl.deleteTexture(this.textTexture),this.textTexture=null),this.backgroundBuffer&&(this.gl.deleteBuffer(this.backgroundBuffer),this.backgroundBuffer=null),this.confettiPositionBuffer&&(this.gl.deleteBuffer(this.confettiPositionBuffer),this.confettiPositionBuffer=null),this.confettiColorBuffer&&(this.gl.deleteBuffer(this.confettiColorBuffer),this.confettiColorBuffer=null),this.confettiSizeBuffer&&(this.gl.deleteBuffer(this.confettiSizeBuffer),this.confettiSizeBuffer=null),this.confettiAngleBuffer&&(this.gl.deleteBuffer(this.confettiAngleBuffer),this.confettiAngleBuffer=null),this.confettiRatioBuffer&&(this.gl.deleteBuffer(this.confettiRatioBuffer),this.confettiRatioBuffer=null),this.fireworkPositionBuffer&&(this.gl.deleteBuffer(this.fireworkPositionBuffer),this.fireworkPositionBuffer=null),this.fireworkColorBuffer&&(this.gl.deleteBuffer(this.fireworkColorBuffer),this.fireworkColorBuffer=null),this.fireworkSizeBuffer&&(this.gl.deleteBuffer(this.fireworkSizeBuffer),this.fireworkSizeBuffer=null),this.fireworkIntensityBuffer&&(this.gl.deleteBuffer(this.fireworkIntensityBuffer),this.fireworkIntensityBuffer=null),this.textBuffer&&(this.gl.deleteBuffer(this.textBuffer),this.textBuffer=null),this.backgroundProgram&&(this.gl.deleteProgram(this.backgroundProgram),this.backgroundProgram=null),this.confettiProgram&&(this.gl.deleteProgram(this.confettiProgram),this.confettiProgram=null),this.textProgram&&(this.gl.deleteProgram(this.textProgram),this.textProgram=null),this.fireworkProgram&&(this.gl.deleteProgram(this.fireworkProgram),this.fireworkProgram=null),this.gl=null)}createPrograms(){this.gl&&(this.backgroundProgram=this.linkProgram(`attribute vec2 a_position;

      varying vec2 v_uv;

      void main() {
        vec2 uv = (a_position * 0.5) + 0.5;
        v_uv = vec2(uv.x, 1.0 - uv.y);
        gl_Position = vec4(a_position, 0.0, 1.0);
      }`,`precision mediump float;

      varying vec2 v_uv;
      uniform float u_time;

      void main() {
        vec3 dawn = vec3(1.0, 0.42, 0.42);
        vec3 dusk = vec3(0.35, 0.08, 0.24);
        vec3 noon = vec3(0.99, 0.82, 0.35);
        vec3 midnight = vec3(0.1, 0.19, 0.32);

        float motion = sin((v_uv.y + u_time * 0.05) * 8.0) * 0.1;
        float blend = clamp(v_uv.y + motion, 0.0, 1.0);
        vec3 rowA = mix(dawn, dusk, blend);
        vec3 rowB = mix(noon, midnight, blend);

        float radial = smoothstep(0.9, 0.2, distance(v_uv, vec2(0.5, 0.35)));
        vec3 accent = vec3(0.28, 0.86, 0.98);
        vec3 base = mix(rowA, rowB, v_uv.x);
        vec3 color = mix(base, accent, radial * 0.45);

        gl_FragColor = vec4(color, 0.95);
      }`),this.confettiProgram=this.linkProgram(`attribute vec2 a_position;
      attribute vec3 a_color;
      attribute float a_size;
      attribute float a_angle;
      attribute float a_ratio;

      uniform vec2 u_resolution;
      uniform float u_time;

      varying vec3 v_color;
      varying float v_time;
      varying float v_angle;
      varying float v_ratio;

      void main() {
        vec2 zeroToOne = a_position / u_resolution;
        zeroToOne.y = 1.0 - zeroToOne.y;
        vec2 clip = zeroToOne * 2.0 - 1.0;
        gl_Position = vec4(clip, 0.0, 1.0);
        gl_PointSize = a_size;
        v_color = a_color;
        v_time = u_time;
        v_angle = a_angle;
        v_ratio = a_ratio;
      }`,`precision mediump float;

      varying vec3 v_color;
      varying float v_time;
      varying float v_angle;
      varying float v_ratio;

      void main() {
        vec2 centered = gl_PointCoord - vec2(0.5);
        float s = sin(v_angle);
        float c = cos(v_angle);
        vec2 rotated = vec2(c * centered.x - s * centered.y, s * centered.x + c * centered.y);
        float halfWidth = max(0.12, 0.5 * v_ratio);
        float halfHeight = 0.5;
        float alphaX = 1.0 - smoothstep(halfWidth - 0.1, halfWidth, abs(rotated.x));
        float alphaY = 1.0 - smoothstep(halfHeight - 0.1, halfHeight, abs(rotated.y));
        float alpha = alphaX * alphaY;
        if (alpha <= 0.0) {
          discard;
        }
        float shimmer = 0.7 + 0.3 * sin(v_time * 10.0 + rotated.x * 9.0 + v_angle * 1.3);
        gl_FragColor = vec4(v_color * shimmer, alpha);
      }`),this.textProgram=this.linkProgram(`attribute vec2 a_position;
      attribute vec2 a_texCoord;

      uniform float u_scale;

      varying vec2 v_texCoord;

      void main() {
        vec2 scaled = a_position * u_scale;
        gl_Position = vec4(scaled, 0.0, 1.0);
        v_texCoord = vec2(a_texCoord.x, 1.0 - a_texCoord.y);
      }`,`precision mediump float;

      varying vec2 v_texCoord;
      uniform sampler2D u_texture;
      uniform float u_opacity;

      void main() {
        vec4 texColor = texture2D(u_texture, v_texCoord);
        if (texColor.a < 0.01) {
          discard;
        }
        gl_FragColor = vec4(texColor.rgb, texColor.a * u_opacity);
      }`),this.fireworkProgram=this.linkProgram(`attribute vec2 a_position;
      attribute vec3 a_color;
      attribute float a_size;
      attribute float a_intensity;

      uniform vec2 u_resolution;

      varying vec3 v_color;
      varying float v_intensity;

      void main() {
        vec2 zeroToOne = a_position / u_resolution;
        zeroToOne.y = 1.0 - zeroToOne.y;
        vec2 clip = zeroToOne * 2.0 - 1.0;
        gl_Position = vec4(clip, 0.0, 1.0);
        gl_PointSize = a_size * a_intensity;
        v_color = a_color;
        v_intensity = a_intensity;
      }`,`precision mediump float;

      varying vec3 v_color;
      varying float v_intensity;

      void main() {
        if (v_intensity <= 0.0) {
          discard;
        }
        vec2 coord = gl_PointCoord - vec2(0.5);
        float dist = dot(coord, coord);
        if (dist > 0.25) {
          discard;
        }
        float fade = smoothstep(0.25, 0.0, dist);
        float alpha = clamp(v_intensity * fade, 0.0, 1.0);
        vec3 color = v_color * (0.6 + 0.4 * v_intensity);
        gl_FragColor = vec4(color, alpha);
      }`),this.backgroundProgram&&this.confettiProgram&&this.textProgram&&this.fireworkProgram&&(this.backgroundHandles.position=this.gl.getAttribLocation(this.backgroundProgram,"a_position"),this.backgroundHandles.time=this.gl.getUniformLocation(this.backgroundProgram,"u_time"),this.confettiHandles.position=this.gl.getAttribLocation(this.confettiProgram,"a_position"),this.confettiHandles.color=this.gl.getAttribLocation(this.confettiProgram,"a_color"),this.confettiHandles.size=this.gl.getAttribLocation(this.confettiProgram,"a_size"),this.confettiHandles.angle=this.gl.getAttribLocation(this.confettiProgram,"a_angle"),this.confettiHandles.ratio=this.gl.getAttribLocation(this.confettiProgram,"a_ratio"),this.confettiHandles.resolution=this.gl.getUniformLocation(this.confettiProgram,"u_resolution"),this.confettiHandles.time=this.gl.getUniformLocation(this.confettiProgram,"u_time"),this.textHandles.position=this.gl.getAttribLocation(this.textProgram,"a_position"),this.textHandles.texCoord=this.gl.getAttribLocation(this.textProgram,"a_texCoord"),this.textHandles.texture=this.gl.getUniformLocation(this.textProgram,"u_texture"),this.textHandles.opacity=this.gl.getUniformLocation(this.textProgram,"u_opacity"),this.textHandles.scale=this.gl.getUniformLocation(this.textProgram,"u_scale"),this.fireworkHandles.position=this.gl.getAttribLocation(this.fireworkProgram,"a_position"),this.fireworkHandles.color=this.gl.getAttribLocation(this.fireworkProgram,"a_color"),this.fireworkHandles.size=this.gl.getAttribLocation(this.fireworkProgram,"a_size"),this.fireworkHandles.intensity=this.gl.getAttribLocation(this.fireworkProgram,"a_intensity"),this.fireworkHandles.resolution=this.gl.getUniformLocation(this.fireworkProgram,"u_resolution")))}linkProgram(e,t){if(!this.gl)return null;let i=this.compileShader(e,this.gl.VERTEX_SHADER),r=this.compileShader(t,this.gl.FRAGMENT_SHADER);if(!i||!r)return null;let n=this.gl.createProgram();return n?(this.gl.attachShader(n,i),this.gl.attachShader(n,r),this.gl.linkProgram(n),this.gl.deleteShader(i),this.gl.deleteShader(r),this.gl.getProgramParameter(n,this.gl.LINK_STATUS)?n:(console.error("Failed to link WebGL program:",this.gl.getProgramInfoLog(n)),this.gl.deleteProgram(n),null)):null}compileShader(e,t){if(!this.gl)return null;let i=this.gl.createShader(t);return i?(this.gl.shaderSource(i,e),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?i:(console.error("Failed to compile shader:",this.gl.getShaderInfoLog(i)),this.gl.deleteShader(i),null)):null}setupBuffers(){let e=this.gl;!e||!this.backgroundProgram||!this.confettiProgram||!this.textProgram||!this.fireworkProgram||(this.backgroundBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.backgroundBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,3,-1,-1,3]),e.STATIC_DRAW),this.confettiPositionBuffer=e.createBuffer(),this.confettiColorBuffer=e.createBuffer(),this.confettiSizeBuffer=e.createBuffer(),this.confettiAngleBuffer=e.createBuffer(),this.confettiRatioBuffer=e.createBuffer(),this.populateConfettiDefaults(),this.fireworkPositionBuffer=e.createBuffer(),this.fireworkColorBuffer=e.createBuffer(),this.fireworkSizeBuffer=e.createBuffer(),this.fireworkIntensityBuffer=e.createBuffer(),this.initializeFireworks(),this.textBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.textBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]),e.STATIC_DRAW))}populateConfettiDefaults(){let e=this.gl;if(!e||!this.confettiColorBuffer||!this.confettiSizeBuffer)return;let t=[{r:1,g:.42,b:.42},{r:.28,g:.86,b:.98},{r:.84,g:.16,b:.52},{r:1,g:.9,b:.43},{r:.35,g:.93,b:.52}];for(let i=0;i<this.confettiCount;i++){let r=t[i%t.length],n=i*3;this.confettiColors[n]=r.r,this.confettiColors[n+1]=r.g,this.confettiColors[n+2]=r.b,this.confettiSizes[i]=8+Math.random()*10}e.bindBuffer(e.ARRAY_BUFFER,this.confettiColorBuffer),e.bufferData(e.ARRAY_BUFFER,this.confettiColors,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.confettiSizeBuffer),e.bufferData(e.ARRAY_BUFFER,this.confettiSizes,e.STATIC_DRAW),this.confettiRatioBuffer&&(e.bindBuffer(e.ARRAY_BUFFER,this.confettiRatioBuffer),e.bufferData(e.ARRAY_BUFFER,this.confettiAspectRatios,e.DYNAMIC_DRAW),this.confettiNeedsRatioUpload=!1)}initializeFireworks(){let e=this.gl;!e||!this.fireworkPositionBuffer||!this.fireworkColorBuffer||!this.fireworkSizeBuffer||!this.fireworkIntensityBuffer||(this.fireworkPositions.fill(0),this.fireworkVelocities.fill(0),this.fireworkSizes.fill(0),this.fireworkIntensity.fill(0),this.fireworkLifeRemaining.fill(0),this.fireworkLifeDuration.fill(1),this.fireworkBaseSize.fill(0),e.bindBuffer(e.ARRAY_BUFFER,this.fireworkPositionBuffer),e.bufferData(e.ARRAY_BUFFER,this.fireworkPositions,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.fireworkColorBuffer),e.bufferData(e.ARRAY_BUFFER,this.fireworkColors,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.fireworkSizeBuffer),e.bufferData(e.ARRAY_BUFFER,this.fireworkSizes,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.fireworkIntensityBuffer),e.bufferData(e.ARRAY_BUFFER,this.fireworkIntensity,e.DYNAMIC_DRAW),this.nextFireworkTime=0)}syncCanvasSize(e=!1){if(!this.gl||!this.overlay||!this.canvas)return;let t=window.devicePixelRatio||1,i=Math.max(1,Math.floor(this.overlay.clientWidth*t)),r=Math.max(1,Math.floor(this.overlay.clientHeight*t)),n=this.canvas.width!==i||this.canvas.height!==r;n&&(this.canvas.width=i,this.canvas.height=r,this.canvas.style.width=`${this.overlay.clientWidth}px`,this.canvas.style.height=`${this.overlay.clientHeight}px`,this.gl.viewport(0,0,i,r),this.resetConfettiPositions(i,r),this.uploadConfettiPositions(),this.uploadConfettiAngles(),this.confettiNeedsRatioUpload&&(this.uploadConfettiRatios(),this.confettiNeedsRatioUpload=!1)),(n||e)&&this.updateTextTexture(i,r)}resetConfettiPositions(e,t){for(let i=0;i<this.confettiCount;i++)this.resetConfettiParticle(i,e,t,!this.confettiInitialized);this.confettiInitialized=!0}resetConfettiParticle(e,t,i,r=!1){let n=e*2,a=Math.random()*t,s=r?Math.random()*i:-Math.random()*i*.2;this.confettiPositions[n]=a,this.confettiPositions[n+1]=s,this.confettiVelocities[n]=(Math.random()-.5)*t*.05,this.confettiVelocities[n+1]=i*(.055+Math.random()*.06),this.confettiFlutterPhase[e]=Math.random()*Math.PI*2,this.confettiFlutterSpeed[e]=2+Math.random()*2.8,this.confettiFlutterMagnitude[e]=16+Math.random()*28,this.confettiAngles[e]=Math.random()*Math.PI*2,this.confettiAngularVelocity[e]=(Math.random()-.5)*3.5,this.confettiAspectRatios[e]=.32+Math.random()*.55,this.confettiNeedsRatioUpload=!0}updateConfetti(e,t,i,r){for(let n=0;n<this.confettiCount;n++){let a=n*2,s=this.confettiFlutterPhase[n]+this.confettiFlutterSpeed[n]*e;this.confettiFlutterPhase[n]=s%(Math.PI*2);let l=this.confettiFlutterMagnitude[n],c=Math.sin(s+r*.35)*l,d=Math.cos((s+r)*.9)*l*.35,u=Math.sin(r*2.1+n*.3)*.8;this.confettiAngles[n]+=(this.confettiAngularVelocity[n]+u)*e,this.confettiAngularVelocity[n]+=Math.sin(s*1.2+r*.7)*e*.6,this.confettiAngularVelocity[n]=Math.max(-6,Math.min(6,this.confettiAngularVelocity[n])),this.confettiPositions[a]+=(this.confettiVelocities[a]+c)*e,this.confettiPositions[a+1]+=(this.confettiVelocities[a+1]+d)*e,this.confettiVelocities[a]*=.99,this.confettiVelocities[a+1]+=i*(.06+Math.sin(s*.8)*.015)*e,this.confettiVelocities[a+1]=Math.min(this.confettiVelocities[a+1],i*.2),Math.random()<e*.05&&(this.confettiFlutterMagnitude[n]=14+Math.random()*32,this.confettiFlutterSpeed[n]=1.8+Math.random()*3.2),this.confettiPositions[a]<-40?this.confettiPositions[a]=t+40:this.confettiPositions[a]>t+40&&(this.confettiPositions[a]=-40),this.confettiPositions[a+1]>i+40&&this.resetConfettiParticle(n,t,i,!1)}this.confettiNeedsRatioUpload&&(this.uploadConfettiRatios(),this.confettiNeedsRatioUpload=!1)}uploadConfettiPositions(){!this.gl||!this.confettiPositionBuffer||(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.confettiPositionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.confettiPositions,this.gl.DYNAMIC_DRAW))}uploadConfettiAngles(){!this.gl||!this.confettiAngleBuffer||(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.confettiAngleBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.confettiAngles,this.gl.DYNAMIC_DRAW))}uploadConfettiRatios(){!this.gl||!this.confettiRatioBuffer||(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.confettiRatioBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.confettiAspectRatios,this.gl.DYNAMIC_DRAW))}maybeSpawnFirework(e,t,i){if(e<this.nextFireworkTime)return;let r=0;for(;e>=this.nextFireworkTime&&r<3;)this.spawnFirework(t,i),this.nextFireworkTime=e+.45+Math.random()*.75,r++}spawnFirework(e,t){let i=[{r:1,g:.78,b:.28},{r:.95,g:.33,b:.54},{r:.42,g:.82,b:1},{r:.52,g:1,b:.72},{r:.99,g:.52,b:.15}],r=e*(.15+Math.random()*.7),n=t*(.2+Math.random()*.45),a=i[Math.floor(Math.random()*i.length)];for(let s=0;s<this.fireworksPerBurst;s++){let l=this.acquireFireworkSlot();if(l===-1)break;let c=s/this.fireworksPerBurst*Math.PI*2+(Math.random()-.5)*.35,d=t*(.18+Math.random()*.22),u=l*2;this.fireworkPositions[u]=r,this.fireworkPositions[u+1]=n,this.fireworkVelocities[u]=Math.cos(c)*d,this.fireworkVelocities[u+1]=Math.sin(c)*d-t*.18;let f=l*3,m=.75+Math.random()*.25;this.fireworkColors[f]=Math.min(1,a.r*m),this.fireworkColors[f+1]=Math.min(1,a.g*m),this.fireworkColors[f+2]=Math.min(1,a.b*m);let h=10+Math.random()*14;this.fireworkBaseSize[l]=h,this.fireworkSizes[l]=h;let v=.9+Math.random()*.6;this.fireworkLifeDuration[l]=v,this.fireworkLifeRemaining[l]=v,this.fireworkIntensity[l]=1}}acquireFireworkSlot(){for(let e=0;e<this.fireworkPoolSize;e++)if(this.fireworkLifeRemaining[e]<=0)return e;return-1}updateFireworks(e,t,i){let r=i*.45;for(let n=0;n<this.fireworkPoolSize;n++){let a=this.fireworkLifeRemaining[n];if(a<=0)continue;let s=n*2;if(this.fireworkPositions[s]+=this.fireworkVelocities[s]*e,this.fireworkPositions[s+1]+=this.fireworkVelocities[s+1]*e,this.fireworkVelocities[s]*=.96,this.fireworkVelocities[s+1]=this.fireworkVelocities[s+1]*.96+r*e*.6,a-=e,a<=0){this.fireworkLifeRemaining[n]=0,this.fireworkIntensity[n]=0,this.fireworkSizes[n]=0;continue}this.fireworkLifeRemaining[n]=a;let l=a/this.fireworkLifeDuration[n],c=Math.pow(l,.6);this.fireworkIntensity[n]=c,this.fireworkSizes[n]=this.fireworkBaseSize[n]*(.7+c*.5)}}uploadFireworkBuffers(){!this.gl||!this.fireworkPositionBuffer||!this.fireworkColorBuffer||!this.fireworkSizeBuffer||!this.fireworkIntensityBuffer||(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.fireworkPositionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.fireworkPositions,this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.fireworkColorBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.fireworkColors,this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.fireworkSizeBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.fireworkSizes,this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.fireworkIntensityBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.fireworkIntensity,this.gl.DYNAMIC_DRAW))}updateTextTexture(e,t){if(!this.gl||e===0||t===0)return;let i=this.config?.title??"",r=this.config?.subtitle??"",n=document.createElement("canvas");n.width=e,n.height=t;let a=n.getContext("2d");if(!a)return;a.clearRect(0,0,e,t),a.textAlign="center",a.textBaseline="middle";let s=e/2,l=Math.max(48,Math.min(e,t)*.12);a.font=`900 ${l}px "Montserrat", "Roboto", system-ui`;let c=t*.42,d=l*.035,u=l*1.15,f=this.wrapText(a,i,e*.82),m=f.length>0?c-(f.length-1)*u/2:c,h=[{offsetX:d*.6,offsetY:d*.7,alpha:.35},{offsetX:d*1.4,offsetY:d*1.6,alpha:.22},{offsetX:d*2.4,offsetY:d*2.6,alpha:.12}];for(let I=0;I<f.length;I++){let z=m+I*u;for(let q of h)a.fillStyle=`rgba(0, 0, 0, ${q.alpha})`,a.fillText(f[I],s+q.offsetX,z+q.offsetY);a.fillStyle="rgba(255, 255, 255, 0.98)",a.fillText(f[I],s,z)}let v=Math.max(32,Math.min(e,t)*.05);a.font=`600 ${v}px "Montserrat", "Roboto", system-ui`;let y=v*1.2,C=this.wrapText(a,r,e*.86),x=f.length>0?m+(f.length-1)*u+u/2:c,M=C.length>0?Math.max(t*.56,x+y*.9):t*.56,$=C.length>0?M-(C.length-1)*y/2:M;for(let I=0;I<C.length;I++)a.fillStyle="rgba(20, 20, 20, 0.94)",a.fillText(C[I],s,$+I*y);this.textTexture||(this.textTexture=this.gl.createTexture()),this.textTexture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.textTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,n),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR))}wrapText(e,t,i){if(!t.trim())return[];let r=Math.max(i,1),n=[],a=t.split(`
`);for(let s of a){let l=s.trim();if(!l){n.length>0&&n.push("");continue}let c=l.split(/\s+/),d=c[0];for(let u=1;u<c.length;u++){let f=c[u],m=`${d} ${f}`;e.measureText(m).width<=r?d=m:(n.push(d),d=f)}n.push(d)}return n}drawScene(e){if(!this.active||!this.gl||!this.canvas)return;let t=(e-this.startTime)/1e3,i=Math.min((e-this.lastFrame)/1e3,.1);this.lastFrame=e,this.updateConfetti(i,this.canvas.width,this.canvas.height,t),this.maybeSpawnFirework(t,this.canvas.width,this.canvas.height),this.updateFireworks(i,this.canvas.width,this.canvas.height),this.uploadConfettiPositions(),this.uploadConfettiAngles(),this.uploadFireworkBuffers(),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.drawBackground(t),this.drawConfetti(t,this.canvas.width,this.canvas.height),this.drawFireworks(this.canvas.width,this.canvas.height),this.drawText(t),this.animationFrameId=requestAnimationFrame(this.renderFrame)}drawBackground(e){!this.gl||!this.backgroundProgram||!this.backgroundBuffer||this.backgroundHandles.position===void 0||(this.gl.useProgram(this.backgroundProgram),this.backgroundHandles.time&&this.gl.uniform1f(this.backgroundHandles.time,e),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.backgroundBuffer),this.gl.enableVertexAttribArray(this.backgroundHandles.position),this.gl.vertexAttribPointer(this.backgroundHandles.position,2,this.gl.FLOAT,!1,0,0),this.gl.drawArrays(this.gl.TRIANGLES,0,3))}drawConfetti(e,t,i){!this.gl||!this.confettiProgram||!this.confettiPositionBuffer||!this.confettiColorBuffer||!this.confettiSizeBuffer||this.confettiHandles.position===void 0||this.confettiHandles.color===void 0||this.confettiHandles.size===void 0||(this.gl.useProgram(this.confettiProgram),this.confettiHandles.resolution&&this.gl.uniform2f(this.confettiHandles.resolution,t,i),this.confettiHandles.time&&this.gl.uniform1f(this.confettiHandles.time,e),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.confettiPositionBuffer),this.gl.enableVertexAttribArray(this.confettiHandles.position),this.gl.vertexAttribPointer(this.confettiHandles.position,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.confettiColorBuffer),this.gl.enableVertexAttribArray(this.confettiHandles.color),this.gl.vertexAttribPointer(this.confettiHandles.color,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.confettiSizeBuffer),this.gl.enableVertexAttribArray(this.confettiHandles.size),this.gl.vertexAttribPointer(this.confettiHandles.size,1,this.gl.FLOAT,!1,0,0),this.confettiHandles.angle!==void 0&&this.confettiHandles.angle>=0&&this.confettiAngleBuffer&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.confettiAngleBuffer),this.gl.enableVertexAttribArray(this.confettiHandles.angle),this.gl.vertexAttribPointer(this.confettiHandles.angle,1,this.gl.FLOAT,!1,0,0)),this.confettiHandles.ratio!==void 0&&this.confettiHandles.ratio>=0&&this.confettiRatioBuffer&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.confettiRatioBuffer),this.gl.enableVertexAttribArray(this.confettiHandles.ratio),this.gl.vertexAttribPointer(this.confettiHandles.ratio,1,this.gl.FLOAT,!1,0,0)),this.gl.drawArrays(this.gl.POINTS,0,this.confettiCount))}drawFireworks(e,t){!this.gl||!this.fireworkProgram||!this.fireworkPositionBuffer||!this.fireworkColorBuffer||!this.fireworkSizeBuffer||!this.fireworkIntensityBuffer||this.fireworkHandles.position===void 0||this.fireworkHandles.color===void 0||this.fireworkHandles.size===void 0||this.fireworkHandles.intensity===void 0||(this.gl.useProgram(this.fireworkProgram),this.fireworkHandles.resolution&&this.gl.uniform2f(this.fireworkHandles.resolution,e,t),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.fireworkPositionBuffer),this.gl.enableVertexAttribArray(this.fireworkHandles.position),this.gl.vertexAttribPointer(this.fireworkHandles.position,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.fireworkColorBuffer),this.gl.enableVertexAttribArray(this.fireworkHandles.color),this.gl.vertexAttribPointer(this.fireworkHandles.color,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.fireworkSizeBuffer),this.gl.enableVertexAttribArray(this.fireworkHandles.size),this.gl.vertexAttribPointer(this.fireworkHandles.size,1,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.fireworkIntensityBuffer),this.gl.enableVertexAttribArray(this.fireworkHandles.intensity),this.gl.vertexAttribPointer(this.fireworkHandles.intensity,1,this.gl.FLOAT,!1,0,0),this.gl.drawArrays(this.gl.POINTS,0,this.fireworkPoolSize))}drawText(e){if(!this.gl||!this.textProgram||!this.textBuffer||!this.textTexture||this.textHandles.position===void 0||this.textHandles.texCoord===void 0)return;let t=Math.min(1,e/.85),i=.85+.15*this.easeOutBack(t)+Math.max(0,Math.sin((e-.6)*3.2)*.02),r=Math.min(1,t*1.1);this.gl.useProgram(this.textProgram),this.textHandles.scale&&this.gl.uniform1f(this.textHandles.scale,i),this.textHandles.opacity&&this.gl.uniform1f(this.textHandles.opacity,r),this.textHandles.texture&&this.gl.uniform1i(this.textHandles.texture,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textTexture),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textBuffer),this.gl.enableVertexAttribArray(this.textHandles.position),this.gl.vertexAttribPointer(this.textHandles.position,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(this.textHandles.texCoord),this.gl.vertexAttribPointer(this.textHandles.texCoord,2,this.gl.FLOAT,!1,16,8),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}easeOutBack(e){return 1+2.70158*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2)}};var sr=["overlay"],lr=["canvas"];function cr(o,e){if(o&1&&(E(0,"div",6)(1,"div",7),p(2),D(),E(3,"div",8),p(4),D()()),o&2){let t=_(2);w(2),ie(t.config==null?null:t.config.title),w(2),ie(t.config==null?null:t.config.subtitle)}}function ur(o,e){if(o&1){let t=te();E(0,"div",3,0),Re("click",function(){R(t);let r=_();return B(r.close())}),He(2,"canvas",4,1),E(4,"button",5),Re("click",function(){R(t);let r=_();return B(r.close())}),p(5,"\xD7"),D(),O(6,cr,5,2,"div",6),D()}if(o&2){let t=_();K("active",t.isActive),w(6),F(t.webglSupported?-1:6)}}var Tt=class o{constructor(e,t,i){this.dialogRef=e;this.zone=t;this.config=i}overlay;canvasRef;isActive=!0;webglSupported=!0;config;renderer=null;autoCloseId=null;ngAfterViewInit(){this.zone.runOutsideAngular(()=>{let t=this.canvasRef?.nativeElement,i=this.overlay?.nativeElement;if(!t||!i)return;let r=new Mt(this.config);if(!r.initialize(t,i)){r.destroy(),this.zone.run(()=>{this.webglSupported=!1});return}this.renderer=r});let e=this.config.duration??8e3;this.autoCloseId=setTimeout(()=>this.close(),e)}ngOnDestroy(){this.isActive=!1,this.autoCloseId!==null&&(clearTimeout(this.autoCloseId),this.autoCloseId=null),this.zone.runOutsideAngular(()=>this.renderer?.destroy()),this.renderer=null}close(){this.isActive&&(this.isActive=!1,this.autoCloseId!==null&&(clearTimeout(this.autoCloseId),this.autoCloseId=null),this.zone.runOutsideAngular(()=>this.renderer?.destroy()),this.renderer=null,this.dialogRef.close())}static \u0275fac=function(t){return new(t||o)(G(Ge),G(Ze),G(rt))};static \u0275cmp=Q({type:o,selectors:[["ng-component"]],viewQuery:function(t,i){if(t&1&&(re(sr,5),re(lr,5)),t&2){let r;ne(r=oe())&&(i.overlay=r.first),ne(r=oe())&&(i.canvasRef=r.first)}},decls:1,vars:1,consts:[["overlay",""],["canvas",""],[1,"celebration-overlay",3,"active"],[1,"celebration-overlay",3,"click"],["aria-hidden","true",1,"celebration-canvas"],[1,"close-btn",3,"click"],[1,"celebration-fallback"],[1,"celebration-title"],[1,"celebration-subtitle"]],template:function(t,i){t&1&&O(0,ur,7,3,"div",2),t&2&&F(i.isActive?0:-1)},styles:[`.celebration-overlay{position:fixed;inset:0;width:100vw;height:100vh;display:none;z-index:10000;overflow:hidden;cursor:pointer;line-height:normal;background:transparent}.celebration-overlay.active{display:block;animation:overlayFadeIn .35s ease-out}@keyframes overlayFadeIn{0%{opacity:0}to{opacity:1}}.celebration-canvas{width:100%;height:100%;display:block;pointer-events:none}.close-btn{position:absolute;top:24px;right:24px;background:#00000040;border:2px solid rgba(255,255,255,.7);color:#fff;border-radius:999px;width:48px;height:48px;font-size:26px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform .2s ease,background .2s ease,border-color .2s ease;pointer-events:auto;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px)}.close-btn:hover{background:#0006;border-color:#ffffffe6;transform:scale(1.08)}.close-btn:focus-visible{outline:3px solid rgba(255,255,255,.8);outline-offset:4px}.celebration-fallback{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:32px;gap:16px;color:#fff;pointer-events:none}.celebration-title{font-size:clamp(2rem,8vw,6rem);font-weight:900;background:linear-gradient(45deg,#e70000,#00ceff,#d40077);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;text-fill-color:transparent;filter:drop-shadow(0 4px 12px rgba(0,0,0,.5))}.celebration-subtitle{font-size:clamp(1rem,3vw,2.2rem);font-weight:600;text-shadow:0 4px 18px rgba(0,0,0,.5)}
`],encapsulation:3})};var _t=class o{constructor(e,t){this.dialog=e;this.difficultyEstimationService=t}dialogRef=null;openAutoPickMessage(e){return P(this,null,function*(){let t,i;try{let a=yield this.difficultyEstimationService.getDifficultyEstimates(e.playArea);t=a?.percentile,i=a?.estimatedSolveTime}catch(a){console.error(a)}let r={mistakes:this.scoreMistakes(e.mistakes),timeSpent:this.scoreTimeSpent(e.timeSpent,i),difficulty:this.scoreDifficulty(t)},n=this.pickAffirmation(r);return this.open({title:n.title,subtitle:n.subTitle,duration:2e4})})}scoreMistakes(e){return!Number.isFinite(e)||e<=0?1:-.6*(Math.pow(2,e)-1)}scoreTimeSpent(e,t){if(!Number.isFinite(e)||e<=0)return 0;let i=e/t;if(!Number.isFinite(i))return 0;let n=2*(1+.05-i),s=(n<0?-1:1)*(Math.pow(2,Math.abs(n))-1);return this.clamp(s)}scoreDifficulty(e){return Number.isFinite(e)?this.clamp(e*2-1):0}pickAffirmation(e){let r=ze.map(l=>{let c=0+l.accuracy*e.mistakes+l.speed*e.timeSpent+l.difficulty*e.difficulty,d=1-.15+Math.random()*(.15*2);return Math.exp(c/.75)*d}),n=r.reduce((l,c)=>l+c,0),a=Math.random()*n,s=0;for(let l=0;l<ze.length;l++)if(s+=r[l],a<=s)return ze[l];return ze[ze.length-1]}clamp(e,t=-1,i=1){return Math.min(Math.max(e,t),i)}open(e){let i=we(we({},{duration:8e3}),e);return this.dialogRef&&this.dialogRef.close(),this.dialogRef=this.dialog.open(Tt,{data:i,backdropClass:"transparent-backdrop",panelClass:"transparent-backdrop",hasBackdrop:!1,autoFocus:!1,restoreFocus:!1,width:"100vw",height:"100vh",maxWidth:"100vw",maxHeight:"100vh",enterAnimationDuration:0}),this.dialogRef.afterClosed().pipe(Wt(()=>{this.dialogRef=null}))}close(){this.dialogRef&&this.dialogRef.close()}static \u0275fac=function(t){return new(t||o)(J(Ie),J(Fe))};static \u0275prov=W({token:o,factory:o.\u0275fac,providedIn:"root"})};var xt=class o{LOGGING_ENABLED=!1;wakeLock=null;retryTimer=null;isEnabled=!1;isAcquiring=!1;enable(){return P(this,null,function*(){this.log("WakeLockService: enable() called"),this.isEnabled=!0,yield this.acquireLock()})}disable(){this.log("WakeLockService: disable() called"),this.isEnabled=!1,this.clearRetryTimer(),this.releaseLock(),this.log("WakeLockService: disabled")}acquireLock(){return P(this,null,function*(){if(!this.isEnabled||this.wakeLock||this.isAcquiring){this.log("WakeLockService: acquireLock() skipped - enabled:",this.isEnabled,"hasLock:",!!this.wakeLock,"isAcquiring:",this.isAcquiring);return}this.isAcquiring=!0,this.log("WakeLockService: attempting to acquire wake lock");try{let e=yield navigator.wakeLock.request("screen");if(!this.isEnabled){this.log("WakeLockService: disabled during acquisition, releasing immediately"),e.release();return}if(this.wakeLock){this.log("WakeLockService: another lock exists, releasing new one"),e.release();return}this.wakeLock=e,this.log("WakeLockService: wake lock acquired successfully"),this.wakeLock.addEventListener("release",()=>{this.log("WakeLockService: wake lock released"),this.wakeLock===e&&(this.wakeLock=null),this.isEnabled&&(this.log("WakeLockService: wake lock lost while enabled, scheduling retry"),this.scheduleRetry())})}catch(e){this.log("WakeLockService: failed to acquire wake lock:",e),this.isEnabled&&(this.log("WakeLockService: scheduling retry after failure"),this.scheduleRetry())}finally{this.isAcquiring=!1}})}scheduleRetry(){if(this.retryTimer){this.log("WakeLockService: retry already scheduled");return}this.log("WakeLockService: scheduling retry in 5 seconds"),this.retryTimer=setTimeout(()=>{this.log("WakeLockService: retry timer triggered"),this.retryTimer=null,this.acquireLock()},5e3)}clearRetryTimer(){this.retryTimer&&(this.log("WakeLockService: clearing retry timer"),clearTimeout(this.retryTimer),this.retryTimer=null)}releaseLock(){this.wakeLock?(this.log("WakeLockService: manually releasing wake lock"),this.wakeLock.release(),this.wakeLock=null):this.log("WakeLockService: releaseLock() called but no lock exists")}log(...e){this.LOGGING_ENABLED&&console.log(...e)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=W({token:o,factory:o.\u0275fac,providedIn:"root"})};var Pt=class o{sortByHueThenDeltaE(e){if(!Array.isArray(e))throw new Error("colors must be an array of strings");let t=e.map((s,l)=>{try{let c=this.parseColor(s),d=this.rgbToHsl(c),u=this.rgbToLab(c);return{input:s,index:l,rgb:c,hsl:d,lab:u}}catch(c){throw console.error(`Invalid color at index ${l}: ${s}`,c),c}}),i=t.filter(s=>Number.isFinite(s.hsl.h)),r=i.length>0?i.reduce((s,l)=>l.hsl.h<s.hsl.h?l:s):t[0],n=t.filter(s=>s!==r),a=[r];for(;n.length>0;){let s=a[a.length-1],l=0,c=this.deltaE2000(s.lab,n[0].lab);for(let d=1;d<n.length;d++){let u=this.deltaE2000(s.lab,n[d].lab);if(u<c-1e-12)c=u,l=d;else if(Math.abs(u-c)<=1e-12){let f=n[d],m=n[l],h=Number.isFinite(f.hsl.h)?f.hsl.h:1/0,v=Number.isFinite(m.hsl.h)?m.hsl.h:1/0;(h!==v?h<v:f.index<m.index)&&(l=d)}}a.push(n.splice(l,1)[0])}return a.map(s=>s.input)}deltaE(e,t){let i=this.rgbToLab(this.parseColor(e)),r=this.rgbToLab(this.parseColor(t));return this.deltaE2000(i,r)}parseColor(e){if(typeof e!="string")throw new Error("Color must be a string");let t=e.trim().toLowerCase();if(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t)){let r=t.slice(1);r.length===3&&(r=r.split("").map(l=>l+l).join(""));let n=parseInt(r.slice(0,2),16),a=parseInt(r.slice(2,4),16),s=parseInt(r.slice(4,6),16);return{r:n,g:a,b:s}}let i=t.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/);if(i){let r=Number(i[1]),n=Number(i[2]),a=Number(i[3]);if([r,n,a].some(s=>s<0||s>255))throw new Error("rgb() values out of range");return{r,g:n,b:a}}throw new Error(`Unsupported color format: ${e}`)}rgbToHsl({r:e,g:t,b:i}){let r=e/255,n=t/255,a=i/255,s=Math.max(r,n,a),l=Math.min(r,n,a),c=(s+l)/2,d,u;if(s===l)d=NaN,u=0;else{let f=s-l;switch(u=c>.5?f/(2-s-l):f/(s-l),s){case r:d=(n-a)/f+(n<a?6:0);break;case n:d=(a-r)/f+2;break;default:d=(r-n)/f+4;break}d*=60}return{h:d,s:u,l:c}}rgbToLab(e){let{x:t,y:i,z:r}=this.rgbToXyz(e);return this.xyzToLab(t,i,r)}rgbToXyz({r:e,g:t,b:i}){let r=[e,t,i].map(u=>u/255).map(u=>u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)),[n,a,s]=r,l=n*.4124564+a*.3575761+s*.1804375,c=n*.2126729+a*.7151522+s*.072175,d=n*.0193339+a*.119192+s*.9503041;return{x:l*100,y:c*100,z:d*100}}xyzToLab(e,t,i){let s=e/95.047,l=t/100,c=i/108.883,d=216/24389,u=24389/27,f=s>d?Math.cbrt(s):(u*s+16)/116,m=l>d?Math.cbrt(l):(u*l+16)/116,h=c>d?Math.cbrt(c):(u*c+16)/116,v=116*m-16,y=500*(f-m),C=200*(m-h);return{L:v,a:y,b:C}}deltaE2000(e,t){let{L:i,a:r,b:n}=e,{L:a,a:s,b:l}=t,c=(i+a)/2,d=Math.hypot(r,n),u=Math.hypot(s,l),f=(d+u)/2,m=.5*(1-Math.sqrt(Math.pow(f,7)/(Math.pow(f,7)+Math.pow(25,7)))),h=(1+m)*r,v=(1+m)*s,y=Math.hypot(h,n),C=Math.hypot(v,l),x=this.atan2Deg(n,h),M=this.atan2Deg(l,v),$=a-i,I=C-y,z=M-x;y*C===0?z=0:z>180?z-=360:z<-180&&(z+=360);let q=2*Math.sqrt(y*C)*Math.sin(this.degToRad(z/2)),g=(i+a)/2,S=(y+C)/2,A=x+M,k;y*C===0?k=A:Math.abs(x-M)<=180?k=A/2:k=(A+360*(A<360?1:-1))/2;let H=1-.17*Math.cos(this.degToRad(k-30))+.24*Math.cos(this.degToRad(2*k))+.32*Math.cos(this.degToRad(3*k+6))-.2*Math.cos(this.degToRad(4*k-63)),N=30*Math.exp(-Math.pow((k-275)/25,2)),V=2*Math.sqrt(Math.pow(S,7)/(Math.pow(S,7)+Math.pow(25,7))),Pe=1+.015*Math.pow(g-50,2)/Math.sqrt(20+Math.pow(g-50,2)),Ne=1+.045*S,qt=1+.015*S*H,ki=-Math.sin(this.degToRad(2*N))*V;return Math.sqrt(Math.pow($/Pe,2)+Math.pow(I/Ne,2)+Math.pow(q/qt,2)+ki*(I/Ne)*(q/qt))}atan2Deg(e,t){let i=this.radToDeg(Math.atan2(e,t));return i<0&&(i+=360),i}degToRad(e){return e*Math.PI/180}radToDeg(e){return e*180/Math.PI}static \u0275fac=function(t){return new(t||o)};static \u0275prov=W({token:o,factory:o.\u0275fac,providedIn:"root"})};var kt=class o{constructor(e){this.contrast=e}assignColors(e,t){if(!Array.isArray(e)||e.length===0)throw new Error("colors must be a non-empty array of strings");if(!Array.isArray(t)||t.length===0||!Array.isArray(t[0])||t[0].length===0)throw new Error("grid must be a non-empty number[][]");let i=t.length,r=t[0].length;for(let g=1;g<i;g++)if(!Array.isArray(t[g])||t[g].length!==r)throw new Error("grid must be rectangular");let n=new Set;for(let g=0;g<i;g++)for(let S=0;S<r;S++)n.add(t[g][S]);let a=Array.from(n.values()).sort((g,S)=>g-S),s=a.length,l=new Set,c=new Map;a.forEach((g,S)=>c.set(g,S));for(let g=0;g<i;g++)for(let S=0;S<r;S++){let A=t[g][S];if(S+1<r){let k=t[g][S+1];A!==k&&l.add(xi(A,k))}if(g+1<i){let k=t[g+1][S];A!==k&&l.add(xi(A,k))}}let d=[];if(l.forEach(g=>{let[S,A]=pr(g);d.push([c.get(S),c.get(A)])}),d.length===0){let g=new Map;for(let S=0;S<s;S++)g.set(a[S],e[S%e.length]);return{colorByNumber:g,score:0}}let u=e.length,f=Array.from({length:u},()=>Array(u).fill(0));for(let g=0;g<u;g++)for(let S=g+1;S<u;S++)try{let A=this.contrast.deltaE(e[g],e[S]);f[g][S]=A,f[S][g]=A}catch(A){throw console.error("Failed computing deltaE for colors",e[g],e[S],A),A}let m=Array.from({length:s},()=>[]);for(let[g,S]of d)m[g].push(S),m[S].push(g);let h=m.map(g=>g.length),v=u>=s,y=Array.from({length:s},(g,S)=>S).sort((g,S)=>h[S]-h[g]),C=Array(s).fill(-1),x=new Set;if(y.length>0){let g=y[0],S=0,A=-1/0;for(let k=0;k<u;k++){let H=0;for(let V=0;V<u;V++)V!==k&&(H+=f[k][V]);let N=H/Math.max(1,u-1);N>A&&(A=N,S=k)}C[g]=S,x.add(S)}for(let g=1;g<y.length;g++){let S=y[g],A=[];if(v){for(let N=0;N<u;N++)x.has(N)||A.push(N);if(A.length===0)for(let N=0;N<u;N++)A.push(N)}else for(let N=0;N<u;N++)A.push(N);let k=A[0],H=-1/0;for(let N of A){let V=0;for(let Pe of m[S]){let Ne=C[Pe];Ne>=0&&(V+=f[N][Ne])}V>H&&(H=V,k=N)}C[S]=k,v&&x.add(k)}let M=20,$=!0,I=0;for(;$&&I++<M;){$=!1;for(let g of y){let S=C[g],A=[];if(v)for(let V=0;V<u;V++)(V===S||!x.has(V))&&A.push(V);else for(let V=0;V<u;V++)A.push(V);let k=this.localNodeContribution(g,C,m,f),H=S,N=k;for(let V of A){if(V===S)continue;let Pe=this.localNodeContributionWithColor(g,V,C,m,f);Pe>N+1e-9&&(N=Pe,H=V)}H!==S&&(v&&(x.delete(S),x.add(H)),C[g]=H,$=!0)}if(v)e:for(let g=0;g<s;g++)for(let S=g+1;S<s;S++){let A=C[g],k=C[S],H=this.localNodeContribution(g,C,m,f)+this.localNodeContribution(S,C,m,f);if(C[g]=k,C[S]=A,this.localNodeContribution(g,C,m,f)+this.localNodeContribution(S,C,m,f)>H+1e-9?$=!0:(C[g]=A,C[S]=k),$)break e}}let z=this.totalScore(C,d,f),q=new Map;for(let g=0;g<s;g++)q.set(a[g],e[C[g]]);return{colorByNumber:q,score:z}}totalScore(e,t,i){let r=0;for(let[n,a]of t)r+=i[e[n]][e[a]];return r}localNodeContribution(e,t,i,r){let n=0,a=t[e];for(let s of i[e])n+=r[a][t[s]];return n}localNodeContributionWithColor(e,t,i,r,n){let a=0;for(let s of r[e])a+=n[t][i[s]];return a}static \u0275fac=function(t){return new(t||o)(J(Pt))};static \u0275prov=W({token:o,factory:o.\u0275fac,providedIn:"root"})};function xi(o,e){return o<e?`${o}|${e}`:`${e}|${o}`}function pr(o){let[e,t]=o.split("|").map(Number);return[e,t]}var Ht=class o{constructor(e,t){this.dialogRef=e;this.data=t}cancel(){this.dialogRef.close(!1)}confirm(){this.dialogRef.close(!0)}static \u0275fac=function(t){return new(t||o)(G(Ge),G(rt))};static \u0275cmp=Q({type:o,selectors:[["ng-component"]],decls:12,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"]],template:function(t,i){t&1&&(b(0,"h2",0),p(1,"Start Over?"),T(),b(2,"div",1)(3,"p"),p(4),T(),b(5,"p"),p(6,"This action cannot be undone."),T()(),b(7,"div",2)(8,"button",3),U("click",function(){return i.cancel()}),p(9,"Cancel"),T(),b(10,"button",4),U("click",function(){return i.confirm()}),p(11," Start Over "),T()()),t&2&&(w(4),j(" Start Game ",i.data.gameNumber," over? Your current progress will be lost, any mistakes on this board will be undone, and any correct moves associated with past or current streaks will be as if those correct moves never happened. "))},dependencies:[he,ge,be,le,se,tt,ve,ye,Ce,nt,at,ot],encapsulation:2})},At=class o{constructor(e){this.dialog=e}open(e){return this.dialog.open(Ht,{data:{gameNumber:e}}).afterClosed().pipe(ue(i=>!!i))}static \u0275fac=function(t){return new(t||o)(J(Ie))};static \u0275prov=W({token:o,factory:o.\u0275fac,providedIn:"root"})};var Ut=class o{constructor(e){this.dialogRef=e}close(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||o)(G(Ge))};static \u0275cmp=Q({type:o,selectors:[["ng-component"]],decls:10,vars:0,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions",""],["mat-flat-button","","color","primary",3,"click"]],template:function(t,i){t&1&&(b(0,"h2",0),p(1,"Auto Clear Update"),T(),b(2,"div",1)(3,"p"),p(4," Rows, columns, and color groups now clear automatically once all required cells are selected. Any remaining uncleared optional cells in that set will be cleared for you. "),T(),b(5,"p"),p(6," This change keeps play moving quicker. You can turn off Auto Clear in Settings if you prefer the tougher, manual approach. "),T()(),b(7,"div",2)(8,"button",3),U("click",function(){return i.close()}),p(9,"Got it"),T()())},dependencies:[he,ge,be,le,se,tt,ve,ye,Ce,nt,at,ot],encapsulation:2})},Et=class o{constructor(e){this.dialog=e}open(){return P(this,null,function*(){let e=this.dialog.open(Ut,{disableClose:!0});yield Ve(e.afterClosed())})}static \u0275fac=function(t){return new(t||o)(J(Ie))};static \u0275prov=W({token:o,factory:o.\u0275fac,providedIn:"root"})};var Dt=class o{constructor(e,t,i){this.settingsService=e;this.saveDataService=t;this.dialogLauncher=i}checkPromise=null;maybeShowAutoClearNotice(){return this.checkPromise||(this.checkPromise=this.evaluateChangedAutoClearDefault()),this.checkPromise}evaluateChangedAutoClearDefault(){return P(this,null,function*(){if(this.settingsService.hasAutoClearUnneededCellsSetting())return;this.settingsService.setAutoClearUnneededCells(!0);let e;try{e=yield this.saveDataService.service.load()}catch(t){console.error("changed-default: failed to load saved data",t);return}e?.inProgressGames?.length&&(yield this.dialogLauncher.open())})}static \u0275fac=function(t){return new(t||o)(J(Le),J(st),J(Et))};static \u0275prov=W({token:o,factory:o.\u0275fac,providedIn:"root"})};var Cr=["boardLayout"],Sr=["boardContainer"],wr=["scratchContainer"],Mr=["boardSection"],Tr=["scratchMeasureHorizontal"],_r=["scratchMeasureVertical"];function xr(o,e){if(o&1){let t=te();b(0,"div",15)(1,"button",14),U("click",function(){R(t);let r=_();return B(r.autoCompleteGame())}),b(2,"mat-icon"),p(3,"auto_fix_high"),T()()()}}function Pr(o,e){if(o&1&&(b(0,"h2"),p(1),T()),o&2){let t=_(2);w(),j("Game ",t.gameNumber," Already Played.")}}function kr(o,e){if(o&1){let t=te();b(0,"div",25),O(1,Pr,2,1,"h2"),b(2,"div")(3,"button",26),U("click",function(){R(t);let r=_();return B(r.playGameAgain())}),b(4,"mat-icon"),p(5,"sports_esports"),T(),p(6),T(),p(7," \xA0\xA0 "),b(8,"button",26),U("click",function(){R(t);let r=_();return B(r.platNextUnfinishedGame())}),b(9,"mat-icon"),p(10,"skip_next"),T(),p(11," Next Game "),T()()()}if(o&2){let t=_();K("animate",t.nextGameButtonState==="show-animated"),w(),F(t.nextGameButtonState==="show-instant"?1:-1),w(5),j(" Play Game ",t.gameNumber," Again ")}}function Ar(o,e){if(o&1&&ae(0,"app-cell",28),o&2){let t=_(3);X("displayType","blank")("columnCount",t.columnCount)("shapesMode",t.shapesMode)}}function Er(o,e){if(o&1){let t=te();b(0,"app-cell",31),U("headerDoubleTapped",function(){R(t);let r=_().$index,n=_().$index,a=_();return B(a.onHeaderDoubleTap(n,r))}),T()}if(o&2){let t=_().$implicit,i=_(2);X("displayType","header")("cell",t)("columnCount",i.columnCount)("shapesMode",i.shapesMode)("disableAnimation",i.disableAnimations)("rowColCurrentSumVisible",i.rowColCurrentSumVisible)}}function Dr(o,e){if(o&1){let t=te();b(0,"app-cell",32),U("used",function(r){R(t);let n=_(3);return B(n.use(r))})("cleared",function(r){R(t);let n=_(3);return B(n.clear(r))}),T()}if(o&2){let t=_().$implicit,i=_(2);X("displayType","standard")("cell",t)("columnCount",i.columnCount)("shapesMode",i.shapesMode)("disableAnimation",i.disableAnimations)("colorGroupCurrentSelectionSumVisible",i.colorGroupCurrentSumVisible)}}function Rr(o,e){if(o&1&&(b(0,"td"),O(1,Ar,1,3,"app-cell",28)(2,Er,1,6,"app-cell",29)(3,Dr,1,6,"app-cell",30),T()),o&2){let t=e.$implicit,i=e.$index,r=_().$index,n=_();K("shape-border-top",n.shapesMode&&!(t!=null&&t.hideBackground)&&(t==null?null:t.borderTop))("shape-border-left",n.shapesMode&&!(t!=null&&t.hideBackground)&&(t==null?null:t.borderLeft))("shape-border-right",n.shapesMode&&!(t!=null&&t.hideBackground)&&(t==null?null:t.borderRight))("shape-border-bottom",n.shapesMode&&!(t!=null&&t.hideBackground)&&(t==null?null:t.borderBottom)),w(),F(r===0&&i===0?1:r===0||r>0&&i===0?2:3)}}function Br(o,e){if(o&1&&(b(0,"tr"),Ee(1,Rr,4,9,"td",27,Ae),T()),o&2){let t=e.$implicit;w(),De(t)}}function Gr(o,e){if(o&1&&(b(0,"div",33,3),ae(2,"app-scratch-pad",34),T(),b(3,"div",35),ae(4,"app-scratch-pad",null,4)(6,"app-scratch-pad",34,5),T()),o&2){let t=_();K("inline",t.layoutMode==="vertical")("side",t.layoutMode==="horizontal"),w(2),X("verticalMode",t.layoutMode==="horizontal"),w(4),X("verticalMode",!0)}}var Pi=class o{constructor(e,t,i,r,n,a,s,l,c,d,u,f){this.celebrationLauncherService=e;this.saveDataService=t;this.boardUiService=i;this.wakeLock=r;this.colorOptimizer=n;this.confirmStartOverLauncher=a;this.ngZone=s;this.settingsService=l;this.lockService=c;this.router=d;this.cachingBoardGenerator=u;this.changedDefaultService=f;this.devMode=ni.VERSION==="000000-0000000000",this.configureTimeTracking(),this.statCalculator=new lt(this.previousGames),this.configureUndo(),this.shapesMode=this.settingsService.getShapesModeEnabled(),this.scratchPadVisible=this.settingsService.getScratchPadVisible();let m=this.settingsService.getSectionCompletionAnimationEnabled();this.sectionAnimator.setEnabled(m);let h=this.settingsService.getAutoClearUnneededCells();this.sectionAnimator.setAutoComplete(h),this.rowColCurrentSumVisible=this.settingsService.getRowAndColumnCurrentSelectionSumVisible(),this.colorGroupCurrentSumVisible=this.settingsService.getColorGroupCurrentSelectionSumVisible(),this.sectionAnimator.setAutoClearHandler(v=>this.recordAutoClearedCells(v)),this.sectionAnimator.animationCompleted$.pipe(L(this.destroy)).subscribe(()=>{this.saveGameState(),this.checkComplete()}),this.layoutController=new St(this.ngZone,v=>{this.layoutMode=v.layoutMode,this.boardHorizontalOffset=v.boardOffset})}get columnCount(){return this.gameBoard?.fullBoard.length}gameNumber=1;SelectionStatus=Se;gameBoard=new me;devMode=!1;shapesMode=!1;scratchPadVisible=!0;nextGameButtonState="hidden";disableAnimations=!1;stats;rowColCurrentSumVisible=!0;colorGroupCurrentSumVisible=!1;layoutMode="vertical";boardHorizontalOffset=0;previousGames=new Map;moveHistory=[];undoManager;destroy=new Y;statCalculator;timeTracker=new ct;layoutController;sectionAnimator=new wt;lockLostNavigated=!1;celebratingGameNumber=void 0;set boardLayout(e){this.layoutController.setBoardLayout(e?.nativeElement)}set boardContainer(e){this.layoutController.setBoardContainer(e?.nativeElement)}set scratchContainer(e){this.layoutController.setScratchContainer(e?.nativeElement)}set boardSection(e){this.layoutController.setBoardSection(e.nativeElement)}set scratchMeasureHorizontal(e){this.layoutController.setScratchMeasureHorizontal(e?.nativeElement)}set scratchMeasureVertical(e){this.layoutController.setScratchMeasureVertical(e?.nativeElement)}ngOnInit(){return P(this,null,function*(){(yield this.ensureAppLock())&&(this.monitorLock(),this.boardUiService.boardVisible$.next(!0),this.destroy.pipe(jt()).subscribe(()=>this.wakeLock.disable()),this.changedDefaultService.maybeShowAutoClearNotice(),this.boardUiService.undoRequested$.pipe(L(this.destroy)).subscribe(()=>{this.undoManager.undoLast()}),this.boardUiService.setCanUndo(this.undoManager.hasUndo()),(yield this.tryLoadGameFromStorage())||(yield this.updateGameNumber(this.gameNumber||1)),this.setupStartOverMenuHandling(),this.boardUiService.setShowStartOver(!0))})}ngAfterViewInit(){this.layoutController.scheduleMeasurement()}ngOnDestroy(){this.destroy.next(),this.boardUiService.boardVisible$.next(!1),this.boardUiService.setShowStartOver(!1),this.timeTracker.destroy(),this.saveGameState(),this.layoutController.destroy(),this.sectionAnimator.dispose(),this.lockService.releaseLock().catch(e=>{this.isAbortError(e)||console.error("Failed to release app lock",e)})}handleBeforeUnload(){this.saveGameState()}monitorLock(){this.lockService.lockLost$.pipe(L(this.destroy)).subscribe(()=>this.handleLockLost())}ensureAppLock(){return P(this,null,function*(){if(this.lockService.hasLock)return!0;try{yield this.lockService.acquireLock()}catch(e){return console.error("Failed to acquire lock",e),yield this.router.navigateByUrl("/resume"),!1}return this.lockService.hasLock?!0:(yield this.router.navigateByUrl("/resume"),!1)})}handleLockLost(){this.lockLostNavigated||(this.lockLostNavigated=!0,this.ngZone.run(()=>{this.boardUiService.boardVisible$.next(!1),this.boardUiService.setShowStartOver(!1),this.router.navigateByUrl("/resume").catch(e=>{console.error("Failed to navigate after losing app lock",e)})}))}isAbortError(e){return e instanceof DOMException&&e.name==="AbortError"}configureUndo(){this.undoManager=new ut({getGameBoard:()=>this.gameBoard,getMoveHistory:()=>this.moveHistory,moveUndone:()=>{this.gameBoard.recalculateSelectedHeaders(),this.saveGameState()},undoEnabledStateChange:e=>this.boardUiService.setCanUndo(e)})}recordAutoClearedCells(e){e.length&&this.undoManager.pushCells(e.map(t=>({kind:"clear",cell:t,nextStatus:2})),{appendToPrevious:!0})}configureTimeTracking(){this.timeTracker.syncedTimer$.pipe(L(this.destroy)).subscribe(e=>{if(this.stats){let t=this.previousGames.get(this.gameNumber);if(t&&t.completed)return;this.stats.timeSpent=e}}),this.timeTracker.browserState$.pipe(L(this.destroy),Me(e=>!e.active&&e.reason!=="manualPause")).subscribe(()=>{this.saveGameState()})}changeGameNumberFromUi(e){return P(this,null,function*(){this.saveGameState();let t=this.previousGames.get(e);t?yield this.constructBoardFromPreviousState(t):yield this.updateGameNumber(e),this.saveGameState()})}updateGameNumber(e){return P(this,null,function*(){this.gameNumber=e,this.celebratingGameNumber=void 0,this.moveHistory=[],this.nextGameButtonState="hidden",this.undoManager.clear(),this.timeTracker.reset(0),this.timeTracker.manualStart(),this.wakeLock.enable(),yield this.buildAndDisplayBoard(e),this.saveGameState()})}buildAndDisplayBoard(e){return P(this,null,function*(){this.gameBoard=yield this.cachingBoardGenerator.generateOrGetGameBoard(e);let t=this.gameBoard.playArea.map(n=>n.map(a=>a.groupNumber)),i=this.colorOptimizer.assignColors(xe.COLORS_DARK,t),r=this.colorOptimizer.assignColors(xe.COLORS_LIGHT,t);this.gameBoard.playArea.forEach(n=>n.forEach(a=>{a.colorDark=i.colorByNumber.get(a.groupNumber),a.colorLight=r.colorByNumber.get(a.groupNumber)})),this.disableAnimationsTemporarily(),this.layoutController.scheduleMeasurement()})}use(e){return P(this,null,function*(){e.processing=!1,e.status===0&&(e.required?(e.status=1,this.updateMoveHistory(!0),this.undoManager.pushCells([{kind:"select",cell:e}]),this.gameBoard.recalculateSelectedHeaders(),this.sectionAnimator.handleCellUsed(this.gameBoard,e)):(this.updateMoveHistory(!1),this.undoManager.pushMistake(),this.handleIncorrectMove(e)),this.saveGameState(),this.checkComplete())})}clear(e){return P(this,null,function*(){e.processing=!1,e.status===0&&(e.required?(this.updateMoveHistory(!1),this.undoManager.pushMistake(),this.handleIncorrectMove(e)):(e.status=2,this.updateMoveHistory(!0),this.undoManager.pushCells([{kind:"clear",cell:e}])),this.saveGameState(),this.checkComplete())})}onHeaderDoubleTap(e,t){return P(this,null,function*(){if(e>0&&t>0)return;let i=[];e===0&&t>0?i=this.gameBoard.clearColumn(t-1):t===0&&e>0&&(i=this.gameBoard.clearRow(e-1)),i.length&&this.undoManager.pushCells(i.map(r=>({kind:"clear",cell:r,nextStatus:2}))),this.saveGameState(),this.checkComplete()})}playGameAgain(){return P(this,null,function*(){this.confirmStartOverLauncher.open(this.gameNumber).pipe(L(this.destroy)).subscribe(e=>P(this,null,function*(){e&&(this.previousGames.delete(this.gameNumber),yield this.updateGameNumber(this.gameNumber),this.saveGameState())}))})}autoCompleteGame(){this.gameBoard.playArea.forEach(t=>t.forEach(i=>i.status=i.required?1:2));let e=this.gameBoard.playArea[0][0];e.status=0,e.required?this.use(e):this.clear(e)}platNextUnfinishedGame(){return P(this,null,function*(){let e=Array.from(this.previousGames.keys()).sort((i,r)=>i-r);for(let i=this.gameNumber+1;i<=Math.max(...e)+1;i++){let r=this.previousGames.get(i);if(r&&!r.completed){yield this.constructBoardFromPreviousState(r);return}else if(!r){yield this.changeGameNumberFromUi(i);return}}let t=Math.max(...e);yield this.changeGameNumberFromUi(t+1)})}disableAnimationsTemporarily(){return P(this,null,function*(){this.disableAnimations=!0,yield new Promise(e=>setTimeout(e,0)),this.disableAnimations=!1})}updateMoveHistory(e){this.moveHistory.push({timestamp:Date.now(),correct:e})}tryLoadGameFromStorage(){return P(this,null,function*(){let e=yield this.saveDataService.service.load();if(e&&(this.gameNumber=e.currentGameNumber||1,e.inProgressGames)){e.inProgressGames.forEach(i=>this.previousGames.set(i.gameNumber,i));let t=this.previousGames.get(this.gameNumber);if(t)return yield this.constructBoardFromPreviousState(t),!0}return!1})}constructBoardFromPreviousState(e){return P(this,null,function*(){if(this.gameNumber=e.gameNumber||1,this.celebratingGameNumber=void 0,this.moveHistory=e.moveHistory??[],this.nextGameButtonState="hidden",this.undoManager.clear(),this.timeTracker.reset(e.timeSpent??0),e.completed)yield this.buildAndDisplayBoard(this.gameNumber),this.gameBoard.playArea.forEach(t=>t.forEach(i=>{i.required=!1,i.status=2,i.value=0})),this.gameBoard.recalculateSelectedHeaders(),this.gameBoard.isComplete(),this.nextGameButtonState="show-instant",this.wakeLock.disable();else if(e.grid){let t=e.grid.map(a=>a.map(s=>s.groupNumber)),i=this.colorOptimizer.assignColors(xe.COLORS_DARK,t),r=this.colorOptimizer.assignColors(xe.COLORS_LIGHT,t),n=e.grid.map(a=>a.map(s=>{let l=new ce;return l.status=s.status,l.required=s.required,l.value=s.value,l.groupNumber=s.groupNumber,l.colorDark=i.colorByNumber.get(s.groupNumber),l.colorLight=r.colorByNumber.get(s.groupNumber),l}));this.gameBoard=new me,this.gameBoard.playArea=n,this.gameBoard.constructBoard(this.gameNumber),this.gameBoard.recalculateSelectedHeaders(),this.disableAnimationsTemporarily(),this.timeTracker.manualStart(),this.wakeLock.enable()}else yield this.updateGameNumber(this.gameNumber);this.calculateStats(),this.layoutController.scheduleMeasurement()})}handleIncorrectMove(e){return P(this,null,function*(){this.vibrate(),e.invalidMove=!0,yield new Promise(t=>setTimeout(t,1e3)),e.invalidMove=!1})}saveGameState(){let e=this.saveDataService.service.generateSaverDto(),t=this.gameBoard.inProgress()||this.previousGames.get(this.gameNumber)?.moveHistory.length>0||this.moveHistory?.length>0,i=this.gameBoard.isComplete(),r=this.previousGames.get(this.gameNumber)?.completed??!1,n=i||r;n&&this.timeTracker.manualPause();let a=this.gameBoard.playArea.map(s=>s.map(l=>({status:l.status,required:l.required,value:l.value,groupNumber:l.groupNumber})));if(t||n){let s={completed:n,gameNumber:this.gameNumber,grid:n?void 0:a,moveHistory:this.moveHistory,timeSpent:this.timeTracker.getTotalTime()};this.previousGames.set(this.gameNumber,s)}else this.previousGames.delete(this.gameNumber);e.currentGameNumber=this.gameNumber,e.inProgressGames=Array.from(this.previousGames.values()),this.saveDataService.service.saveNoWait(e),this.calculateStats()}calculateStats(){this.stats=this.statCalculator.calculateStats(this.gameNumber)}setupStartOverMenuHandling(){this.boardUiService.restartRequested$.pipe(L(this.destroy)).subscribe(()=>{this.playGameAgain()})}checkComplete(){return P(this,null,function*(){if(this.gameBoard.isComplete()&&this.celebratingGameNumber===void 0){this.celebratingGameNumber=this.gameNumber,this.undoManager.clear();let e={mistakes:this.stats.mistakesCurrentBoard,timeSpent:this.stats.timeSpent,playArea:this.gameBoard.playArea};(yield this.celebrationLauncherService.openAutoPickMessage(e)).pipe(L(this.destroy)).subscribe(()=>{this.wakeLock.disable(),setTimeout(()=>{this.nextGameButtonState="show-animated"},250)})}})}vibrate(){"vibrate"in navigator&&navigator.vibrate([100,50,100])}static \u0275fac=function(t){return new(t||o)(G(_t),G(st),G(gi),G(xt),G(kt),G(At),G(Ze),G(Le),G(hi),G(ri),G(Oe),G(Dt))};static \u0275cmp=Q({type:o,selectors:[["app-board"]],viewQuery:function(t,i){if(t&1&&(re(Cr,5),re(Sr,5),re(wr,5),re(Mr,7),re(Tr,5),re(_r,5)),t&2){let r;ne(r=oe())&&(i.boardLayout=r.first),ne(r=oe())&&(i.boardContainer=r.first),ne(r=oe())&&(i.scratchContainer=r.first),ne(r=oe())&&(i.boardSection=r.first),ne(r=oe())&&(i.scratchMeasureHorizontal=r.first),ne(r=oe())&&(i.scratchMeasureVertical=r.first)}},hostVars:2,hostBindings:function(t,i){t&1&&U("beforeunload",function(){return i.handleBeforeUnload()},Qe),t&2&&de("--columnCount",i.columnCount)},decls:32,vars:14,consts:[["boardSection",""],["boardLayout",""],["boardContainer",""],["scratchContainer",""],["scratchMeasureHorizontal",""],["scratchMeasureVertical",""],[1,"page-container","no-select"],[1,"top-section"],[1,"centered"],[1,"top-controls"],[1,"game-controls"],["matMiniFab","",1,"game-button",3,"click","disabled"],["subscriptSizing","dynamic",1,"game-number"],["matInput","","type","number","min","1",3,"ngModelChange","ngModel"],["matMiniFab","",1,"game-button",3,"click"],[1,"dev-controls"],[1,"stats"],[3,"stats"],[1,"estimated"],[3,"playArea","gameNumber"],[1,"next-game-container",3,"animate"],[1,"game-board-section"],[1,"board-layout"],[1,"container","board-container"],[1,"game-table"],[1,"next-game-container"],["matFab","","extended","",3,"click"],[3,"shape-border-top","shape-border-left","shape-border-right","shape-border-bottom"],[3,"displayType","columnCount","shapesMode"],[3,"displayType","cell","columnCount","shapesMode","disableAnimation","rowColCurrentSumVisible"],[3,"displayType","cell","columnCount","shapesMode","disableAnimation","colorGroupCurrentSelectionSumVisible"],[3,"headerDoubleTapped","displayType","cell","columnCount","shapesMode","disableAnimation","rowColCurrentSumVisible"],[3,"used","cleared","displayType","cell","columnCount","shapesMode","disableAnimation","colorGroupCurrentSelectionSumVisible"],[1,"scratch-container"],[3,"verticalMode"],["aria-hidden","true",1,"scratch-measure"]],template:function(t,i){if(t&1){let r=te();b(0,"div",6)(1,"div",7),ae(2,"app-title"),b(3,"div",8)(4,"div",9)(5,"div",10)(6,"button",11),U("click",function(){return R(r),B(i.changeGameNumberFromUi(i.gameNumber-1))}),b(7,"mat-icon"),p(8,"do_not_disturb_on"),T()(),b(9,"mat-form-field",12)(10,"mat-label"),p(11,"Game #"),T(),b(12,"input",13),U("ngModelChange",function(a){return R(r),B(i.changeGameNumberFromUi(a))}),T()(),b(13,"button",14),U("click",function(){return R(r),B(i.changeGameNumberFromUi(i.gameNumber+1))}),b(14,"mat-icon"),p(15,"add_circle"),T()(),O(16,xr,4,0,"div",15),T(),b(17,"div",16),ae(18,"app-stats",17),T(),b(19,"div",18),ae(20,"app-estimated-difficulty",19),T()()()(),O(21,kr,12,4,"div",20),b(22,"div",21,0)(24,"div",22,1)(26,"div",23,2)(28,"table",24),Ee(29,Br,3,0,"tr",null,Ae),T()(),O(31,Gr,8,6),T()()()}t&2&&(w(6),X("disabled",i.gameNumber<=1),w(6),X("ngModel",i.gameNumber),w(4),F(i.devMode?16:-1),w(2),X("stats",i.stats),w(2),X("playArea",i.gameBoard.isComplete()?void 0:i.gameBoard.playArea)("gameNumber",i.gameNumber),w(),F(i.nextGameButtonState!=="hidden"?21:-1),w(3),K("layout-horizontal",i.layoutMode==="horizontal")("layout-vertical",i.layoutMode==="vertical"),w(2),de("margin-left",i.layoutMode==="horizontal"?i.boardHorizontalOffset:null,"px"),w(3),De(i.gameBoard.fullBoard),w(2),F(i.scratchPadVisible?31:-1))},dependencies:[he,ai,ci,si,ui,li,ge,mi,di,be,fi,le,Be,se,it,oi,ve,ye,Ce,pe,ft,Ct,pi,gt,vt],styles:['[_nghost-%COMP%]{--headerSpacing: calc(14cqmin / var(--columnCount));--cellGap: calc(7cqmin / var(--columnCount))}.page-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100vw;height:100vh}.top-section[_ngcontent-%COMP%]{flex:0 0 auto}.game-board-section[_ngcontent-%COMP%]{flex:1;display:flex;align-items:flex-start;justify-content:center;min-height:0;container-type:size;margin:14px 20px 10px 15px}.board-layout[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;width:100%;height:100%;position:relative}.board-layout.layout-horizontal[_ngcontent-%COMP%]{flex-direction:row;align-items:center;justify-content:flex-start}.board-layout.layout-horizontal[_ngcontent-%COMP%]   .board-container[_ngcontent-%COMP%]{margin-right:0}.board-layout.layout-horizontal[_ngcontent-%COMP%]   .scratch-container.side[_ngcontent-%COMP%]{margin-left:16px}.board-layout.layout-vertical[_ngcontent-%COMP%]   .scratch-container.inline[_ngcontent-%COMP%]{margin-top:12px}.board-layout.layout-vertical[_ngcontent-%COMP%]   .board-container[_ngcontent-%COMP%]{margin-left:0!important}.board-container[_ngcontent-%COMP%]{flex:0 0 auto}.scratch-container[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;align-self:center}.scratch-measure[_ngcontent-%COMP%]{position:absolute;top:0;left:0;visibility:hidden;opacity:0;pointer-events:none}.scratch-measure[_ngcontent-%COMP%]   app-scratch-pad[_ngcontent-%COMP%]{display:inline-block;margin:0}.centered[_ngcontent-%COMP%]{display:flex;justify-content:center}.top-controls[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.game-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px}.game-number[_ngcontent-%COMP%]{max-width:91px}.game-button[_ngcontent-%COMP%]{margin-left:5px;margin-right:5px}.stats[_ngcontent-%COMP%]{justify-self:center;display:flex;align-items:center;gap:10px;margin-top:15px}.dev-controls[_ngcontent-%COMP%]{display:inline-flex;align-items:center}.estimated[_ngcontent-%COMP%]{margin-top:12px}.next-game-container[_ngcontent-%COMP%]{text-align:center;max-height:200px;opacity:1;margin-top:10px;margin-bottom:10px}.next-game-container.animate[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_expand-view 1s ease-in-out forwards}@keyframes _ngcontent-%COMP%_expand-view{0%{max-height:0;opacity:0;margin-top:0;margin-bottom:0}to{max-height:80px;opacity:1;margin-top:10px;margin-bottom:10px}}.container[_ngcontent-%COMP%]{width:100%;height:100%;max-width:min(100%,100cqh);max-height:min(100%,100cqw);line-height:normal}.game-table[_ngcontent-%COMP%]{border-collapse:collapse;border-spacing:0}.game-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .game-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:0}.game-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{position:relative}.game-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:first-child   td[_ngcontent-%COMP%]{padding-bottom:var(--headerSpacing)}.game-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{padding-right:var(--headerSpacing)}.game-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:not(:first-child):not(:last-child)   td[_ngcontent-%COMP%]{padding-bottom:var(--cellGap)}.game-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(:first-child):not(:last-child){padding-right:var(--cellGap)}.game-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:after{content:"";position:absolute;top:calc(-1 * var(--cellGap));left:calc(-1 * var(--cellGap));width:calc(100% + var(--cellGap));height:calc(100% + var(--cellGap));z-index:1;pointer-events:none;box-sizing:border-box;border-style:solid;border-color:var(--mat-sys-on-surface-variant);border-width:0}.game-table[_ngcontent-%COMP%]   td.shape-border-top[_ngcontent-%COMP%]:after{border-top-width:var(--cellGap)}.game-table[_ngcontent-%COMP%]   td.shape-border-left[_ngcontent-%COMP%]:after{border-left-width:var(--cellGap)}.game-table[_ngcontent-%COMP%]   td.shape-border-right[_ngcontent-%COMP%]:after{border-right-width:var(--cellGap)}.game-table[_ngcontent-%COMP%]   td.shape-border-bottom[_ngcontent-%COMP%]:after{border-bottom-width:var(--cellGap)}']})};export{Pi as Board};
